!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/cdk/drag-drop"),require("@angular/common"),require("@angular/core"),require("rxjs"),require("lodash")):"function"==typeof define&&define.amd?define("ngx-chess-board",["exports","@angular/cdk/drag-drop","@angular/common","@angular/core","rxjs","lodash"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-chess-board"]={},e.ng.cdk.dragDrop,e.ng.common,e.ng.core,e.rxjs,e.lodash)}(this,(function(e,t,i,o,r,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};function a(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}Object.create;function c(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],o=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var o,r,n=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return s}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var d;Object.create;!function(e){e[e.WHITE=0]="WHITE",e[e.BLACK=1]="BLACK"}(d||(d={}));var p,u=function(e,t,i,o,r){this.checkPoints=[],this.color=t,this.constant=i,this.point=e,this.relValue=o,this.board=r},f=function(){function e(e,t){this.row=e,this.col=t}return e.prototype.isEqual=function(e){return e&&this.row===e.row&&this.col===e.col},e.prototype.hasCoordsEqual=function(e,t){return e&&t&&this.row===e&&this.col===t},e.prototype.isInRange=function(){return this.row>=0&&this.row<=7&&this.col>=0&&this.col<=7},e.prototype.clone=function(){return new e(this.row,this.col)},e}(),b=function(e){function t(t,i,o,r){var n=e.call(this,t,i,o,5,r)||this;return n.isMovedAlready=!1,n}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t+1;o<8&&this.board.isFieldEmpty(o,i);++o)e.push(new f(o,i));for(o=t-1;o>=0&&this.board.isFieldEmpty(o,i);--o)e.push(new f(o,i));for(var r=i-1;r>=0&&this.board.isFieldEmpty(t,r);--r)e.push(new f(t,r));for(r=i+1;r<8&&this.board.isFieldEmpty(t,r);++r)e.push(new f(t,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t+1;o<8;++o){if(this.board.isFieldTakenByEnemy(o,i,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,i));break}if(!this.board.isFieldEmpty(o,i))break}for(o=t-1;o>=0;--o){if(this.board.isFieldTakenByEnemy(o,i,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,i));break}if(!this.board.isFieldEmpty(o,i))break}for(var r=i-1;r>=0;--r){if(this.board.isFieldTakenByEnemy(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(t,r));break}if(!this.board.isFieldEmpty(t,r))break}for(r=i+1;r<8;++r){if(this.board.isFieldTakenByEnemy(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(t,r));break}if(!this.board.isFieldEmpty(t,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t+1;o<8;++o)if(this.board.isFieldEmpty(o,i))e.push(new f(o,i));else if(!(this.board.getPieceByField instanceof g)){e.push(new f(o,i));break}for(o=t-1;o>=0;--o)if(this.board.isFieldEmpty(o,i))e.push(new f(o,i));else if(!(this.board.getPieceByField instanceof g)){e.push(new f(o,i));break}for(var r=i-1;r>=0;--r)if(this.board.isFieldEmpty(t,r))e.push(new f(t,r));else if(!(this.board.getPieceByField instanceof g)){e.push(new f(t,r));break}for(r=i+1;r<8;++r)if(this.board.isFieldEmpty(t,r))e.push(new f(t,r));else if(!(this.board.getPieceByField instanceof g)){e.push(new f(t,r));break}return e},t}(u),g=function(e){function t(t,i,o,r){var n=e.call(this,t,i,o,0,r)||this;return n.castledAlready=!1,n.shortCastled=!1,n.longCastled=!1,n.isCastling=!1,n}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,i=this.point.col;if(this.board.isFieldEmpty(t,i-1)&&!this.board.isFieldUnderAttack(t,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t,i-1)),this.board.isFieldEmpty(t,i+1)&&!this.board.isFieldUnderAttack(t,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t,i+1)),this.board.isFieldEmpty(t+1,i)&&!this.board.isFieldUnderAttack(t+1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i)),this.board.isFieldEmpty(t-1,i)&&!this.board.isFieldUnderAttack(t-1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i)),this.board.isFieldEmpty(t-1,i-1)&&!this.board.isFieldUnderAttack(t-1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i-1)),this.board.isFieldEmpty(t-1,i+1)&&!this.board.isFieldUnderAttack(t-1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i+1)),this.board.isFieldEmpty(t+1,i-1)&&!this.board.isFieldUnderAttack(t+1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i-1)),this.board.isFieldEmpty(t+1,i+1)&&!this.board.isFieldUnderAttack(t+1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i+1)),!this.isMovedAlready){for(var o=!0,r=i-1;r>0;--r)if(!this.board.isFieldEmpty(t,r)||this.board.isFieldUnderAttack(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){o=!1;break}if(o&&!this.board.isKingInCheck(this.color,this.board.pieces)&&this.board.getPieceByField(t,0)){var n=this.board.getPieceByField(t,0);n instanceof b&&(n.isMovedAlready||e.push(new f(t,i-2)))}var s=!0;for(r=i+1;r<7;++r)if(!this.board.isFieldEmpty(t,r)||this.board.isFieldUnderAttack(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){s=!1;break}if(s&&!this.board.isKingInCheck(this.color,this.board.pieces)&&this.board.getPieceByField(t,7)){var a=this.board.getPieceByField(t,7);a instanceof b&&(a.isMovedAlready||e.push(new f(t,i+2)))}}return e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,i=this.point.col;return this.board.isFieldTakenByEnemy(t,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t,i-1)),this.board.isFieldTakenByEnemy(t,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t,i+1)),this.board.isFieldTakenByEnemy(t+1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t+1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i)),this.board.isFieldTakenByEnemy(t-1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t-1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i)),this.board.isFieldTakenByEnemy(t-1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t-1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i-1)),this.board.isFieldTakenByEnemy(t-1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t-1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i+1)),this.board.isFieldTakenByEnemy(t+1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t+1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i-1)),this.board.isFieldTakenByEnemy(t+1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t+1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,i=this.point.col;return e.push(new f(t,i-1)),e.push(new f(t,i+1)),e.push(new f(t+1,i)),e.push(new f(t-1,i)),e.push(new f(t-1,i-1)),e.push(new f(t-1,i+1)),e.push(new f(t+1,i-1)),e.push(new f(t+1,i+1)),e},t}(u),y=function(e){function t(t,i,o,r){return e.call(this,t,i,o,3,r)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0&&this.board.isFieldEmpty(o,r);--o,--r)e.push(new f(o,r));for(o=t-1,r=i+1;o>=0&&r<8&&this.board.isFieldEmpty(o,r);--o,++r)e.push(new f(o,r));for(o=t+1,r=i-1;o<8&&r>=0&&this.board.isFieldEmpty(o,r);++o,--r)e.push(new f(o,r));for(o=t+1,r=i+1;o<8&&r<8&&this.board.isFieldEmpty(o,r);++o,++r)e.push(new f(o,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0;--o,--r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t-1,r=i+1;o>=0&&r<8;--o,++r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1,r=i-1;o<8&&r>=0;++o,--r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1,r=i+1;o<8&&r<8;++o,++r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,r));break}if(!this.board.isFieldEmpty(o,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0;--o,--r){if(!this.board.isFieldEmpty(o,r)){this.board.getPieceByField(o,r)instanceof g||e.push(new f(o,r));break}e.push(new f(o,r))}for(o=t-1,r=i+1;o>=0&&r<8;--o,++r){if(!this.board.isFieldEmpty(o,r)){this.board.getPieceByField(o,r)instanceof g||e.push(new f(o,r));break}e.push(new f(o,r))}for(o=t+1,r=i-1;o<8&&r>=0;++o,--r){if(!this.board.isFieldEmpty(o,r)){this.board.getPieceByField(o,r)instanceof g||e.push(new f(o,r));break}e.push(new f(o,r))}for(o=t+1,r=i+1;o<8&&r<8;++o,++r){if(!this.board.isFieldEmpty(o,r)){this.board.getPieceByField(o,r)instanceof g||e.push(new f(o,r));break}e.push(new f(o,r))}return e},t}(u),v=function(e){function t(t,i,o,r){var n=e.call(this,t,i,o,3,r)||this;return n.isMovedAlready=!1,n}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,i=this.point.col;return this.board.isFieldEmpty(t-2,i-1)&&e.push(new f(t-2,i-1)),this.board.isFieldEmpty(t-2,i+1)&&e.push(new f(t-2,i+1)),this.board.isFieldEmpty(t-1,i-2)&&e.push(new f(t-1,i-2)),this.board.isFieldEmpty(t-1,i+2)&&e.push(new f(t-1,i+2)),this.board.isFieldEmpty(t+1,i-2)&&e.push(new f(t+1,i-2)),this.board.isFieldEmpty(t+1,i+2)&&e.push(new f(t+1,i+2)),this.board.isFieldEmpty(t+2,i-1)&&e.push(new f(t+2,i-1)),this.board.isFieldEmpty(t+2,i+1)&&e.push(new f(t+2,i+1)),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,i=this.point.col;return this.board.isFieldTakenByEnemy(t-2,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-2,i-1)),this.board.isFieldTakenByEnemy(t-2,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-2,i+1)),this.board.isFieldTakenByEnemy(t-1,i-2,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i-2)),this.board.isFieldTakenByEnemy(t-1,i+2,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i+2)),this.board.isFieldTakenByEnemy(t+1,i-2,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i-2)),this.board.isFieldTakenByEnemy(t+1,i+2,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i+2)),this.board.isFieldTakenByEnemy(t+2,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+2,i-1)),this.board.isFieldTakenByEnemy(t+2,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+2,i+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,i=this.point.col;return e.push(new f(t-2,i-1)),e.push(new f(t-2,i+1)),e.push(new f(t-1,i-2)),e.push(new f(t-1,i+2)),e.push(new f(t+1,i-2)),e.push(new f(t+1,i+2)),e.push(new f(t+2,i-1)),e.push(new f(t+2,i+1)),e},t}(u),w=function(e){function t(t,i,o,r){var n=e.call(this,t,i,o,1,r)||this;return n.isMovedAlready=!1,n}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,i=this.point.col;return!this.board.reverted&&this.color===d.WHITE||this.board.reverted&&this.color===d.BLACK?this.board.isFieldEmpty(t-1,i)&&(e.push(new f(t-1,i)),!this.isMovedAlready&&this.board.isFieldEmpty(t-2,i)&&e.push(new f(t-2,i))):
/*!board.isFieldTakenByEnemy(row + 1, col, Color.WHITE) &&*/this.board.isFieldEmpty(t+1,i)&&(e.push(new f(t+1,i)),!this.isMovedAlready&&this.board.isFieldEmpty(t+2,i)&&e.push(new f(t+2,i))),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,i=this.point.col;return!this.board.reverted&&this.color===d.WHITE||this.board.reverted&&this.color===d.BLACK?(this.board.isFieldTakenByEnemy(t-1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i-1)),this.board.isFieldTakenByEnemy(t-1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t-1,i+1))):(this.board.isFieldTakenByEnemy(t+1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i-1)),this.board.isFieldTakenByEnemy(t+1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new f(t+1,i+1))),this.board.enPassantPoint&&this.board.enPassantPiece.color===(this.color===d.WHITE?d.BLACK:d.WHITE)&&t===this.board.enPassantPiece.point.row&&1===Math.abs(this.board.enPassantPiece.point.col-i)&&e.push(this.board.enPassantPoint),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,i=this.point.col;return!this.board.reverted&&this.color===d.WHITE||this.board.reverted&&this.color===d.BLACK?(e.push(new f(t-1,i-1)),e.push(new f(t-1,i+1))):(e.push(new f(t+1,i-1)),e.push(new f(t+1,i+1))),e},t}(u),P=function(e){function t(t,i,o,r){return e.call(this,t,i,o,9,r)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0&&this.board.isFieldEmpty(o,r);--o,--r)e.push(new f(o,r));for(o=t-1,r=i+1;o>=0&&r<8&&this.board.isFieldEmpty(o,r);--o,++r)e.push(new f(o,r));for(o=t+1,r=i-1;o<8&&r>=0&&this.board.isFieldEmpty(o,r);++o,--r)e.push(new f(o,r));for(o=t+1,r=i+1;o<8&&r<8&&this.board.isFieldEmpty(o,r);++o,++r)e.push(new f(o,r));for(o=t+1;o<8&&this.board.isFieldEmpty(o,i);++o)e.push(new f(o,i));for(o=t-1;o>=0&&this.board.isFieldEmpty(o,i);--o)e.push(new f(o,i));for(r=i-1;r>=0&&this.board.isFieldEmpty(t,r);--r)e.push(new f(t,r));for(r=i+1;r<8&&this.board.isFieldEmpty(t,r);++r)e.push(new f(t,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0;--o,--r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t-1,r=i+1;o>=0&&r<8;--o,++r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1,r=i-1;o<8&&r>=0;++o,--r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1,r=i+1;o<8&&r<8;++o,++r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1;o<8;++o){if(this.board.isFieldTakenByEnemy(o,i,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,i));break}if(!this.board.isFieldEmpty(o,i))break}for(o=t-1;o>=0;--o){if(this.board.isFieldTakenByEnemy(o,i,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(o,i));break}if(!this.board.isFieldEmpty(o,i))break}for(r=i-1;r>=0;--r){if(this.board.isFieldTakenByEnemy(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(t,r));break}if(!this.board.isFieldEmpty(t,r))break}for(r=i+1;r<8;++r){if(this.board.isFieldTakenByEnemy(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new f(t,r));break}if(!this.board.isFieldEmpty(t,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t+1;o<8;++o){if(!this.board.isFieldEmpty(o,i)){this.board.getPieceByField(o,i)instanceof g||e.push(new f(o,i));break}e.push(new f(o,i))}for(o=t-1;o>=0;--o){if(!this.board.isFieldEmpty(o,i)){this.board.getPieceByField(o,i)instanceof g||e.push(new f(o,i));break}e.push(new f(o,i))}for(var r=i-1;r>=0;--r){if(!this.board.isFieldEmpty(t,r)){this.board.getPieceByField(t,r)instanceof g||e.push(new f(t,r));break}e.push(new f(t,r))}for(r=i+1;r<8;++r){if(!this.board.isFieldEmpty(t,r)){this.board.getPieceByField(t,r)instanceof g||e.push(new f(t,r));break}e.push(new f(t,r))}for(o=t-1,r=i-1;o>=0&&r>=0;--o,--r){if(!this.board.isFieldEmpty(o,r)){this.board.getPieceByField(o,r)instanceof g||e.push(new f(o,r));break}e.push(new f(o,r))}for(o=t-1,r=i+1;o>=0&&r<8;--o,++r){if(!this.board.isFieldEmpty(o,r)){this.board.getPieceByField(o,r)instanceof g||e.push(new f(o,r));break}e.push(new f(o,r))}for(o=t+1,r=i-1;o<8&&r>=0;++o,--r){if(!this.board.isFieldEmpty(o,r)){this.board.getPieceByField(o,r)instanceof g||e.push(new f(o,r));break}e.push(new f(o,r))}for(o=t+1,r=i+1;o<8&&r<8;++o,++r){if(!this.board.isFieldEmpty(o,r)){this.board.getPieceByField(o,r)instanceof g||e.push(new f(o,r));break}e.push(new f(o,r))}return e},t}(u),E={WHITE_KING:{name:"King",icon:"&#x2654;"},WHITE_QUEEN:{name:"Queen",icon:"&#x2655;"},WHITE_KNIGHT:{name:"Knight",icon:"&#x2658"},WHITE_ROOK:{name:"Rook",icon:"&#x2656"},WHITE_PAWN:{name:"Pawn",icon:"&#x2659"},WHITE_BISHOP:{name:"Bishop",icon:"&#x2657"},BLACK_KING:{name:"King",icon:"&#x265A"},BLACK_QUEEN:{name:"Queen",icon:"&#x265B"},BLACK_KNIGHT:{name:"Knight",icon:"&#x265E"},BLACK_ROOK:{name:"Rook",icon:"&#x265C"},BLACK_PAWN:{name:"Pawn",icon:"&#x265F"},BLACK_BISHOP:{name:"Bishop",icon:"&#x265D"}},C=function(){function e(){}return e.prototype.process=function(e,t){var i=e;if(!e)throw Error("Incorrect FEN provided");t.board.reverted=!1,t.board.pieces=[];for(var o=i.split("/"),r=0;r<8;++r)for(var n=0,s=0;s<o[r].split(" ")[0].length;++s){var a=o[r].charAt(s);if(a.match(/[0-9]/))n+=Number(a);else{switch(a){case"r":t.board.pieces.push(new b(new f(r,n),d.BLACK,E.BLACK_ROOK,t.board));break;case"n":t.board.pieces.push(new v(new f(r,n),d.BLACK,E.BLACK_KNIGHT,t.board));break;case"b":t.board.pieces.push(new y(new f(r,n),d.BLACK,E.BLACK_BISHOP,t.board));break;case"q":t.board.pieces.push(new P(new f(r,n),d.BLACK,E.BLACK_QUEEN,t.board));break;case"k":t.board.pieces.push(new g(new f(r,n),d.BLACK,E.BLACK_KING,t.board));break;case"p":((c=new w(new f(r,n),d.BLACK,E.BLACK_PAWN,t.board)).color===d.BLACK&&1!==c.point.row||c.color===d.WHITE&&6!==c.point.row)&&(c.isMovedAlready=!0),t.board.pieces.push(c);break;case"R":t.board.pieces.push(new b(new f(r,n),d.WHITE,E.WHITE_ROOK,t.board));break;case"N":t.board.pieces.push(new v(new f(r,n),d.WHITE,E.WHITE_KNIGHT,t.board));break;case"B":t.board.pieces.push(new y(new f(r,n),d.WHITE,E.WHITE_BISHOP,t.board));break;case"Q":t.board.pieces.push(new P(new f(r,n),d.WHITE,E.WHITE_QUEEN,t.board));break;case"K":t.board.pieces.push(new g(new f(r,n),d.WHITE,E.WHITE_KING,t.board));break;case"P":var c;((c=new w(new f(r,n),d.WHITE,E.WHITE_PAWN,t.board)).color===d.BLACK&&1!==c.point.row||c.color===d.WHITE&&6!==c.point.row)&&(c.isMovedAlready=!0),t.board.pieces.push(c)}++n}}this.setCurrentPlayer(t.board,i),this.setCastles(t.board,i),this.setEnPassant(i),this.setFullMoveCount(i),t.board.fen=i},e.prototype.setCurrentPlayer=function(e,t){if(t){var i=t.split(" ");e.currentWhitePlayer="w"===i[1]}},e.prototype.setCastles=function(e,t){if(t){var i=t.split(" ")[2];i.includes("K")||this.setRookAlreadyMoved(e,d.WHITE,7),i.includes("Q")||this.setRookAlreadyMoved(e,d.WHITE,0),i.includes("k")||this.setRookAlreadyMoved(e,d.BLACK,7),i.includes("q")||this.setRookAlreadyMoved(e,d.BLACK,0)}},e.prototype.setFullMoveCount=function(e){},e.prototype.setEnPassant=function(e){if(e&&"-"===e.split(" ")[3])return},e.prototype.setRookAlreadyMoved=function(e,t,i){var o=e.pieces.find((function(e){return e.color===t&&e instanceof b&&e.point.col===i}));o&&(o.isMovedAlready=!0)},e}(),I=function(){function e(e,t,i){this._xAxis=e,this._yAxis=t,this._reverted=i}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},set:function(e){this._xAxis=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},set:function(e){this._yAxis=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reverted",{get:function(){return this._reverted},set:function(e){this._reverted=e},enumerable:!1,configurable:!0}),e}(),m=function(){function e(){}return e.willMoveCauseCheck=function(e,t,i,o,r,n){var s=n.getPieceByField(t,i),a=n.getPieceByField(o,r);s&&(s.point.row=o,s.point.col=r),a&&(n.pieces=n.pieces.filter((function(e){return e!==a})));var c=n.isKingInCheck(e,n.pieces);return s&&(s.point.col=i,s.point.row=t),a&&n.pieces.push(a),c},e.format=function(e,t,i){if(i){var o=104-e.col,r=104-t.col;return String.fromCharCode(o)+(e.row+1)+String.fromCharCode(r)+(t.row+1)}return String.fromCharCode(e.col+97)+(Math.abs(e.row-7)+1)+String.fromCharCode(t.col+97)+(Math.abs(t.row-7)+1)},e.translateCoordsToIndex=function(e,t){var i,o;return t?(i=104-e.charCodeAt(0),o=+e.charAt(1)-1):(i=e.charCodeAt(0)-97,o=Math.abs(+e.charAt(1)-8)),new I(i,o,t)},e.findPieceByPossibleMovesContaining=function(t,i,o){var r,n,s,a,l=this.translateCoordsToIndex(t,i.reverted),h=new f(l.yAxis,l.xAxis),d=[];try{for(var p=c(i.pieces.filter((function(e){return e.color===o}))),u=p.next();!u.done;u=p.next()){var b=u.value;try{for(var g=(s=void 0,c(b.getPossibleMoves())),y=g.next();!y.done;y=g.next()){var v=y.value;!e.willMoveCauseCheck(b.color,b.point.row,b.point.col,l.yAxis,l.xAxis,i)&&v.isEqual(h)&&d.push(b)}}catch(e){s={error:e}}finally{try{y&&!y.done&&(a=g.return)&&a.call(g)}finally{if(s)throw s.error}}}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return d},e.findPieceByPossibleCapturesContaining=function(t,i,o){var r,n,s,a,l=this.translateCoordsToIndex(t,i.reverted),h=new f(l.yAxis,l.xAxis),d=[];try{for(var p=c(i.pieces.filter((function(e){return e.color===o}))),u=p.next();!u.done;u=p.next()){var b=u.value;try{for(var g=(s=void 0,c(b.getPossibleCaptures())),y=g.next();!y.done;y=g.next()){var v=y.value;!e.willMoveCauseCheck(b.color,b.point.row,b.point.col,l.yAxis,l.xAxis,i)&&v.isEqual(h)&&d.push(b)}}catch(e){s={error:e}}finally{try{y&&!y.done&&(a=g.return)&&a.call(g)}finally{if(s)throw s.error}}}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return d},e.formatSingle=function(e,t){if(t){var i=104-e.col;return String.fromCharCode(i)+(e.row+1)}return String.fromCharCode(e.col+97)+(Math.abs(e.row-7)+1)},e.getFirstLetterPiece=function(e){return e instanceof w?"P":e instanceof v?"N":e instanceof y?"B":e instanceof b?"R":e instanceof g?"K":e instanceof P?"Q":""},e.reverse=function(e,t){return e.reverted?t+1:Math.abs(t-7)+1},e.formatCol=function(e,t){return e.reverted?String.fromCharCode(104-t):String.fromCharCode(97+t)},e}(),k=function(){function e(){}return e.loadDefaultPieces=function(e){e.pieces=[];for(var t=0;t<8;++t)e.pieces.push(new w(new f(1,t),d.BLACK,E.BLACK_PAWN,e));e.pieces.push(new b(new f(0,0),d.BLACK,E.BLACK_ROOK,e)),e.pieces.push(new v(new f(0,1),d.BLACK,E.BLACK_KNIGHT,e)),e.pieces.push(new y(new f(0,2),d.BLACK,E.BLACK_BISHOP,e)),e.pieces.push(new P(new f(0,3),d.BLACK,E.BLACK_QUEEN,e)),e.pieces.push(new g(new f(0,4),d.BLACK,E.BLACK_KING,e)),e.pieces.push(new y(new f(0,5),d.BLACK,E.BLACK_BISHOP,e)),e.pieces.push(new v(new f(0,6),d.BLACK,E.BLACK_KNIGHT,e)),e.pieces.push(new b(new f(0,7),d.BLACK,E.BLACK_ROOK,e));for(t=0;t<8;++t)e.pieces.push(new w(new f(6,t),d.WHITE,E.WHITE_PAWN,e));e.pieces.push(new b(new f(7,0),d.WHITE,E.WHITE_ROOK,e)),e.pieces.push(new v(new f(7,1),d.WHITE,E.WHITE_KNIGHT,e)),e.pieces.push(new y(new f(7,2),d.WHITE,E.WHITE_BISHOP,e)),e.pieces.push(new P(new f(7,3),d.WHITE,E.WHITE_QUEEN,e)),e.pieces.push(new g(new f(7,4),d.WHITE,E.WHITE_KING,e)),e.pieces.push(new y(new f(7,5),d.WHITE,E.WHITE_BISHOP,e)),e.pieces.push(new v(new f(7,6),d.WHITE,E.WHITE_KNIGHT,e)),e.pieces.push(new b(new f(7,7),d.WHITE,E.WHITE_ROOK,e)),e.calculateFEN()},e}(),F=function(){function e(){}return e.prototype.process=function(e,t){var i,o,r=this;if(e){t.board.reverted=!1,t.board.pieces=[],t.reset(),k.loadDefaultPieces(t.board);var n=this.extractMoves(e),s=-1,a=function(e){++s;var i="";(e=e.replace(/[+#]/g,"")).includes("=")&&(i=l.resolvePromotion(e.substring(e.length-1)),e=e.substring(0,e.length-2));var o=0===s||s%2==0?d.WHITE:d.BLACK;if(/^[a-z]\d$/g.test(e))(a=m.findPieceByPossibleMovesContaining(e,t.board,o).find((function(e){return e instanceof w})))||(a=m.findPieceByPossibleCapturesContaining(e,t.board,o).find((function(e){return e instanceof w}))),a&&t.move(m.formatSingle(a.point,!1)+e+i);else if(/^[A-Z][a-h]\d$/g.test(e))(a=(n=m.findPieceByPossibleMovesContaining(e.substring(1),t.board,o)).find((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)})))&&t.move(m.formatSingle(a.point,!1)+e.substring(1)+i);else if("O-O"===e)t.move(o===d.WHITE?"e1g1":"e8g8");else if(/^[a-z]x[a-z]\d$/g.test(e)){var n=m.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,o).filter((function(e){return e instanceof w})),a=void 0;(a=n.length>1?l.resolveByCol(n,e.substring(0,1)):n[0])&&t.move(m.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+i)}else{if(/^[A-Z]x[a-z]\d$/g.test(e))(a=m.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,o).find((function(t){return r.resolvePieceByFirstChar(e.substring(0,1),t)})))&&t.move(m.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+i);else if("O-O-O"===e)t.move(o===d.WHITE?"e1c1":"e8c8");else if(/^[A-Z]\dx[a-z]\d$/g.test(e)){n=m.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,o).filter((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)}));(a=l.resolveByRow(n,e.substring(1,2)))&&t.move(m.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+i)}else if(/^[A-Z][a-z][a-z]\d$/g.test(e)){n=m.findPieceByPossibleMovesContaining(e.substring(2,4),t.board,o).filter((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)}));(a=l.resolveByCol(n,e.substring(1,2)))&&t.move(m.formatSingle(a.point,!1)+e.substring(2,4)+i)}else if(/^[A-Z][a-z]x[a-z]\d$/g.test(e)){n=m.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,o).filter((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)}));(a=l.resolveByCol(n,e.substring(1,2)))&&t.move(m.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+i)}else l.processR1f2(e,t,o,i)}},l=this;try{for(var h=c(n),p=h.next();!p.done;p=h.next()){a(p.value)}}catch(e){i={error:e}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}}},e.prototype.processR1f2=function(e,t,i,o){var r=this;if(/^[A-Z]\d[a-z]\d$/g.test(e)){var n=m.findPieceByPossibleMovesContaining(e.substring(2,4),t.board,i).filter((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)})),s=this.resolveByRow(n,e.substring(1,2));s&&t.move(m.formatSingle(s.point,!1)+e.substring(2,4)+o)}},e.prototype.extractMoves=function(e){return e.substring(e.lastIndexOf("]")+1).replace(/[0-9]+\./g,"").replace(/\s+/g," ").replace(/{[^}]*}/g,"").trim().split(" ").filter((function(e){return e}))},e.prototype.movePiece=function(e,t,i){var o=m.translateCoordsToIndex(i,t.reverted);e.point.col=o.xAxis,e.point.row=o.yAxis},e.prototype.hasUpperCase=function(e){return/[A-Z]/.test(e)},e.prototype.resolvePieceByFirstChar=function(e,t){var i="";return t instanceof g?i="K":t instanceof P?i="Q":t instanceof b?i="R":t instanceof y?i="B":t instanceof v?i="N":t instanceof w&&(i="P"),e===i},e.prototype.isShortCastle=function(e){return"O-O"===e},e.prototype.removePiece=function(e,t){var i=m.translateCoordsToIndex(e,t.reverted);t.pieces=t.pieces.filter((function(e){return!e.point.isEqual(new f(i.yAxis,i.xAxis))}))},e.prototype.isLongCastle=function(e){return"O-O-O"===e},e.prototype.resolveByCol=function(e,t){var i=m.formatSingle(e[0].point,!1);m.formatSingle(e[1].point,!1);return i.substring(0,1)===t?e[0]:e[1]},e.prototype.resolveByRow=function(e,t){var i=m.formatSingle(e[0].point,!1);m.formatSingle(e[1].point,!1);return i.substring(1,2)===t?e[0]:e[1]},e.prototype.replacePromotion=function(e){return e.replace("=Q","1").replace("=R","2").replace("=B","3").replace("=K","4")},e.prototype.resolvePromotion=function(e){switch(e){case"Q":return"1";case"R":return"2";case"B":return"3";case"N":return"4"}return""},e}(),A=function(){function e(){}return e.getProcessor=function(e){switch(e){case p.FEN:return new C;case p.PGN:return new F}},e.getDefaultProcessor=function(){return new C},e}();!function(e){e[e.FEN=1]="FEN",e[e.PGN=2]="PGN"}(p||(p={}));var T=function(){function e(e,t,i){this.x=e+.5,this.y=t+.5,this.color=i}return e.prototype.isEqual=function(e){return e&&e.x===this.x&&this.y===e.y},e}(),B=function(){function e(){}return e.getClickPoint=function(e,t,i,o,r){return new f(Math.floor((e.y-t)/(i/8)),Math.floor((e.x-o)/(r/8)))},e.getDrawingPoint=function(e,t,i,o,r,n,s,a,c){var l=e/8,h=Math.floor((i-a)/l),d=Math.floor((o-c)/l),p=t.resolve(r,s,n);return new T(Math.floor(h*l+l/2),Math.floor(d*l+l/2),p)},e}(),x=function(){function e(e,t,i,o){this.move=e,this.piece=t,this.color=i,this.x=o}return e.prototype.setGameStates=function(e,t,i){this.check=e,this.stalemate=t,this.mate=i},e}(),H=function(){function e(){this.historyMovesSubject$=new r.BehaviorSubject([])}return Object.defineProperty(e.prototype,"historyMoves",{get:function(){return this.historyMovesSubject$.value},set:function(e){this.historyMovesSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addMove=function(e){this.historyMoves=h(this.historyMoves,[e])},e.prototype.pop=function(){var e=this.getLastMove();return this.historyMoves=this.historyMoves.filter((function(t){return t!==e})),e},e.prototype.getAll=function(){return this.historyMoves},e.prototype.clear=function(){this.historyMoves=[]},e.prototype.getLastMove=function(){return this.historyMoves[this.getLastMoveIndex()]},e.prototype.getLastMoveIndex=function(){return this.historyMoves.length-1},e}(),W=function(){};W.DEFAULT_DARK_TILE_COLOR="rgb(97, 84, 61)",W.DEFAULT_LIGHT_TILE_COLOR="#BAA378",W.DEFAULT_SIZE=500,W.MIN_BOARD_SIZE=100,W.MAX_BOARD_SIZE=4e3,W.DEFAULT_SOURCE_POINT_COLOR="rgba(146, 111, 26, 0.79)",W.DEFAULT_DESTINATION_POINT_COLOR="#b28e1a",W.DEFAULT_LEGAL_MOVE_POINT_COLOR="radial-gradient(#13262F 15%, transparent 20%);";var K,M,L=function(){function e(){this._defaultIcons=!1}return Object.defineProperty(e.prototype,"pieceIconInput",{get:function(){return this._pieceIconInput},set:function(e){this._pieceIconInput=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultIcons",{get:function(){return this._defaultIcons},set:function(e){this._defaultIcons=e},enumerable:!1,configurable:!0}),e.prototype.isDefaultIcons=function(){return void 0===this.pieceIconInput||null===this.pieceIconInput},e.prototype.getPieceIcon=function(e){var t=e.color===d.WHITE;switch(e.constructor){case g:return t?this.pieceIconInput.whiteKingUrl:this.pieceIconInput.blackKingUrl;case P:return t?this.pieceIconInput.whiteQueenUrl:this.pieceIconInput.blackQueenUrl;case b:return t?this.pieceIconInput.whiteRookUrl:this.pieceIconInput.blackRookUrl;case y:return t?this.pieceIconInput.whiteBishopUrl:this.pieceIconInput.blackBishopUrl;case v:return t?this.pieceIconInput.whiteKnightUrl:this.pieceIconInput.blackKnightUrl;case w:return t?this.pieceIconInput.whitePawnUrl:this.pieceIconInput.blackPawnUrl}},e.prototype.loadDefaultData=function(){this.pieceIconInput={blackBishopUrl:"",blackKingUrl:"",blackKnightUrl:"",blackQueenUrl:"",blackRookUrl:"",whiteBishopUrl:"",whiteKingUrl:"",whiteKnightUrl:"",whitePawnUrl:"",whiteQueenUrl:"",whiteRookUrl:"",blackPawnUrl:"a"}},e}(),S=function(){function e(){this.defaultXCoords=["a","b","c","d","e","f","g","h"],this.defaultYCoords=[8,7,6,5,4,3,2,1],this.currentXCoords=h(this.defaultXCoords),this.currentYCoords=h(this.defaultYCoords)}return Object.defineProperty(e.prototype,"xCoords",{get:function(){return this.currentXCoords},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yCoords",{get:function(){return this.currentYCoords},enumerable:!1,configurable:!0}),e.prototype.reverse=function(){this.currentXCoords=this.currentXCoords.reverse(),this.currentYCoords=this.currentYCoords.reverse()},e.prototype.reset=function(){this.init()},e.prototype.init=function(){this.currentXCoords=h(this.defaultXCoords),this.currentYCoords=h(this.defaultYCoords)},e}(),O=function(){function e(){}return e.prototype.dragEnded=function(e,t,i){t||i&&(e.source._dragRef.getRootElement().style.transform=i)},e}(),_=function(){function e(){this.dragEndProcessor=new O}return e.prototype.process=function(e,t,i){this.dragEndProcessor.dragEnded(e,t,i)},e.prototype.setDragEndProcessor=function(e){this.dragEndProcessor=e},e}(),N=function(){function e(){}return e.prototype.dragStarted=function(e){var t=e.source.getRootElement().style;t.zIndex="1000",t.position="absolute"},e}(),D=function(){function e(){this.dragStartProcessor=new N}return e.prototype.process=function(e){this.dragStartProcessor.dragStarted(e)},e.prototype.setDragStartProcessor=function(e){this.dragStartProcessor=e},e}(),R=function(){function e(){}return e.prototype.resolve=function(e,t,i){var o="green";return(e||t)&&(o="red"),i&&(o="blue"),(t||e)&&i&&(o="orange"),o},e}(),U=function(){function e(){this.colorProcessor=new R}return e.prototype.resolve=function(e,t,i){return this.colorProcessor.resolve(e,t,i)},e.prototype.setColorProcessor=function(e){this.colorProcessor=e},e}(),j=function(){function e(){this.arrowsSubject$=new r.BehaviorSubject([]),this.circlesSubject$=new r.BehaviorSubject([]),this.arrows$=this.arrowsSubject$.asObservable(),this.circles$=this.circlesSubject$.asObservable()}return Object.defineProperty(e.prototype,"circles",{get:function(){return this.circlesSubject$.value},set:function(e){this.circlesSubject$.next(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"arrows",{get:function(){return this.arrowsSubject$.value},set:function(e){this.arrowsSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addCircle=function(e){this.circles=h(this.circles,[e])},e.prototype.reomveCircle=function(e){this.circles=this.circles.filter((function(t){return!t.isEqual(e)}))},e.prototype.addArrow=function(e){this.arrows=h(this.arrows,[e])},e.prototype.removeArrow=function(e){this.arrows=this.arrows.filter((function(t){return!t.isEqual(e)}))},e.prototype.containsCircle=function(e){return this.circles.some((function(t){return t.isEqual(e)}))},e.prototype.containsArrow=function(e){return this.arrows.some((function(t){return t.isEqual(e)}))},e.prototype.clear=function(){this.arrows=[],this.circles=[]},e}(),z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.process=function(e,t,i,o){this.currentIndex+=.5,this.pgn+=this.currentIndex%Math.floor(this.currentIndex)==0?" "+this.currentIndex+". ":" ";var r,n=[];o&&(n=m.findPieceByPossibleCapturesContaining(m.formatSingle(i,e.reverted),e,t.color).filter((function(e){return e.constructor.name===t.constructor.name}))),r=m.findPieceByPossibleMovesContaining(m.formatSingle(i,e.reverted),e,t.color).filter((function(e){return e.constructor.name===t.constructor.name})),t instanceof w&&!o&&0===n.length?this.pgn+=m.formatSingle(i,e.reverted):t instanceof w&&o?this.pgn+=m.formatSingle(t.point,e.reverted).substring(0,1)+"x"+m.formatSingle(i,e.reverted):t instanceof g&&2===Math.abs(t.point.col-i.col)?e.reverted?this.pgn+=i.col<2?"O-O":"O-O-O":this.pgn+=i.col<3?"O-O-O":"O-O":!(t instanceof w)&&0===n.length&&r.length<2?this.pgn+=m.getFirstLetterPiece(t)+m.formatSingle(i,e.reverted):r&&2===r.length&&0===n.length?this.isEqualByCol(r[0],r[1])?this.pgn+=m.getFirstLetterPiece(t)+m.reverse(e,t.point.row)+m.formatSingle(i,e.reverted):this.pgn+=m.getFirstLetterPiece(t)+m.formatCol(e,t.point.col)+m.formatSingle(i,e.reverted):n.length>1?this.isEqualByCol(n[0],n[1])?this.pgn+=m.getFirstLetterPiece(t)+m.reverse(e,t.point.row)+"x"+m.formatSingle(i,e.reverted):this.pgn+=m.getFirstLetterPiece(t)+m.formatCol(e,t.point.col)+"x"+m.formatSingle(i,e.reverted):this.pgn+=m.getFirstLetterPiece(t)+"x"+m.formatSingle(i,e.reverted),this.pgn=this.pgn.trim()},t.prototype.resolvePieceByFirstChar=function(e,t){return m.getFirstLetterPiece(t)===e},t.prototype.isEqualByCol=function(e,t){return e.point.col===t.point.col},t}(function(){function e(){this.pgn="",this.currentIndex=.5}return e.prototype.getPGN=function(){return this.pgn},e.prototype.processChecks=function(e,t,i){e?this.pgn+="#":t&&(this.pgn+="+")},e.prototype.reset=function(){this.pgn="",this.currentIndex=.5},e.prototype.addPromotionChoice=function(e){switch(e){case 1:this.pgn+="=Q";break;case 2:this.pgn+="=R";break;case 3:this.pgn+="=B";break;case 4:this.pgn+="=N"}},e.prototype.removeLast=function(){if(this.currentIndex>=.5){this.currentIndex-=.5;var e=new RegExp(/\d+\./g);e.test(this.pgn),this.pgn=this.pgn.substring(0,e.lastIndex).trim()}},e}()),G=function(){function e(e){this.dragStartStrategy=new D,this.dragEndStrategy=new _,this.pgnProcessor=new z,this.colorStrategy=new U,this.coords=new S,this.heightAndWidth=W.DEFAULT_SIZE,this.freeMode=!1,this.drawProvider=new j,this.pieceIconManager=new L,this.moveHistoryProvider=new H,this.disabling=!1,this.board=e}return e.prototype.checkIfPawnFirstMove=function(e){e instanceof w&&(e.isMovedAlready=!0)},e.prototype.checkIfRookMoved=function(e){e instanceof b&&(e.isMovedAlready=!0)},e.prototype.checkIfKingMoved=function(e){e instanceof g&&(e.isMovedAlready=!0)},e.prototype.getMoveHistory=function(){return this.moveHistoryProvider.getAll()},e}(),q=function(){function e(e,t){this.engineFacade=e,this.notationProcessor=t||A.getDefaultProcessor()}return e.prototype.addPieces=function(){k.loadDefaultPieces(this.engineFacade.board)},e.prototype.loadFEN=function(e){this.notationProcessor.process(e,this.engineFacade)},e.prototype.loadPGN=function(e){this.notationProcessor.process(e,this.engineFacade)},e.prototype.setEngineFacade=function(e){this.engineFacade=e},e.prototype.setNotationProcessor=function(e){this.notationProcessor=e},e}(),$=function(e){this.board=e},Q=function(){function e(){this.statesSubject$=new r.BehaviorSubject([])}return Object.defineProperty(e.prototype,"states",{get:function(){return this.statesSubject$.value},set:function(e){this.statesSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addMove=function(e){this.states=h(this.states,[e])},e.prototype.getStates=function(){return this.states},e.prototype.pop=function(){var e=this.getLastState();return this.states=this.states.filter((function(t){return t!==e})),e},e.prototype.isEmpty=function(){return 0===this.states.length},e.prototype.clear=function(){this.states=[]},e.prototype.getLastState=function(){return this.states[this.getLastStateIndex()]},e.prototype.getLastStateIndex=function(){return this.states.length-1},e}(),X=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.start.isEqual(e.start)&&this.end.isEqual(e.end)},e}(),Y=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.drawPoint.isEqual(e.drawPoint)},e}(),Z=function(e){function t(t,i,o,r){var n=e.call(this,t)||this;return n.pointClicked=i,n.color=o,n.board=r,n}return a(t,e),t.prototype.getPossibleCaptures=function(){var e=this;return this.piece.getPossibleCaptures().filter((function(t){return!m.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t.prototype.getPossibleMoves=function(){var e=this;return this.piece.getPossibleMoves().filter((function(t){return!m.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t}((function(e){this.piece=e})),V=function(){function e(){}return e.resolvePromotionChoice=function(e,t,i){var o=t.color===d.WHITE;switch(i){case 1:e.pieces.push(new P(t.point,t.color,o?E.WHITE_QUEEN:E.BLACK_QUEEN,e));break;case 2:e.pieces.push(new b(t.point,t.color,o?E.WHITE_ROOK:E.BLACK_ROOK,e));break;case 3:e.pieces.push(new y(t.point,t.color,o?E.WHITE_BISHOP:E.BLACK_BISHOP,e));break;case 4:e.pieces.push(new v(t.point,t.color,o?E.WHITE_KNIGHT:E.BLACK_KNIGHT,e))}},e}();!function(e){e[e.KING=1]="KING",e[e.QUEEN=2]="QUEEN",e[e.BISHOP=3]="BISHOP",e[e.KNIGHT=4]="KNIGHT",e[e.ROOK=5]="ROOK",e[e.PAWN=6]="PAWN"}(K||(K={})),function(e){e[e.LIGHT=1]="LIGHT",e[e.DARK=2]="DARK"}(M||(M={}));var J=function(){function e(){}return e.create=function(e,t,i,o){var r,n=i===M.LIGHT?d.WHITE:d.BLACK;switch(t){case K.QUEEN:r=new P(new f(e.yAxis,e.xAxis),n,n===d.WHITE?E.WHITE_QUEEN:E.BLACK_QUEEN,o);break;case K.KING:r=new g(new f(e.yAxis,e.xAxis),n,n===d.WHITE?E.WHITE_KING:E.BLACK_KING,o);break;case K.KNIGHT:r=new v(new f(e.yAxis,e.xAxis),n,n===d.WHITE?E.WHITE_KNIGHT:E.BLACK_KNIGHT,o);break;case K.BISHOP:r=new y(new f(e.yAxis,e.xAxis),n,n===d.WHITE?E.WHITE_BISHOP:E.BLACK_BISHOP,o);break;case K.ROOK:r=new b(new f(e.yAxis,e.xAxis),n,n===d.WHITE?E.WHITE_ROOK:E.BLACK_ROOK,o);break;case K.PAWN:r=new w(new f(e.yAxis,e.xAxis),n,n===d.WHITE?E.WHITE_PAWN:E.BLACK_PAWN,o)}return r},e}(),ee=function(e){function t(t,i){var o=e.call(this,t)||this;return o._selected=!1,o.moveChange=i,o.boardLoader=new q(o),o.boardLoader.addPieces(),o.boardStateProvider=new Q,o}return a(t,e),t.prototype.reset=function(){this.boardStateProvider.clear(),this.moveHistoryProvider.clear(),this.boardLoader.addPieces(),this.board.reset(),this.coords.reset(),this.drawProvider.clear(),this.pgnProcessor.reset()},t.prototype.undo=function(){if(!this.boardStateProvider.isEmpty()){var e=this.boardStateProvider.pop().board;this.board.reverted&&e.reverse(),this.board=e,this.board.possibleCaptures=[],this.board.possibleMoves=[],this.board.activePiece=null,this.moveHistoryProvider.pop(),this.board.calculateFEN(),this.pgnProcessor.removeLast()}},t.prototype.saveMoveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.moveStateProvider.addMove(new $(e))},t.prototype.move=function(e){if(e){var t=m.translateCoordsToIndex(e.substring(0,2),this.board.reverted),i=m.translateCoordsToIndex(e.substring(2,4),this.board.reverted),o=this.board.getPieceByPoint(t.yAxis,t.xAxis);if(o){if(this.board.currentWhitePlayer&&o.color===d.BLACK||!this.board.currentWhitePlayer&&o.color===d.WHITE)return;this.prepareActivePiece(o,o.point),this.board.isPointInPossibleMoves(new f(i.yAxis,i.xAxis))||this.board.isPointInPossibleCaptures(new f(i.yAxis,i.xAxis))?(this.saveClone(),this.movePiece(o,new f(i.yAxis,i.xAxis),5===e.length?+e.substring(4,5):0),this.board.lastMoveSrc=new f(t.yAxis,t.xAxis),this.board.lastMoveDest=new f(i.yAxis,i.xAxis),this.disableSelection()):this.disableSelection()}}},t.prototype.prepareActivePiece=function(e,t){this.board.activePiece=e,this._selected=!0,this.board.possibleCaptures=new Z(e,t,this.board.currentWhitePlayer?d.WHITE:d.BLACK,this.board).getPossibleCaptures(),this.board.possibleMoves=new Z(e,t,this.board.currentWhitePlayer?d.WHITE:d.BLACK,this.board).getPossibleMoves()},t.prototype.onPieceClicked=function(e,t){this.board.currentWhitePlayer&&e.color===d.BLACK||!this.board.currentWhitePlayer&&e.color===d.WHITE||this.prepareActivePiece(e,t)},t.prototype.handleClickEvent=function(e,t){var i=!1;(this.board.isPointInPossibleMoves(e)||this.board.isPointInPossibleCaptures(e)||this.freeMode)&&e.isInRange()&&(this.saveClone(),this.board.lastMoveSrc=new f(this.board.activePiece.point.row,this.board.activePiece.point.col),this.board.lastMoveDest=e.clone(),this.movePiece(this.board.activePiece,e),this.board.activePiece.point.isEqual(this.board.lastMoveSrc)||(i=!0)),(t||i)&&this.disableSelection(),this.disableSelection();var o=this.board.getPieceByPoint(e.row,e.col);o&&!i&&(this.onFreeMode(o),this.onPieceClicked(o,e))},t.prototype.onMouseDown=function(e,t,i,o){if(this.moveDone=!1,0===e.button)if(this.drawProvider.clear(),this.board.activePiece&&t.isEqual(this.board.activePiece.point))this.disabling=!0;else{var r=this.board.getPieceByPoint(t.row,t.col);if(this.freeMode&&r){if(e.ctrlKey)return void(this.board.pieces=this.board.pieces.filter((function(e){return e!==r})));this.board.currentWhitePlayer=r.color===d.WHITE}this.isPieceDisabled(r)||(this._selected?this.handleClickEvent(t,!0):r&&(this.onFreeMode(r),this.onPieceClicked(r,t)))}else this.drawPoint=B.getDrawingPoint(this.heightAndWidth,this.colorStrategy,e.x,e.y,e.ctrlKey,e.altKey,e.shiftKey,i,o)},t.prototype.onMouseUp=function(e,t,i,o){if(this.moveDone=!1,0===e.button||this.drawDisabled){if(this.drawProvider.clear(),!this.dragDisabled){if(this.board.activePiece&&t.isEqual(this.board.activePiece.point)&&this.disabling)return this.disableSelection(),void(this.disabling=!1);var r=this.board.getPieceByPoint(t.row,t.col);this.isPieceDisabled(r)||this._selected&&this.handleClickEvent(t,!1)}}else this.addDrawPoint(e.x,e.y,e.ctrlKey,e.altKey,e.shiftKey,i,o)},t.prototype.saveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.boardStateProvider.addMove(new $(e))},t.prototype.movePiece=function(e,t,i){var o=this.board.pieces.find((function(e){return e.point.col===t.col&&e.point.row===t.row}));if(this.pgnProcessor.process(this.board,e,t,o),o&&e.color!==o.color)this.board.pieces=this.board.pieces.filter((function(e){return e!==o}));else if(o&&e.color===o.color)return;if((this.historyMoveCandidate=new x(m.format(e.point,t,this.board.reverted),e.constant.name,e.color===d.WHITE?"white":"black",!!o),this.moveHistoryProvider.addMove(this.historyMoveCandidate),e instanceof g)&&Math.abs(t.col-e.point.col)>1)if(t.col<3){var r=this.board.getPieceByField(e.point.row,0);this.freeMode||(r.point.col=this.board.reverted?2:3)}else{var n=this.board.getPieceByField(e.point.row,7);this.freeMode||(n.point.col=this.board.reverted?4:5)}e instanceof w?(this.board.checkIfPawnTakesEnPassant(t),this.board.checkIfPawnEnpassanted(e,t)):(this.board.enPassantPoint=null,this.board.enPassantPiece=null),e.point=t,this.increaseFullMoveCount(),this.board.currentWhitePlayer=!this.board.currentWhitePlayer,this.checkForPawnPromote(e,i)||this.afterMoveActions()},t.prototype.checkForPawnPromote=function(e,t){if(e instanceof w)return 0===e.point.row||7===e.point.row?(this.board.pieces=this.board.pieces.filter((function(t){return t!==e})),t?(V.resolvePromotionChoice(this.board,e,t),this.afterMoveActions(t)):this.openPromoteDialog(e),!0):void 0},t.prototype.afterMoveActions=function(e){this.checkIfPawnFirstMove(this.board.activePiece),this.checkIfRookMoved(this.board.activePiece),this.checkIfKingMoved(this.board.activePiece),this.board.blackKingChecked=this.board.isKingInCheck(d.BLACK,this.board.pieces),this.board.whiteKingChecked=this.board.isKingInCheck(d.WHITE,this.board.pieces);var t=this.board.blackKingChecked||this.board.whiteKingChecked,i=this.checkForPossibleMoves(d.BLACK)||this.checkForPossibleMoves(d.WHITE),o=this.checkForPat(d.BLACK)||this.checkForPat(d.WHITE);this.historyMoveCandidate.setGameStates(t,o,i),this.pgnProcessor.processChecks(i,t,o),this.pgnProcessor.addPromotionChoice(e),this.disabling=!1,this.board.calculateFEN();var r=this.moveHistoryProvider.getLastMove();r&&e&&(r.move+=e),this.moveChange.emit(Object.assign(Object.assign({},r),{check:t,checkmate:i,stalemate:o,fen:this.board.fen,pgn:{pgn:this.pgnProcessor.getPGN()},freeMode:this.freeMode})),this.moveDone=!0},t.prototype.checkForPat=function(e){return(e!==d.WHITE||this.board.whiteKingChecked)&&(e!==d.BLACK||this.board.blackKingChecked)?void 0:this.checkForPossibleMoves(e)},t.prototype.openPromoteDialog=function(e){var t=this;e.color===this.board.activePiece.color&&this.modal.open((function(i){V.resolvePromotionChoice(t.board,e,i),t.afterMoveActions(i)}))},t.prototype.checkForPossibleMoves=function(e){var t=this;return!this.board.pieces.filter((function(t){return t.color===e})).some((function(i){return i.getPossibleMoves().some((function(o){return!m.willMoveCauseCheck(e,i.point.row,i.point.col,o.row,o.col,t.board)}))||i.getPossibleCaptures().some((function(o){return!m.willMoveCauseCheck(e,i.point.row,i.point.col,o.row,o.col,t.board)}))}))},t.prototype.disableSelection=function(){this._selected=!1,this.board.possibleCaptures=[],this.board.activePiece=null,this.board.possibleMoves=[]},t.prototype.onFreeMode=function(e){this.freeMode&&null!=e&&(this.board.currentWhitePlayer=e.color===d.WHITE)},t.prototype.isPieceDisabled=function(e){if(e&&e.point&&this.board.possibleCaptures.find((function(t){return t.col===e.point.col&&t.row===e.point.row})))return!1;return e&&(this.lightDisabled&&e.color===d.WHITE||this.darkDisabled&&e.color===d.BLACK)},t.prototype.addDrawPoint=function(e,t,i,o,r,n,s){var a=B.getDrawingPoint(this.heightAndWidth,this.colorStrategy,e,t,i,o,r,n,s);if(this.drawPoint.isEqual(a)){var c=new Y;c.drawPoint=a,this.drawProvider.containsCircle(c)?this.drawProvider.reomveCircle(c):this.drawProvider.addCircle(c)}else{var l=new X;l.start=this.drawPoint,l.end=a,this.drawProvider.containsArrow(l)?this.drawProvider.removeArrow(l):this.drawProvider.addArrow(l)}},t.prototype.increaseFullMoveCount=function(){this.board.currentWhitePlayer||++this.board.fullMoveCount},t.prototype.addPiece=function(e,t,i){if(this.freeMode&&i&&e>0&&t>0){var o=m.translateCoordsToIndex(i,this.board.reverted),r=this.board.getPieceByPoint(o.yAxis,o.xAxis);r&&(this.board.pieces=this.board.pieces.filter((function(e){return e!==r})));var n=J.create(o,e,t,this.board);this.saveClone(),this.board.pieces.push(n),this.afterMoveActions()}},t}(G),te=function(){function e(){this.board=[],this.pieces=[],this.enPassantPoint=null,this.enPassantPiece=null,this.lastMoveSrc=null,this.lastMoveDest=null,this.possibleCaptures=[],this.possibleMoves=[],this.currentWhitePlayer=!0,this.reverted=!1,this.fullMoveCount=1;for(var e=0;e<8;++e){this.board[e]=[];for(var t=0;t<8;++t)this.board[e][t]=0}}return e.prototype.isXYInPossibleMoves=function(e,t){return this.possibleMoves.some((function(i){return i.row===e&&i.col===t}))},e.prototype.isXYInPossibleCaptures=function(e,t){return this.possibleCaptures.some((function(i){return i.row===e&&i.col===t}))},e.prototype.isXYInSourceMove=function(e,t){return this.lastMoveSrc&&this.lastMoveSrc.row===e&&this.lastMoveSrc.col===t},e.prototype.isXYInDestMove=function(e,t){return this.lastMoveDest&&this.lastMoveDest.row===e&&this.lastMoveDest.col===t},e.prototype.isXYInActiveMove=function(e,t){return this.activePiece&&this.activePiece.point.row===e&&this.activePiece.point.col===t},e.prototype.isPointInPossibleMoves=function(e){return this.possibleMoves.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.isPointInPossibleCaptures=function(e){return this.possibleCaptures.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.reset=function(){this.lastMoveDest=null,this.lastMoveSrc=null,this.whiteKingChecked=!1,this.blackKingChecked=!1,this.possibleCaptures=[],this.possibleMoves=[],this.activePiece=null,this.reverted=!1,this.currentWhitePlayer=!0,this.enPassantPoint=null,this.enPassantPiece=null,this.fullMoveCount=1,this.calculateFEN()},e.prototype.reverse=function(){var e=this;this.reverted=!this.reverted,this.activePiece=null,this.possibleMoves=[],this.possibleCaptures=[],this.pieces.forEach((function(t){return e.reversePoint(t.point)})),this.reversePoint(this.lastMoveSrc),this.reversePoint(this.lastMoveDest),this.enPassantPoint&&this.enPassantPiece&&this.reversePoint(this.enPassantPoint)},e.prototype.clone=function(){return n.cloneDeep(this)},e.prototype.isFieldTakenByEnemy=function(e,t,i){return!(e>7||e<0||t>7||t<0)&&this.pieces.some((function(o){return o.point.col===t&&o.point.row===e&&o.color===i}))},e.prototype.isFieldEmpty=function(e,t){return!(e>7||e<0||t>7||t<0)&&!this.pieces.some((function(i){return i.point.col===t&&i.point.row===e}))},e.prototype.isFieldUnderAttack=function(e,t,i){return this.pieces.filter((function(e){return e.color===i})).some((function(i){return i.getCoveredFields().some((function(i){return i.col===t&&i.row===e}))}))},e.prototype.getPieceByField=function(e,t){if(!this.isFieldEmpty(e,t))return this.pieces.find((function(i){return i.point.col===t&&i.point.row===e}))},e.prototype.isKingInCheck=function(e,t){var i=t.find((function(t){return t.color===e&&t instanceof g}));return!!i&&t.some((function(t){return t.getPossibleCaptures().some((function(e){return e.col===i.point.col&&e.row===i.point.row}))&&t.color!==e}))},e.prototype.getKingByColor=function(e){return this.pieces.find((function(t){return t instanceof g&&t.color===e}))},e.prototype.getCastleFENString=function(e){var t=this.getKingByColor(e);if(!t||t.isMovedAlready)return"";var i="",o=this.getPieceByField(t.point.row,0),r=this.getPieceByField(t.point.row,7);return r instanceof b&&r.color===e&&(r.isMovedAlready||(i+=this.reverted?"q":"k")),o instanceof b&&o.color===e&&(o.isMovedAlready||(i+=this.reverted?"k":"q")),i=i.split("").sort().join(""),e===d.BLACK?i:i.toUpperCase()},e.prototype.getEnPassantFENString=function(){return this.enPassantPoint?this.reverted?String.fromCharCode(104-this.enPassantPoint.col)+(this.enPassantPoint.row+1):String.fromCharCode(97+this.enPassantPoint.col)+(Math.abs(this.enPassantPoint.row-7)+1):"-"},e.prototype.calculateFEN=function(){for(var e="",t=function(t){for(var o=0,r=function(r){var n=i.pieces.find((function(e){return e.point.col===r&&e.point.row===t}));n?(o>0&&(e+=o,o=0),n instanceof b?e+=n.color===d.BLACK?"r":"R":n instanceof v?e+=n.color===d.BLACK?"n":"N":n instanceof y?e+=n.color===d.BLACK?"b":"B":n instanceof P?e+=n.color===d.BLACK?"q":"Q":n instanceof g?e+=n.color===d.BLACK?"k":"K":n instanceof w&&(e+=n.color===d.BLACK?"p":"P")):++o},n=0;n<8;++n)r(n);o>0&&(e+=o),e+="/"},i=this,o=0;o<8;++o)t(o);e=e.substr(0,e.length-1),this.reverted&&(e=e.split("").reverse().join("")),e+=" "+(this.currentWhitePlayer?"w":"b");var r=this.getCastleFENString(d.WHITE)+this.getCastleFENString(d.BLACK);r||(r="-"),e+=" "+r,e+=" "+this.getEnPassantFENString(),e+=" 0",e+=" "+this.fullMoveCount,this.fen=e},e.prototype.isXYInPointSelection=function(e,t){return!1},e.prototype.reversePoint=function(e){e&&(e.row=Math.abs(e.row-7),e.col=Math.abs(e.col-7))},e.prototype.getPieceByPoint=function(e,t){return e=Math.floor(e),t=Math.floor(t),this.pieces.find((function(i){return i.point.col===t&&i.point.row===e}))},e.prototype.checkIfPawnTakesEnPassant=function(e){var t=this;e.isEqual(this.enPassantPoint)&&(this.pieces=this.pieces.filter((function(e){return e!==t.enPassantPiece})),this.enPassantPoint=null,this.enPassantPiece=null)},e.prototype.checkIfPawnEnpassanted=function(e,t){Math.abs(e.point.row-t.row)>1?(this.enPassantPiece=e,this.enPassantPoint=new f((e.point.row+t.row)/2,e.point.col)):(this.enPassantPoint=null,this.enPassantPiece=null)},e.prototype.isKingChecked=function(e){if(e instanceof g)return e.color===d.WHITE?this.whiteKingChecked:this.blackKingChecked},e.prototype.getCurrentPlayerColor=function(){return this.currentWhitePlayer?d.WHITE:d.BLACK},e}(),ie=function(){function e(){this.componentMethodCallSource=new r.Subject,this.componentMethodCalled$=this.componentMethodCallSource.asObservable()}return e.prototype.reset=function(){this.componentMethodCallSource.next()},e}();ie.prov=o.defineInjectable({factory:function(){return new ie},token:ie,providedIn:"root"}),ie.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}];var oe=function(){function e(e){this.ngxChessBoardService=e,this.darkTileColor=W.DEFAULT_DARK_TILE_COLOR,this.lightTileColor=W.DEFAULT_LIGHT_TILE_COLOR,this.showCoords=!0,this.sourcePointColor=W.DEFAULT_SOURCE_POINT_COLOR,this.destinationPointColor=W.DEFAULT_DESTINATION_POINT_COLOR,this.legalMovesPointColor=W.DEFAULT_LEGAL_MOVE_POINT_COLOR,this.showLastMove=!0,this.showLegalMoves=!0,this.showActivePiece=!0,this.showPossibleCaptures=!0,this.moveChange=new o.EventEmitter,this.checkmate=new o.EventEmitter,this.stalemate=new o.EventEmitter,this.selected=!1,this.isDragging=!1,this.startTransition="",this.engineFacade=new ee(new te,this.moveChange)}return Object.defineProperty(e.prototype,"size",{set:function(e){e&&e>=W.MIN_BOARD_SIZE&&e<=W.MAX_BOARD_SIZE?this.engineFacade.heightAndWidth=e:this.engineFacade.heightAndWidth=W.DEFAULT_SIZE,this.engineFacade.drawProvider.clear(),this.calculatePieceSize()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"freeMode",{set:function(e){this.engineFacade.freeMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dragDisabled",{set:function(e){this.engineFacade.dragDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawDisabled",{set:function(e){this.engineFacade.drawDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pieceIcons",{set:function(e){this.engineFacade.pieceIconManager.pieceIconInput=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lightDisabled",{set:function(e){this.engineFacade.lightDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"darkDisabled",{set:function(e){this.engineFacade.darkDisabled=e},enumerable:!1,configurable:!0}),e.prototype.onRightClick=function(e){e.preventDefault()},e.prototype.ngOnChanges=function(e){(e.lightDisabled&&this.lightDisabled&&this.engineFacade.board.currentWhitePlayer||e.darkDisabled&&this.darkDisabled&&!this.engineFacade.board.currentWhitePlayer)&&(this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[])},e.prototype.ngOnInit=function(){var e=this;this.ngxChessBoardService.componentMethodCalled$.subscribe((function(){e.engineFacade.reset()}))},e.prototype.ngAfterViewInit=function(){this.engineFacade.modal=this.modal,this.calculatePieceSize()},e.prototype.onMouseUp=function(e){this.engineFacade.onMouseUp(e,this.getClickPoint(e),this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().top)},e.prototype.reverse=function(){this.selected=!1,this.engineFacade.board.reverse(),this.engineFacade.coords.reverse()},e.prototype.updateBoard=function(e){this.engineFacade.board=e,this.boardLoader.setEngineFacade(this.engineFacade),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[]},e.prototype.setFEN=function(e){try{this.engineFacade.boardLoader.setNotationProcessor(A.getProcessor(p.FEN)),this.engineFacade.boardLoader.loadFEN(e),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[],this.engineFacade.coords.reset()}catch(e){this.engineFacade.boardLoader.addPieces()}},e.prototype.setPGN=function(e){try{this.engineFacade.pgnProcessor.reset(),this.engineFacade.boardLoader.setNotationProcessor(A.getProcessor(p.PGN)),this.engineFacade.boardLoader.loadPGN(e),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[],this.engineFacade.coords.reset()}catch(e){console.log(e),this.engineFacade.boardLoader.addPieces()}},e.prototype.getFEN=function(){return this.engineFacade.board.fen},e.prototype.dragEnded=function(e){this.isDragging=!1,this.engineFacade.dragEndStrategy.process(e,this.engineFacade.moveDone,this.startTransition)},e.prototype.dragStart=function(e){this.isDragging=!0;var t=e.source.getRootElement().style.transform.split(") ");this.startTransition=2===t.length?t[1]:t[0],this.engineFacade.dragStartStrategy.process(e)},e.prototype.onMouseDown=function(e){this.engineFacade.onMouseDown(e,this.getClickPoint(e),this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().top)},e.prototype.getClickPoint=function(e){return B.getClickPoint(e,this.boardRef.nativeElement.getBoundingClientRect().top,this.boardRef.nativeElement.getBoundingClientRect().height,this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().width)},e.prototype.calculatePieceSize=function(){this.pieceSize=this.engineFacade.heightAndWidth/8},e.prototype.getCustomPieceIcons=function(e){return JSON.parse('{ "background-image": "url(\''+this.engineFacade.pieceIconManager.getPieceIcon(e)+"')\"}")},e.prototype.move=function(e){this.engineFacade.move(e)},e.prototype.getMoveHistory=function(){return this.engineFacade.getMoveHistory()},e.prototype.reset=function(){this.engineFacade.reset()},e.prototype.undo=function(){this.engineFacade.undo()},e.prototype.addPiece=function(e,t,i){this.engineFacade.addPiece(e,t,i)},e.prototype.getPGN=function(){return this.engineFacade.pgnProcessor.getPGN()},e.prototype.dragMoved=function(e){var t=e.pointerPosition.x-e.source.getRootElement().parentElement.getBoundingClientRect().left-this.pieceSize/2,i=e.pointerPosition.y-e.source.getRootElement().parentElement.getBoundingClientRect().top-this.pieceSize/2;e.source.getRootElement().style.transform="translate3d("+t+"px, "+i+"px,0px)"},e.prototype.getTileBackgroundColor=function(e,t){var i=(e+t)%2==0?this.lightTileColor:this.darkTileColor;return this.showLastMove&&(this.engineFacade.board.isXYInSourceMove(e,t)&&(i=this.sourcePointColor),this.engineFacade.board.isXYInDestMove(e,t)&&(i=this.destinationPointColor)),i},e}();oe.decorators=[{type:o.Component,args:[{selector:"ngx-chess-board",template:'<div\n    id="board"\n    [style.height.px]="engineFacade.heightAndWidth"\n    [style.width.px]="engineFacade.heightAndWidth"\n    (pointerdown)="!modal.opened && onMouseDown($event)"\n    (pointerup)="!modal.opened && onMouseUp($event)"\n    #boardRef\n>\n    <div id="drag">\n        <div\n            [cdkDragDisabled]="engineFacade.dragDisabled"\n            (cdkDragEnded)="dragEnded($event)"\n            (cdkDragMoved)="dragMoved($event)"\n            (cdkDragStarted)="dragStart($event)"\n            class="single-piece" [innerHTML]="engineFacade.pieceIconManager.isDefaultIcons() ? piece.constant.icon : \'\'"\n            [ngStyle]="engineFacade.pieceIconManager.isDefaultIcons() ? \'\' : getCustomPieceIcons(piece)"\n            [style.transform]="\'translate3d(\' + piece.point.col * pieceSize + \'px, \' + piece.point.row * pieceSize + \'px,0px)\'"\n            [style.max-height]="pieceSize + \'px\'"\n            [style.font-size]="pieceSize * 0.8 + \'px\'"\n            [style.width]="pieceSize + \'px\'"\n            [style.height]="pieceSize + \'px\'"\n            cdkDrag\n            *ngFor="let piece of engineFacade.board.pieces; let i = index"\n        >\n        </div>\n        <div\n            class="board-row"\n            *ngFor="let row of engineFacade.board.board; let i = index"\n        >\n            <div\n                class="board-col"\n                [class.current-selection]="showActivePiece && engineFacade.board.isXYInActiveMove(i,j)"\n                [class.king-check]=" engineFacade.board.isKingChecked(engineFacade.board.getPieceByPoint(i,j))"\n                [class.point-circle]="engineFacade.board.isXYInPointSelection(i, j)"\n                [class.possible-capture]="showPossibleCaptures && engineFacade.board.isXYInPossibleCaptures(i, j)"\n                [class.possible-point]="engineFacade.board.isXYInPossibleMoves(i, j) && showLegalMoves"\n                [style.background-color]="getTileBackgroundColor(i, j)"\n                *ngFor="let col of row; let j = index"\n            >\n                <span\n                    class="yCoord"\n                    [style.color]="(i % 2 === 0) ? lightTileColor : darkTileColor"\n                    [style.font-size.px]="pieceSize / 4"\n                    *ngIf="showCoords && j === 7"\n                >\n                    {{engineFacade.coords.yCoords[i]}}\n                </span>\n                <span\n                    class="xCoord"\n                    [style.color]="(j % 2 === 0) ? lightTileColor : darkTileColor"\n                    [style.font-size.px]="pieceSize / 4"\n                    *ngIf="showCoords && i === 7"\n                >\n                    {{engineFacade.coords.xCoords[j]}}\n                </span>\n                <div\n                    *ngIf="engineFacade.board.getPieceByPoint(i, j) as piece"\n                    style="height:100%; width:100%"\n                >\n                    <div\n                        [ngClass]="\'piece\'"\n                        [style.font-size]="pieceSize + \'px\'"\n\n                    >\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <svg\n        [attr.height]="engineFacade.heightAndWidth"\n        [attr.width]="engineFacade.heightAndWidth"\n        style="position:absolute; top:0; pointer-events: none"\n    >\n        <defs *ngFor="let color of [\'red\', \'green\', \'blue\', \'orange\']">\n            <marker\n                [id]="color + \'Arrow\'"\n                markerHeight="13"\n                markerWidth="13"\n                orient="auto"\n                refX="9"\n                refY="6"\n            >\n                <path\n                    [style.fill]="color"\n                    d="M2,2 L2,11 L10,6 L2,2"\n                ></path>\n            </marker>\n        </defs>\n        <line\n            class="arrow"\n            [attr.marker-end]="\'url(#\' + arrow.end.color + \'Arrow)\'"\n            [attr.stroke]="arrow.end.color"\n            [attr.x1]="arrow.start.x"\n            [attr.x2]="arrow.end.x"\n            [attr.y1]="arrow.start.y"\n            [attr.y2]="arrow.end.y"\n            *ngFor="let arrow of engineFacade.drawProvider.arrows$ | async"\n        ></line>\n        <circle\n            [attr.cx]="circle.drawPoint.x"\n            [attr.cy]="circle.drawPoint.y"\n            [attr.r]="engineFacade.heightAndWidth / 18"\n            [attr.stroke]="circle.drawPoint.color"\n            *ngFor="let circle of engineFacade.drawProvider.circles$ | async"\n            fill-opacity="0.0"\n            stroke-width="2"\n        ></circle>\n    </svg>\n    <app-piece-promotion-modal #modal\n                               [pieceIconInput]="engineFacade.pieceIconManager.pieceIconInput"\n                               [color]="engineFacade.board.getCurrentPlayerColor() ? \'white\' : \'black\'"></app-piece-promotion-modal>\n</div>\n',styles:['@charset "UTF-8";#board{font-family:Courier New,serif;position:relative}.board-row{display:block;height:12.5%;position:relative;width:100%}.board-col{cursor:default;display:inline-block;height:100%;position:relative;vertical-align:top;width:12.5%}.piece{-moz-user-select:none;-webkit-user-select:none;background-size:cover;color:#000!important;cursor:-webkit-grab;cursor:grab;height:100%;justify-content:center;text-align:center;user-select:none;width:100%}.piece,.piece:after{box-sizing:border-box}.piece:after{content:""}#drag{height:100%;width:100%}.possible-point{background:radial-gradient(#13262f 15%,transparent 20%)}.possible-capture:hover,.possible-point:hover{opacity:.4}.possible-capture{background:radial-gradient(transparent 0,transparent 80%,#13262f 0);box-sizing:border-box;margin:0;opacity:.5;padding:0}.king-check{background:radial-gradient(ellipse at center,red 0,#e70000 25%,rgba(169,0,0,0) 89%,rgba(158,0,0,0) 100%)}.current-selection{background-color:#72620b!important}.yCoord{right:.2em}.xCoord,.yCoord{-moz-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;font-family:Lucida Console,Courier,monospace;position:absolute;user-select:none}.xCoord{bottom:0;left:.2em}.hovering{background-color:red!important}.arrow{stroke-width:2}svg{filter:drop-shadow(1px 1px 0 #111) drop-shadow(-1px 1px 0 #111) drop-shadow(1px -1px 0 #111) drop-shadow(-1px -1px 0 #111)}:host{display:inline-block!important}.single-piece{-moz-user-select:none;-webkit-user-select:none;background-size:cover;color:#000!important;cursor:-webkit-grab;cursor:grab;justify-content:center;position:absolute;text-align:center;user-select:none;z-index:999}.single-piece:after{box-sizing:border-box;content:""}.cdk-drag:not(.cdk-drag-dragging){transition:transform .2s cubic-bezier(0,.3,.14,.49)}']}]}],oe.ctorParameters=function(){return[{type:ie}]},oe.propDecorators={darkTileColor:[{type:o.Input}],lightTileColor:[{type:o.Input}],showCoords:[{type:o.Input}],sourcePointColor:[{type:o.Input}],destinationPointColor:[{type:o.Input}],legalMovesPointColor:[{type:o.Input}],showLastMove:[{type:o.Input}],showLegalMoves:[{type:o.Input}],showActivePiece:[{type:o.Input}],showPossibleCaptures:[{type:o.Input}],moveChange:[{type:o.Output}],checkmate:[{type:o.Output}],stalemate:[{type:o.Output}],boardRef:[{type:o.ViewChild,args:["boardRef"]}],modal:[{type:o.ViewChild,args:["modal"]}],size:[{type:o.Input,args:["size"]}],freeMode:[{type:o.Input,args:["freeMode"]}],dragDisabled:[{type:o.Input,args:["dragDisabled"]}],drawDisabled:[{type:o.Input,args:["drawDisabled"]}],pieceIcons:[{type:o.Input,args:["pieceIcons"]}],lightDisabled:[{type:o.Input,args:["lightDisabled"]}],darkDisabled:[{type:o.Input,args:["darkDisabled"]}],onRightClick:[{type:o.HostListener,args:["contextmenu",["$event"]]}]};var re=function(){function e(){this.color="white",this.opened=!1}return e.prototype.open=function(e){this.opened=!0,this.onCloseCallback=e,this.modal.nativeElement.style.display="block"},e.prototype.changeSelection=function(e){this.modal.nativeElement.style.display="none",this.opened=!1,this.onCloseCallback(e)},e.prototype.getPieceIcon=function(e){var t="";switch(e.toLowerCase()){case"queen":t="white"===this.color?this.pieceIconInput.whiteQueenUrl:this.pieceIconInput.blackQueenUrl;break;case"rook":t="white"===this.color?this.pieceIconInput.whiteRookUrl:this.pieceIconInput.blackRookUrl;break;case"bishop":t="white"===this.color?this.pieceIconInput.whiteBishopUrl:this.pieceIconInput.blackBishopUrl;break;case"knight":t="white"===this.color?this.pieceIconInput.whiteKnightUrl:this.pieceIconInput.blackKnightUrl}return t},e}();re.decorators=[{type:o.Component,args:[{selector:"app-piece-promotion-modal",template:'<div #myModal class="container">\r\n    <div class="wrapper">\r\n        <div class="content">\r\n            <div class="piece-wrapper" *ngIf="pieceIconInput">\r\n                <div class="piece" (click)="changeSelection(1)">\r\n                    <img [src]="getPieceIcon(\'queen\')" alt="Queen">\r\n                </div>\r\n                <div class="piece" (click)="changeSelection(2)">\r\n                    <img [src]="getPieceIcon(\'rook\')" alt="Rook">\r\n                </div>\r\n                <div class="piece" (click)="changeSelection(3)">\r\n                    <img [src]="getPieceIcon(\'bishop\')" alt="Bishop">\r\n                </div>\r\n                <div class="piece" (click)="changeSelection(4)">\r\n                    <img [src]="getPieceIcon(\'knight\')" alt="Knight">\r\n                </div>\r\n            </div>\r\n            <div class="piece-wrapper" *ngIf="!pieceIconInput">\r\n                <div class="piece" (click)="changeSelection(1)">&#x265B;</div>\r\n                <div class="piece" (click)="changeSelection(2)">&#x265C;</div>\r\n                <div class="piece" (click)="changeSelection(3)">&#x265D;</div>\r\n                <div class="piece" (click)="changeSelection(4)">&#x265E;</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',styles:[".container{background-color:rgba(0,0,0,.4);color:#000;display:none;overflow:auto;position:absolute;top:0;z-index:9999}.container,.wrapper{height:100%;width:100%}.content,.wrapper{position:relative}.content{background-color:#fefefe;border:1px solid #888;font-size:100%;height:40%;margin:auto;padding:10px;top:30%;width:90%}.piece{cursor:pointer;display:inline-block;font-size:5rem;height:100%;text-align:center;width:25%}.piece img{max-width:100%}.piece:hover{background-color:#ccc;border-radius:5px}.piece-wrapper{height:80%;width:100%}#close-button{background-color:#4caf50;border:none;border-radius:4px;color:#fff;display:inline-block;padding-left:5px;padding-right:5px;text-align:center;text-decoration:none}.selected{border:2px solid #00b919;border-radius:4px;box-sizing:border-box}"]}]}],re.propDecorators={modal:[{type:o.ViewChild,args:["myModal",{static:!1}]}],pieceIconInput:[{type:o.Input}],color:[{type:o.Input}]};var ne=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[ie]}},e}();ne.decorators=[{type:o.NgModule,args:[{declarations:[oe,re],imports:[i.CommonModule,t.DragDropModule],exports:[oe]}]}],e.HistoryMove=x,e.NgxChessBoardComponent=oe,e.NgxChessBoardModule=ne,e.NgxChessBoardService=ie,e.PiecePromotionModalComponent=re,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-chess-board.umd.min.js.map