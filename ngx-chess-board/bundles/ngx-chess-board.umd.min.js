!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/cdk/drag-drop"),require("@angular/common"),require("@angular/core"),require("rxjs"),require("lodash")):"function"==typeof define&&define.amd?define("ngx-chess-board",["exports","@angular/cdk/drag-drop","@angular/common","@angular/core","rxjs","lodash"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-chess-board"]={},e.ng.cdk.dragDrop,e.ng.common,e.ng.core,e.rxjs,e.lodash)}(this,(function(e,t,o,i,r,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)};function a(e,t){function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}Object.create;function c(e){var t="function"==typeof Symbol&&Symbol.iterator,o=t&&e[t],i=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function d(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var i,r,n=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}return s}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}var h;Object.create;!function(e){e[e.WHITE=0]="WHITE",e[e.BLACK=1]="BLACK"}(h||(h={}));var p,u=function(e,t,o,i,r){this.checkPoints=[],this.color=t,this.constant=o,this.point=e,this.relValue=i,this.board=r},f=function(){function e(e,t){this.row=e,this.col=t}return e.prototype.isEqual=function(e){return e&&this.row===e.row&&this.col===e.col},e.prototype.hasCoordsEqual=function(e,t){return e&&t&&this.row===e&&this.col===t},e.prototype.clone=function(){return new e(this.row,this.col)},e}(),b=function(e){function t(t,o,i,r){var n=e.call(this,t,o,i,5,r)||this;return n.isMovedAlready=!1,n}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8&&this.board.isFieldEmpty(i,o);++i)e.push(new f(i,o));for(i=t-1;i>=0&&this.board.isFieldEmpty(i,o);--i)e.push(new f(i,o));for(var r=o-1;r>=0&&this.board.isFieldEmpty(t,r);--r)e.push(new f(t,r));for(r=o+1;r<8&&this.board.isFieldEmpty(t,r);++r)e.push(new f(t,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i){if(this.board.isFieldTakenByEnemy(i,o,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(i=t-1;i>=0;--i){if(this.board.isFieldTakenByEnemy(i,o,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(var r=o-1;r>=0;--r){if(this.board.isFieldTakenByEnemy(t,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(t,r));break}if(!this.board.isFieldEmpty(t,r))break}for(r=o+1;r<8;++r){if(this.board.isFieldTakenByEnemy(t,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(t,r));break}if(!this.board.isFieldEmpty(t,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i)if(this.board.isFieldEmpty(i,o))e.push(new f(i,o));else if(!(this.board.getPieceByField instanceof y)){e.push(new f(i,o));break}for(i=t-1;i>=0;--i)if(this.board.isFieldEmpty(i,o))e.push(new f(i,o));else if(!(this.board.getPieceByField instanceof y)){e.push(new f(i,o));break}for(var r=o-1;r>=0;--r)if(this.board.isFieldEmpty(t,r))e.push(new f(t,r));else if(!(this.board.getPieceByField instanceof y)){e.push(new f(t,r));break}for(r=o+1;r<8;++r)if(this.board.isFieldEmpty(t,r))e.push(new f(t,r));else if(!(this.board.getPieceByField instanceof y)){e.push(new f(t,r));break}return e},t}(u),y=function(e){function t(t,o,i,r){var n=e.call(this,t,o,i,0,r)||this;return n.castledAlready=!1,n.shortCastled=!1,n.longCastled=!1,n.isCastling=!1,n}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;if(this.board.isFieldEmpty(t,o-1)&&!this.board.isFieldUnderAttack(t,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t,o-1)),this.board.isFieldEmpty(t,o+1)&&!this.board.isFieldUnderAttack(t,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t,o+1)),this.board.isFieldEmpty(t+1,o)&&!this.board.isFieldUnderAttack(t+1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o)),this.board.isFieldEmpty(t-1,o)&&!this.board.isFieldUnderAttack(t-1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o)),this.board.isFieldEmpty(t-1,o-1)&&!this.board.isFieldUnderAttack(t-1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o-1)),this.board.isFieldEmpty(t-1,o+1)&&!this.board.isFieldUnderAttack(t-1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o+1)),this.board.isFieldEmpty(t+1,o-1)&&!this.board.isFieldUnderAttack(t+1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o-1)),this.board.isFieldEmpty(t+1,o+1)&&!this.board.isFieldUnderAttack(t+1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o+1)),!this.isMovedAlready){for(var i=!0,r=o-1;r>0;--r)if(!this.board.isFieldEmpty(t,r)||this.board.isFieldUnderAttack(t,r,this.color===h.WHITE?h.BLACK:h.WHITE)){i=!1;break}if(i&&!this.board.isKingInCheck(this.color,this.board.pieces)&&this.board.getPieceByField(t,0)){var n=this.board.getPieceByField(t,0);n instanceof b&&(n.isMovedAlready||e.push(new f(t,o-2)))}var s=!0;for(r=o+1;r<7;++r)if(!this.board.isFieldEmpty(t,r)||this.board.isFieldUnderAttack(t,r,this.color===h.WHITE?h.BLACK:h.WHITE)){s=!1;break}if(s&&!this.board.isKingInCheck(this.color,this.board.pieces)&&this.board.getPieceByField(t,7)){var a=this.board.getPieceByField(t,7);a instanceof b&&(a.isMovedAlready||e.push(new f(t,o+2)))}}return e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldTakenByEnemy(t,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t,o-1)),this.board.isFieldTakenByEnemy(t,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t,o+1)),this.board.isFieldTakenByEnemy(t+1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t+1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o)),this.board.isFieldTakenByEnemy(t-1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t-1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o)),this.board.isFieldTakenByEnemy(t-1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t-1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o-1)),this.board.isFieldTakenByEnemy(t-1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t-1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o+1)),this.board.isFieldTakenByEnemy(t+1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t+1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o-1)),this.board.isFieldTakenByEnemy(t+1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t+1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return e.push(new f(t,o-1)),e.push(new f(t,o+1)),e.push(new f(t+1,o)),e.push(new f(t-1,o)),e.push(new f(t-1,o-1)),e.push(new f(t-1,o+1)),e.push(new f(t+1,o-1)),e.push(new f(t+1,o+1)),e},t}(u),g=function(e){function t(t,o,i,r){return e.call(this,t,o,i,3,r)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0&&this.board.isFieldEmpty(i,r);--i,--r)e.push(new f(i,r));for(i=t-1,r=o+1;i>=0&&r<8&&this.board.isFieldEmpty(i,r);--i,++r)e.push(new f(i,r));for(i=t+1,r=o-1;i<8&&r>=0&&this.board.isFieldEmpty(i,r);++i,--r)e.push(new f(i,r));for(i=t+1,r=o+1;i<8&&r<8&&this.board.isFieldEmpty(i,r);++i,++r)e.push(new f(i,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0;--i,--r){if(this.board.isFieldTakenByEnemy(i,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t-1,r=o+1;i>=0&&r<8;--i,++r){if(this.board.isFieldTakenByEnemy(i,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1,r=o-1;i<8&&r>=0;++i,--r){if(this.board.isFieldTakenByEnemy(i,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1,r=o+1;i<8&&r<8;++i,++r){if(this.board.isFieldTakenByEnemy(i,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,r));break}if(!this.board.isFieldEmpty(i,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0;--i,--r){if(!this.board.isFieldEmpty(i,r)){this.board.getPieceByField(i,r)instanceof y||e.push(new f(i,r));break}e.push(new f(i,r))}for(i=t-1,r=o+1;i>=0&&r<8;--i,++r){if(!this.board.isFieldEmpty(i,r)){this.board.getPieceByField(i,r)instanceof y||e.push(new f(i,r));break}e.push(new f(i,r))}for(i=t+1,r=o-1;i<8&&r>=0;++i,--r){if(!this.board.isFieldEmpty(i,r)){this.board.getPieceByField(i,r)instanceof y||e.push(new f(i,r));break}e.push(new f(i,r))}for(i=t+1,r=o+1;i<8&&r<8;++i,++r){if(!this.board.isFieldEmpty(i,r)){this.board.getPieceByField(i,r)instanceof y||e.push(new f(i,r));break}e.push(new f(i,r))}return e},t}(u),v=function(e){function t(t,o,i,r){var n=e.call(this,t,o,i,3,r)||this;return n.isMovedAlready=!1,n}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldEmpty(t-2,o-1)&&e.push(new f(t-2,o-1)),this.board.isFieldEmpty(t-2,o+1)&&e.push(new f(t-2,o+1)),this.board.isFieldEmpty(t-1,o-2)&&e.push(new f(t-1,o-2)),this.board.isFieldEmpty(t-1,o+2)&&e.push(new f(t-1,o+2)),this.board.isFieldEmpty(t+1,o-2)&&e.push(new f(t+1,o-2)),this.board.isFieldEmpty(t+1,o+2)&&e.push(new f(t+1,o+2)),this.board.isFieldEmpty(t+2,o-1)&&e.push(new f(t+2,o-1)),this.board.isFieldEmpty(t+2,o+1)&&e.push(new f(t+2,o+1)),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldTakenByEnemy(t-2,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-2,o-1)),this.board.isFieldTakenByEnemy(t-2,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-2,o+1)),this.board.isFieldTakenByEnemy(t-1,o-2,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o-2)),this.board.isFieldTakenByEnemy(t-1,o+2,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o+2)),this.board.isFieldTakenByEnemy(t+1,o-2,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o-2)),this.board.isFieldTakenByEnemy(t+1,o+2,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o+2)),this.board.isFieldTakenByEnemy(t+2,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+2,o-1)),this.board.isFieldTakenByEnemy(t+2,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+2,o+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return e.push(new f(t-2,o-1)),e.push(new f(t-2,o+1)),e.push(new f(t-1,o-2)),e.push(new f(t-1,o+2)),e.push(new f(t+1,o-2)),e.push(new f(t+1,o+2)),e.push(new f(t+2,o-1)),e.push(new f(t+2,o+1)),e},t}(u),w=function(e){function t(t,o,i,r){var n=e.call(this,t,o,i,1,r)||this;return n.isMovedAlready=!1,n}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===h.WHITE||this.board.reverted&&this.color===h.BLACK?this.board.isFieldEmpty(t-1,o)&&(e.push(new f(t-1,o)),!this.isMovedAlready&&this.board.isFieldEmpty(t-2,o)&&e.push(new f(t-2,o))):
/*!board.isFieldTakenByEnemy(row + 1, col, Color.WHITE) &&*/this.board.isFieldEmpty(t+1,o)&&(e.push(new f(t+1,o)),!this.isMovedAlready&&this.board.isFieldEmpty(t+2,o)&&e.push(new f(t+2,o))),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===h.WHITE||this.board.reverted&&this.color===h.BLACK?(this.board.isFieldTakenByEnemy(t-1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o-1)),this.board.isFieldTakenByEnemy(t-1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o+1))):(this.board.isFieldTakenByEnemy(t+1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o-1)),this.board.isFieldTakenByEnemy(t+1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o+1))),this.board.enPassantPoint&&this.board.enPassantPiece.color===(this.color===h.WHITE?h.BLACK:h.WHITE)&&t===this.board.enPassantPiece.point.row&&1===Math.abs(this.board.enPassantPiece.point.col-o)&&e.push(this.board.enPassantPoint),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===h.WHITE||this.board.reverted&&this.color===h.BLACK?(e.push(new f(t-1,o-1)),e.push(new f(t-1,o+1))):(e.push(new f(t+1,o-1)),e.push(new f(t+1,o+1))),e},t}(u),E=function(e){function t(t,o,i,r){return e.call(this,t,o,i,9,r)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0&&this.board.isFieldEmpty(i,r);--i,--r)e.push(new f(i,r));for(i=t-1,r=o+1;i>=0&&r<8&&this.board.isFieldEmpty(i,r);--i,++r)e.push(new f(i,r));for(i=t+1,r=o-1;i<8&&r>=0&&this.board.isFieldEmpty(i,r);++i,--r)e.push(new f(i,r));for(i=t+1,r=o+1;i<8&&r<8&&this.board.isFieldEmpty(i,r);++i,++r)e.push(new f(i,r));for(i=t+1;i<8&&this.board.isFieldEmpty(i,o);++i)e.push(new f(i,o));for(i=t-1;i>=0&&this.board.isFieldEmpty(i,o);--i)e.push(new f(i,o));for(r=o-1;r>=0&&this.board.isFieldEmpty(t,r);--r)e.push(new f(t,r));for(r=o+1;r<8&&this.board.isFieldEmpty(t,r);++r)e.push(new f(t,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0;--i,--r){if(this.board.isFieldTakenByEnemy(i,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t-1,r=o+1;i>=0&&r<8;--i,++r){if(this.board.isFieldTakenByEnemy(i,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1,r=o-1;i<8&&r>=0;++i,--r){if(this.board.isFieldTakenByEnemy(i,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1,r=o+1;i<8&&r<8;++i,++r){if(this.board.isFieldTakenByEnemy(i,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1;i<8;++i){if(this.board.isFieldTakenByEnemy(i,o,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(i=t-1;i>=0;--i){if(this.board.isFieldTakenByEnemy(i,o,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(r=o-1;r>=0;--r){if(this.board.isFieldTakenByEnemy(t,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(t,r));break}if(!this.board.isFieldEmpty(t,r))break}for(r=o+1;r<8;++r){if(this.board.isFieldTakenByEnemy(t,r,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(t,r));break}if(!this.board.isFieldEmpty(t,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i){if(!this.board.isFieldEmpty(i,o)){this.board.getPieceByField(i,o)instanceof y||e.push(new f(i,o));break}e.push(new f(i,o))}for(i=t-1;i>=0;--i){if(!this.board.isFieldEmpty(i,o)){this.board.getPieceByField(i,o)instanceof y||e.push(new f(i,o));break}e.push(new f(i,o))}for(var r=o-1;r>=0;--r){if(!this.board.isFieldEmpty(t,r)){this.board.getPieceByField(t,r)instanceof y||e.push(new f(t,r));break}e.push(new f(t,r))}for(r=o+1;r<8;++r){if(!this.board.isFieldEmpty(t,r)){this.board.getPieceByField(t,r)instanceof y||e.push(new f(t,r));break}e.push(new f(t,r))}for(i=t-1,r=o-1;i>=0&&r>=0;--i,--r){if(!this.board.isFieldEmpty(i,r)){this.board.getPieceByField(i,r)instanceof y||e.push(new f(i,r));break}e.push(new f(i,r))}for(i=t-1,r=o+1;i>=0&&r<8;--i,++r){if(!this.board.isFieldEmpty(i,r)){this.board.getPieceByField(i,r)instanceof y||e.push(new f(i,r));break}e.push(new f(i,r))}for(i=t+1,r=o-1;i<8&&r>=0;++i,--r){if(!this.board.isFieldEmpty(i,r)){this.board.getPieceByField(i,r)instanceof y||e.push(new f(i,r));break}e.push(new f(i,r))}for(i=t+1,r=o+1;i<8&&r<8;++i,++r){if(!this.board.isFieldEmpty(i,r)){this.board.getPieceByField(i,r)instanceof y||e.push(new f(i,r));break}e.push(new f(i,r))}return e},t}(u),P={WHITE_KING:{name:"King",icon:"&#x2654;"},WHITE_QUEEN:{name:"Queen",icon:"&#x2655;"},WHITE_KNIGHT:{name:"Knight",icon:"&#x2658"},WHITE_ROOK:{name:"Rook",icon:"&#x2656"},WHITE_PAWN:{name:"Pawn",icon:"&#x2659"},WHITE_BISHOP:{name:"Bishop",icon:"&#x2657"},BLACK_KING:{name:"King",icon:"&#x265A"},BLACK_QUEEN:{name:"Queen",icon:"&#x265B"},BLACK_KNIGHT:{name:"Knight",icon:"&#x265E"},BLACK_ROOK:{name:"Rook",icon:"&#x265C"},BLACK_PAWN:{name:"Pawn",icon:"&#x265F"},BLACK_BISHOP:{name:"Bishop",icon:"&#x265D"}},C=function(){function e(){}return e.prototype.process=function(e,t){var o=e;if(!e)throw Error("Incorrect FEN provided");t.board.reverted=!1,t.board.pieces=[];for(var i=o.split("/"),r=0;r<8;++r)for(var n=0,s=0;s<8;++s){var a=i[r].charAt(s);if(a.match(/[0-9]/))n+=Number(a);else{switch(a){case"r":t.board.pieces.push(new b(new f(r,n),h.BLACK,P.BLACK_ROOK,t.board));break;case"n":t.board.pieces.push(new v(new f(r,n),h.BLACK,P.BLACK_KNIGHT,t.board));break;case"b":t.board.pieces.push(new g(new f(r,n),h.BLACK,P.BLACK_BISHOP,t.board));break;case"q":t.board.pieces.push(new E(new f(r,n),h.BLACK,P.BLACK_QUEEN,t.board));break;case"k":t.board.pieces.push(new y(new f(r,n),h.BLACK,P.BLACK_KING,t.board));break;case"p":((c=new w(new f(r,n),h.BLACK,P.BLACK_PAWN,t.board)).color===h.BLACK&&1!==c.point.row||c.color===h.WHITE&&6!==c.point.row)&&(c.isMovedAlready=!0),t.board.pieces.push(c);break;case"R":t.board.pieces.push(new b(new f(r,n),h.WHITE,P.WHITE_ROOK,t.board));break;case"N":t.board.pieces.push(new v(new f(r,n),h.WHITE,P.WHITE_KNIGHT,t.board));break;case"B":t.board.pieces.push(new g(new f(r,n),h.WHITE,P.WHITE_BISHOP,t.board));break;case"Q":t.board.pieces.push(new E(new f(r,n),h.WHITE,P.WHITE_QUEEN,t.board));break;case"K":t.board.pieces.push(new y(new f(r,n),h.WHITE,P.WHITE_KING,t.board));break;case"P":var c;((c=new w(new f(r,n),h.WHITE,P.WHITE_PAWN,t.board)).color===h.BLACK&&1!==c.point.row||c.color===h.WHITE&&6!==c.point.row)&&(c.isMovedAlready=!0),t.board.pieces.push(c)}++n}}this.setCurrentPlayer(t.board,o),this.setCastles(t.board,o),this.setEnPassant(o),this.setFullMoveCount(o),t.board.fen=o},e.prototype.setCurrentPlayer=function(e,t){if(t){var o=t.split(" ");e.currentWhitePlayer="w"===o[1]}},e.prototype.setCastles=function(e,t){if(t){var o=t.split(" ")[2];o.includes("K")||this.setRookAlreadyMoved(e,h.WHITE,7),o.includes("Q")||this.setRookAlreadyMoved(e,h.WHITE,0),o.includes("k")||this.setRookAlreadyMoved(e,h.BLACK,7),o.includes("q")||this.setRookAlreadyMoved(e,h.BLACK,0)}},e.prototype.setFullMoveCount=function(e){},e.prototype.setEnPassant=function(e){if(e&&"-"===e.split(" ")[3])return},e.prototype.setRookAlreadyMoved=function(e,t,o){var i=e.pieces.find((function(e){return e.color===t&&e instanceof b&&e.point.col===o}));i&&(i.isMovedAlready=!0)},e}(),I=function(){function e(e,t,o){this._xAxis=e,this._yAxis=t,this._reverted=o}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},set:function(e){this._xAxis=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},set:function(e){this._yAxis=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reverted",{get:function(){return this._reverted},set:function(e){this._reverted=e},enumerable:!1,configurable:!0}),e}(),m=function(){function e(){}return e.willMoveCauseCheck=function(e,t,o,i,r,n){var s=n.getPieceByField(t,o),a=n.getPieceByField(i,r);s&&(s.point.row=i,s.point.col=r),a&&(n.pieces=n.pieces.filter((function(e){return e!==a})));var c=n.isKingInCheck(e,n.pieces);return s&&(s.point.col=o,s.point.row=t),a&&n.pieces.push(a),c},e.format=function(e,t,o){if(o){var i=104-e.col,r=104-t.col;return String.fromCharCode(i)+(e.row+1)+String.fromCharCode(r)+(t.row+1)}return String.fromCharCode(e.col+97)+(Math.abs(e.row-7)+1)+String.fromCharCode(t.col+97)+(Math.abs(t.row-7)+1)},e.translateCoordsToIndex=function(e,t){var o,i;return t?(o=104-e.charCodeAt(0),i=+e.charAt(1)-1):(o=e.charCodeAt(0)-97,i=Math.abs(+e.charAt(1)-8)),new I(o,i,t)},e.findPieceByPossibleMovesContaining=function(t,o,i){var r,n,s,a,d=this.translateCoordsToIndex(t,o.reverted),l=new f(d.yAxis,d.xAxis),h=[];try{for(var p=c(o.pieces.filter((function(e){return e.color===i}))),u=p.next();!u.done;u=p.next()){var b=u.value;try{for(var y=(s=void 0,c(b.getPossibleMoves())),g=y.next();!g.done;g=y.next()){var v=g.value;!e.willMoveCauseCheck(b.color,b.point.row,b.point.col,d.yAxis,d.xAxis,o)&&v.isEqual(l)&&h.push(b)}}catch(e){s={error:e}}finally{try{g&&!g.done&&(a=y.return)&&a.call(y)}finally{if(s)throw s.error}}}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return 0===h.length&&console.log(t+" debug"),h},e.findPieceByPossibleCapturesContaining=function(t,o,i){var r,n,s,a,d=this.translateCoordsToIndex(t,o.reverted),l=new f(d.yAxis,d.xAxis),h=[];try{for(var p=c(o.pieces.filter((function(e){return e.color===i}))),u=p.next();!u.done;u=p.next()){var b=u.value;try{for(var y=(s=void 0,c(b.getPossibleCaptures())),g=y.next();!g.done;g=y.next()){var v=g.value;!e.willMoveCauseCheck(b.color,b.point.row,b.point.col,d.yAxis,d.xAxis,o)&&v.isEqual(l)&&h.push(b)}}catch(e){s={error:e}}finally{try{g&&!g.done&&(a=y.return)&&a.call(y)}finally{if(s)throw s.error}}}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return 0===h.length&&console.log(t+" debug"),h},e.formatSingle=function(e,t){if(t){var o=104-e.col;return String.fromCharCode(o)+(e.row+1)}return String.fromCharCode(e.col+97)+(Math.abs(e.row-7)+1)},e}(),A=function(){function e(){}return e.loadDefaultPieces=function(e){e.pieces=[];for(var t=0;t<8;++t)e.pieces.push(new w(new f(1,t),h.BLACK,P.BLACK_PAWN,e));e.pieces.push(new b(new f(0,0),h.BLACK,P.BLACK_ROOK,e)),e.pieces.push(new v(new f(0,1),h.BLACK,P.BLACK_KNIGHT,e)),e.pieces.push(new g(new f(0,2),h.BLACK,P.BLACK_BISHOP,e)),e.pieces.push(new E(new f(0,3),h.BLACK,P.BLACK_QUEEN,e)),e.pieces.push(new y(new f(0,4),h.BLACK,P.BLACK_KING,e)),e.pieces.push(new g(new f(0,5),h.BLACK,P.BLACK_BISHOP,e)),e.pieces.push(new v(new f(0,6),h.BLACK,P.BLACK_KNIGHT,e)),e.pieces.push(new b(new f(0,7),h.BLACK,P.BLACK_ROOK,e));for(t=0;t<8;++t)e.pieces.push(new w(new f(6,t),h.WHITE,P.WHITE_PAWN,e));e.pieces.push(new b(new f(7,0),h.WHITE,P.WHITE_ROOK,e)),e.pieces.push(new v(new f(7,1),h.WHITE,P.WHITE_KNIGHT,e)),e.pieces.push(new g(new f(7,2),h.WHITE,P.WHITE_BISHOP,e)),e.pieces.push(new E(new f(7,3),h.WHITE,P.WHITE_QUEEN,e)),e.pieces.push(new y(new f(7,4),h.WHITE,P.WHITE_KING,e)),e.pieces.push(new g(new f(7,5),h.WHITE,P.WHITE_BISHOP,e)),e.pieces.push(new v(new f(7,6),h.WHITE,P.WHITE_KNIGHT,e)),e.pieces.push(new b(new f(7,7),h.WHITE,P.WHITE_ROOK,e)),e.calculateFEN()},e}(),F=function(){function e(){}return e.prototype.process=function(e,t){var o,i,r=this;if(e){t.board.reverted=!1,t.board.pieces=[],t.reset(),A.loadDefaultPieces(t.board);var n=this.extractMoves(e),s=-1,a=function(e){++s;var o="";(e=e.replace(/[+#]/g,"")).includes("=")&&(o=d.resolvePromotion(e.substring(e.length-1)),e=e.substring(0,e.length-2));var i=0===s||s%2==0?h.WHITE:h.BLACK;if(/^[a-z]\d$/g.test(e))(a=m.findPieceByPossibleMovesContaining(e,t.board,i).find((function(e){return e instanceof w})))&&t.move(m.formatSingle(a.point,!1)+e+o);else if(/^[A-Z][a-h]\d$/g.test(e))(a=(n=m.findPieceByPossibleMovesContaining(e.substring(1),t.board,i)).find((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)})))&&t.move(m.formatSingle(a.point,!1)+e.substring(1)+o);else if("O-O"===e)t.move(i===h.WHITE?"e1g1":"e8g8");else if(/^[a-z]x[a-z]\d$/g.test(e)){var n=m.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,i).filter((function(e){return e instanceof w})),a=void 0;(a=n.length>1?d.resolveByCol(n,e.substring(0,1)):n[0])&&t.move(m.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+o)}else{if(/^[A-Z]x[a-z]\d$/g.test(e))(a=m.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,i).find((function(t){return r.resolvePieceByFirstChar(e.substring(0,1),t)})))&&t.move(m.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+o);else if("O-O-O"===e)t.move(i===h.WHITE?"e1c1":"e8c8");else if(/^[A-Z]\dx[a-z]\d$/g.test(e)){n=m.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,i).filter((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)}));(a=d.resolveByRow(n,e.substring(1,2)))&&t.move(m.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+o)}else if(/^[A-Z][a-z][a-z]\d$/g.test(e)){n=m.findPieceByPossibleMovesContaining(e.substring(2,4),t.board,i).filter((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)}));(a=d.resolveByCol(n,e.substring(1,2)))&&t.move(m.formatSingle(a.point,!1)+e.substring(2,4)+o)}else if(/^[A-Z][a-z]x[a-z]\d$/g.test(e)){n=m.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,i).filter((function(t){return r.resolvePieceByFirstChar(e.charAt(0),t)}));(a=d.resolveByCol(n,e.substring(1,2)))&&t.move(m.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+o)}}},d=this;try{for(var l=c(n),p=l.next();!p.done;p=l.next()){a(p.value)}}catch(e){o={error:e}}finally{try{p&&!p.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}}},e.prototype.extractMoves=function(e){return e.substring(e.lastIndexOf("]")+1).replace(/[0-9]+\./g,"").replace(/\s+/g," ").replace(/{[^}]*}/g,"").trim().split(" ").filter((function(e){return e}))},e.prototype.movePiece=function(e,t,o){var i=m.translateCoordsToIndex(o,t.reverted);e.point.col=i.xAxis,e.point.row=i.yAxis},e.prototype.hasUpperCase=function(e){return/[A-Z]/.test(e)},e.prototype.resolvePieceByFirstChar=function(e,t){var o="";return t instanceof y?o="K":t instanceof E?o="Q":t instanceof b?o="R":t instanceof g?o="B":t instanceof v?o="N":t instanceof w&&(o="P"),e===o},e.prototype.isShortCastle=function(e){return"O-O"===e},e.prototype.removePiece=function(e,t){var o=m.translateCoordsToIndex(e,t.reverted);t.pieces=t.pieces.filter((function(e){return!e.point.isEqual(new f(o.yAxis,o.xAxis))}))},e.prototype.isLongCastle=function(e){return"O-O-O"===e},e.prototype.resolveByCol=function(e,t){var o=m.formatSingle(e[0].point,!1);m.formatSingle(e[1].point,!1);return o.substring(0,1)===t?e[0]:e[1]},e.prototype.resolveByRow=function(e,t){var o=m.formatSingle(e[0].point,!1);m.formatSingle(e[1].point,!1);return o.substring(1,2)===t?e[0]:e[1]},e.prototype.replacePromotion=function(e){return e.replace("=Q","1").replace("=R","2").replace("=B","3").replace("=K","4")},e.prototype.resolvePromotion=function(e){switch(e){case"Q":return"1";case"R":return"2";case"B":return"3";case"N":return"4"}return""},e}(),k=function(){function e(){}return e.getProcessor=function(e){switch(e){case p.FEN:return new C;case p.PGN:return new F}},e.getDefaultProcessor=function(){return new C},e}();!function(e){e[e.FEN=1]="FEN",e[e.PGN=2]="PGN"}(p||(p={}));var T=function(){function e(e,t,o){this.x=e+.5,this.y=t+.5,this.color=o}return e.prototype.isEqual=function(e){return e&&e.x===this.x&&this.y===e.y},e}(),B=function(){function e(){}return e.getClickPoint=function(e,t,o,i,r){return new f(Math.floor((e.y-t)/(o/8)),Math.floor((e.x-i)/(r/8)))},e.getDrawingPoint=function(e,t,o,i,r,n,s,a,c){var d=e/8,l=Math.floor((o-a)/d),h=Math.floor((i-c)/d),p=t.resolve(r,s,n);return new T(Math.floor(l*d+d/2),Math.floor(h*d+d/2),p)},e}(),H=function(e,t,o,i){this.move=e,this.piece=t,this.color=o,this.x=i},W=function(){function e(){this.historyMovesSubject$=new r.BehaviorSubject([])}return Object.defineProperty(e.prototype,"historyMoves",{get:function(){return this.historyMovesSubject$.value},set:function(e){this.historyMovesSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addMove=function(e){this.historyMoves=l(this.historyMoves,[e])},e.prototype.pop=function(){var e=this.getLastMove();return this.historyMoves=this.historyMoves.filter((function(t){return t!==e})),e},e.prototype.getAll=function(){return this.historyMoves},e.prototype.clear=function(){this.historyMoves=[]},e.prototype.getLastMove=function(){return this.historyMoves[this.getLastMoveIndex()]},e.prototype.getLastMoveIndex=function(){return this.historyMoves.length-1},e}(),K=function(){};K.DEFAULT_DARK_TILE_COLOR="rgb(97, 84, 61)",K.DEFAULT_LIGHT_TILE_COLOR="#BAA378",K.DEFAULT_SIZE=500,K.MIN_BOARD_SIZE=100,K.MAX_BOARD_SIZE=4e3;var x,M,L=function(){function e(){this._defaultIcons=!1}return Object.defineProperty(e.prototype,"pieceIconInput",{get:function(){return this._pieceIconInput},set:function(e){this._pieceIconInput=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultIcons",{get:function(){return this._defaultIcons},set:function(e){this._defaultIcons=e},enumerable:!1,configurable:!0}),e.prototype.isDefaultIcons=function(){return void 0===this.pieceIconInput||null===this.pieceIconInput},e.prototype.getPieceIcon=function(e){var t=e.color===h.WHITE;switch(e.constructor){case y:return t?this.pieceIconInput.whiteKingUrl:this.pieceIconInput.blackKingUrl;case E:return t?this.pieceIconInput.whiteQueenUrl:this.pieceIconInput.blackQueenUrl;case b:return t?this.pieceIconInput.whiteRookUrl:this.pieceIconInput.blackRookUrl;case g:return t?this.pieceIconInput.whiteBishopUrl:this.pieceIconInput.blackBishopUrl;case v:return t?this.pieceIconInput.whiteKnightUrl:this.pieceIconInput.blackKnightUrl;case w:return t?this.pieceIconInput.whitePawnUrl:this.pieceIconInput.blackPawnUrl}},e.prototype.loadDefaultData=function(){this.pieceIconInput={blackBishopUrl:"",blackKingUrl:"",blackKnightUrl:"",blackQueenUrl:"",blackRookUrl:"",whiteBishopUrl:"",whiteKingUrl:"",whiteKnightUrl:"",whitePawnUrl:"",whiteQueenUrl:"",whiteRookUrl:"",blackPawnUrl:"a"}},e}(),S=function(){function e(){this.defaultXCoords=["a","b","c","d","e","f","g","h"],this.defaultYCoords=[8,7,6,5,4,3,2,1],this.currentXCoords=l(this.defaultXCoords),this.currentYCoords=l(this.defaultYCoords)}return Object.defineProperty(e.prototype,"xCoords",{get:function(){return this.currentXCoords},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yCoords",{get:function(){return this.currentYCoords},enumerable:!1,configurable:!0}),e.prototype.reverse=function(){this.currentXCoords=this.currentXCoords.reverse(),this.currentYCoords=this.currentYCoords.reverse()},e.prototype.reset=function(){this.init()},e.prototype.init=function(){this.currentXCoords=l(this.defaultXCoords),this.currentYCoords=l(this.defaultYCoords)},e}(),O=function(){function e(){}return e.prototype.dragEnded=function(e){e.source.reset(),e.source.element.nativeElement.style.zIndex="0",e.source.element.nativeElement.style.pointerEvents="auto",e.source.element.nativeElement.style.touchAction="auto"},e}(),_=function(){function e(){this.dragEndProcessor=new O}return e.prototype.process=function(e){this.dragEndProcessor.dragEnded(e)},e.prototype.setDragEndProcessor=function(e){this.dragEndProcessor=e},e}(),N=function(){function e(){}return e.prototype.dragStarted=function(e){var t=e.source.element.nativeElement.style;t.position="relative",t.zIndex="1000",t.touchAction="none",t.pointerEvents="none"},e}(),D=function(){function e(){this.dragStartProcessor=new N}return e.prototype.process=function(e){this.dragStartProcessor.dragStarted(e)},e.prototype.setDragStartProcessor=function(e){this.dragStartProcessor=e},e}(),j=function(){function e(){}return e.prototype.resolve=function(e,t,o){var i="green";return(e||t)&&(i="red"),o&&(i="blue"),(t||e)&&o&&(i="orange"),i},e}(),U=function(){function e(){this.colorProcessor=new j}return e.prototype.resolve=function(e,t,o){return this.colorProcessor.resolve(e,t,o)},e.prototype.setColorProcessor=function(e){this.colorProcessor=e},e}(),R=function(){function e(){this.arrowsSubject$=new r.BehaviorSubject([]),this.circlesSubject$=new r.BehaviorSubject([]),this.arrows$=this.arrowsSubject$.asObservable(),this.circles$=this.circlesSubject$.asObservable()}return Object.defineProperty(e.prototype,"circles",{get:function(){return this.circlesSubject$.value},set:function(e){this.circlesSubject$.next(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"arrows",{get:function(){return this.arrowsSubject$.value},set:function(e){this.arrowsSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addCircle=function(e){this.circles=l(this.circles,[e])},e.prototype.reomveCircle=function(e){this.circles=this.circles.filter((function(t){return!t.isEqual(e)}))},e.prototype.addArrow=function(e){this.arrows=l(this.arrows,[e])},e.prototype.removeArrow=function(e){this.arrows=this.arrows.filter((function(t){return!t.isEqual(e)}))},e.prototype.containsCircle=function(e){return this.circles.some((function(t){return t.isEqual(e)}))},e.prototype.containsArrow=function(e){return this.arrows.some((function(t){return t.isEqual(e)}))},e.prototype.clear=function(){this.arrows=[],this.circles=[]},e}(),G=function(){function e(e){this.dragStartStrategy=new D,this.dragEndStrategy=new _,this.colorStrategy=new U,this.coords=new S,this.heightAndWidth=K.DEFAULT_SIZE,this.freeMode=!1,this.drawProvider=new R,this.pieceIconManager=new L,this.moveHistoryProvider=new W,this.board=e}return e.prototype.checkIfPawnFirstMove=function(e){e instanceof w&&(e.isMovedAlready=!0)},e.prototype.checkIfRookMoved=function(e){e instanceof b&&(e.isMovedAlready=!0)},e.prototype.checkIfKingMoved=function(e){e instanceof y&&(e.isMovedAlready=!0)},e.prototype.getMoveHistory=function(){return this.moveHistoryProvider.getAll()},e}(),z=function(){function e(e,t){this.engineFacade=e,this.notationProcessor=t||k.getDefaultProcessor()}return e.prototype.addPieces=function(){A.loadDefaultPieces(this.engineFacade.board)},e.prototype.loadFEN=function(e){this.notationProcessor.process(e,this.engineFacade)},e.prototype.loadPGN=function(e){this.notationProcessor.process(e,this.engineFacade)},e.prototype.setEngineFacade=function(e){this.engineFacade=e},e.prototype.setNotationProcessor=function(e){this.notationProcessor=e},e}(),$=function(e){this.board=e},q=function(){function e(){this.statesSubject$=new r.BehaviorSubject([])}return Object.defineProperty(e.prototype,"states",{get:function(){return this.statesSubject$.value},set:function(e){this.statesSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addMove=function(e){this.states=l(this.states,[e])},e.prototype.getStates=function(){return this.states},e.prototype.pop=function(){var e=this.getLastState();return this.states=this.states.filter((function(t){return t!==e})),e},e.prototype.isEmpty=function(){return 0===this.states.length},e.prototype.clear=function(){this.states=[]},e.prototype.getLastState=function(){return this.states[this.getLastStateIndex()]},e.prototype.getLastStateIndex=function(){return this.states.length-1},e}(),Q=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.start.isEqual(e.start)&&this.end.isEqual(e.end)},e}(),X=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.drawPoint.isEqual(e.drawPoint)},e}(),Y=function(e){function t(t,o,i,r){var n=e.call(this,t)||this;return n.pointClicked=o,n.color=i,n.board=r,n}return a(t,e),t.prototype.getPossibleCaptures=function(){var e=this;return this.piece.getPossibleCaptures().filter((function(t){return!m.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t.prototype.getPossibleMoves=function(){var e=this;return this.piece.getPossibleMoves().filter((function(t){return!m.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t}((function(e){this.piece=e})),Z=function(){function e(){}return e.resolvePromotionChoice=function(e,t,o){var i=t.color===h.WHITE;switch(o){case 1:e.pieces.push(new E(t.point,t.color,i?P.WHITE_QUEEN:P.BLACK_QUEEN,e));break;case 2:e.pieces.push(new b(t.point,t.color,i?P.WHITE_ROOK:P.BLACK_ROOK,e));break;case 3:e.pieces.push(new g(t.point,t.color,i?P.WHITE_BISHOP:P.BLACK_BISHOP,e));break;case 4:e.pieces.push(new v(t.point,t.color,i?P.WHITE_KNIGHT:P.BLACK_KNIGHT,e))}},e}();!function(e){e[e.KING=1]="KING",e[e.QUEEN=2]="QUEEN",e[e.BISHOP=3]="BISHOP",e[e.KNIGHT=4]="KNIGHT",e[e.ROOK=5]="ROOK",e[e.PAWN=6]="PAWN"}(x||(x={})),function(e){e[e.LIGHT=1]="LIGHT",e[e.DARK=2]="DARK"}(M||(M={}));var V=function(){function e(){}return e.create=function(e,t,o,i){var r,n=o===M.LIGHT?h.WHITE:h.BLACK;switch(t){case x.QUEEN:r=new E(new f(e.yAxis,e.xAxis),n,n===h.WHITE?P.WHITE_QUEEN:P.BLACK_QUEEN,i);break;case x.KING:r=new y(new f(e.yAxis,e.xAxis),n,n===h.WHITE?P.WHITE_KING:P.BLACK_KING,i);break;case x.KNIGHT:r=new v(new f(e.yAxis,e.xAxis),n,n===h.WHITE?P.WHITE_KNIGHT:P.BLACK_KNIGHT,i);break;case x.BISHOP:r=new g(new f(e.yAxis,e.xAxis),n,n===h.WHITE?P.WHITE_BISHOP:P.BLACK_BISHOP,i);break;case x.ROOK:r=new b(new f(e.yAxis,e.xAxis),n,n===h.WHITE?P.WHITE_ROOK:P.BLACK_ROOK,i);break;case x.PAWN:r=new w(new f(e.yAxis,e.xAxis),n,n===h.WHITE?P.WHITE_PAWN:P.BLACK_PAWN,i)}return r},e}(),J=function(e){function t(t,o){var i=e.call(this,t)||this;return i._selected=!1,i.disabling=!1,i.moveChange=o,i.boardLoader=new z(i),i.boardLoader.addPieces(),i.boardStateProvider=new q,i}return a(t,e),t.prototype.reset=function(){this.boardStateProvider.clear(),this.moveHistoryProvider.clear(),this.boardLoader.addPieces(),this.board.reset(),this.coords.reset(),this.drawProvider.clear(),this.freeMode=!1},t.prototype.undo=function(){if(!this.boardStateProvider.isEmpty()){var e=this.boardStateProvider.pop().board;this.board.reverted&&e.reverse(),this.board=e,this.board.possibleCaptures=[],this.board.possibleMoves=[],this.moveHistoryProvider.pop()}},t.prototype.saveMoveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.moveStateProvider.addMove(new $(e))},t.prototype.move=function(e){if(e){var t=m.translateCoordsToIndex(e.substring(0,2),this.board.reverted),o=m.translateCoordsToIndex(e.substring(2,4),this.board.reverted),i=this.board.getPieceByPoint(t.yAxis,t.xAxis);if(i){if(this.board.currentWhitePlayer&&i.color===h.BLACK||!this.board.currentWhitePlayer&&i.color===h.WHITE)return;this.prepareActivePiece(i,i.point),this.board.isPointInPossibleMoves(new f(o.yAxis,o.xAxis))||this.board.isPointInPossibleCaptures(new f(o.yAxis,o.xAxis))?(this.saveClone(),this.movePiece(i,new f(o.yAxis,o.xAxis),5===e.length?+e.substring(4,5):0),this.board.lastMoveSrc=new f(t.yAxis,t.xAxis),this.board.lastMoveDest=new f(o.yAxis,o.xAxis),this.disableSelection()):this.disableSelection()}}},t.prototype.prepareActivePiece=function(e,t){this.board.activePiece=e,this._selected=!0,this.board.possibleCaptures=new Y(e,t,this.board.currentWhitePlayer?h.WHITE:h.BLACK,this.board).getPossibleCaptures(),this.board.possibleMoves=new Y(e,t,this.board.currentWhitePlayer?h.WHITE:h.BLACK,this.board).getPossibleMoves()},t.prototype.onPieceClicked=function(e,t){this.board.currentWhitePlayer&&e.color===h.BLACK||!this.board.currentWhitePlayer&&e.color===h.WHITE||this.prepareActivePiece(e,t)},t.prototype.handleClickEvent=function(e,t){var o=!1;(this.board.isPointInPossibleMoves(e)||this.board.isPointInPossibleCaptures(e)||this.freeMode)&&(this.saveClone(),this.board.lastMoveSrc=new f(this.board.activePiece.point.row,this.board.activePiece.point.col),this.board.lastMoveDest=e.clone(),this.movePiece(this.board.activePiece,e),this.board.activePiece.point.isEqual(this.board.lastMoveSrc)||(o=!0)),(t||o)&&this.disableSelection(),this.disableSelection();var i=this.board.getPieceByPoint(e.row,e.col);i&&!o&&(this.onFreeMode(i),this.onPieceClicked(i,e))},t.prototype.onMouseDown=function(e,t,o,i){if(0===e.button)if(this.drawProvider.clear(),this.board.activePiece&&t.isEqual(this.board.activePiece.point))this.disabling=!0;else{var r=this.board.getPieceByPoint(t.row,t.col);if(this.freeMode&&r){if(e.ctrlKey)return void(this.board.pieces=this.board.pieces.filter((function(e){return e!==r})));this.board.currentWhitePlayer=r.color===h.WHITE}this.isPieceDisabled(r)||(this._selected?this.handleClickEvent(t,!0):r&&(this.onFreeMode(r),this.onPieceClicked(r,t)))}else this.drawPoint=B.getDrawingPoint(this.heightAndWidth,this.colorStrategy,e.x,e.y,e.ctrlKey,e.altKey,e.shiftKey,o,i)},t.prototype.onMouseUp=function(e,t,o,i){if(0===e.button||this.drawDisabled){if(this.drawProvider.clear(),!this.dragDisabled){if(this.board.activePiece&&t.isEqual(this.board.activePiece.point)&&this.disabling)return this.disableSelection(),void(this.disabling=!1);var r=this.board.getPieceByPoint(t.row,t.col);this.isPieceDisabled(r)||this._selected&&this.handleClickEvent(t,!1)}}else this.addDrawPoint(e.x,e.y,e.ctrlKey,e.altKey,e.shiftKey,o,i)},t.prototype.saveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.boardStateProvider.addMove(new $(e))},t.prototype.movePiece=function(e,t,o){var i=this.board.pieces.find((function(e){return e.point.col===t.col&&e.point.row===t.row}));if(i&&e.color!==i.color)this.board.pieces=this.board.pieces.filter((function(e){return e!==i}));else if(i&&e.color===i.color)return;var r=new H(m.format(e.point,t,this.board.reverted),e.constant.name,e.color===h.WHITE?"white":"black",!!i);if((this.moveHistoryProvider.addMove(r),e instanceof y)&&Math.abs(t.col-e.point.col)>1)if(t.col<3){var n=this.board.getPieceByField(e.point.row,0);this.freeMode||(n.point.col=this.board.reverted?2:3)}else{var s=this.board.getPieceByField(e.point.row,7);this.freeMode||(s.point.col=this.board.reverted?4:5)}e instanceof w?(this.board.checkIfPawnTakesEnPassant(t),this.board.checkIfPawnEnpassanted(e,t)):(this.board.enPassantPoint=null,this.board.enPassantPiece=null),e.point=t,this.increaseFullMoveCount(),this.board.currentWhitePlayer=!this.board.currentWhitePlayer,this.checkForPawnPromote(e,o)||this.afterMoveActions()},t.prototype.checkForPawnPromote=function(e,t){if(e instanceof w)return 0===e.point.row||7===e.point.row?(this.board.pieces=this.board.pieces.filter((function(t){return t!==e})),t?(Z.resolvePromotionChoice(this.board,e,t),this.afterMoveActions(t)):this.openPromoteDialog(e),!0):void 0},t.prototype.afterMoveActions=function(e){this.checkIfPawnFirstMove(this.board.activePiece),this.checkIfRookMoved(this.board.activePiece),this.checkIfKingMoved(this.board.activePiece),this.board.blackKingChecked=this.board.isKingInCheck(h.BLACK,this.board.pieces),this.board.whiteKingChecked=this.board.isKingInCheck(h.WHITE,this.board.pieces);var t=this.board.blackKingChecked||this.board.whiteKingChecked,o=this.checkForPossibleMoves(h.BLACK)||this.checkForPossibleMoves(h.WHITE),i=this.checkForPat(h.BLACK)||this.checkForPat(h.WHITE);this.disabling=!1,this.board.calculateFEN();var r=this.moveHistoryProvider.getLastMove();r&&e&&(r.move+=e),this.moveChange.emit(Object.assign(Object.assign({},r),{check:t,checkmate:o,stalemate:i,fen:this.board.fen,freeMode:this.freeMode}))},t.prototype.checkForPat=function(e){return(e!==h.WHITE||this.board.whiteKingChecked)&&(e!==h.BLACK||this.board.blackKingChecked)?void 0:this.checkForPossibleMoves(e)},t.prototype.openPromoteDialog=function(e){var t=this;this.modal.open((function(o){Z.resolvePromotionChoice(t.board,e,o),t.afterMoveActions(o)}))},t.prototype.checkForPossibleMoves=function(e){var t=this;return!this.board.pieces.filter((function(t){return t.color===e})).some((function(o){return o.getPossibleMoves().some((function(i){return!m.willMoveCauseCheck(e,o.point.row,o.point.col,i.row,i.col,t.board)}))||o.getPossibleCaptures().some((function(i){return!m.willMoveCauseCheck(e,o.point.row,o.point.col,i.row,i.col,t.board)}))}))},t.prototype.disableSelection=function(){this._selected=!1,this.board.possibleCaptures=[],this.board.activePiece=null,this.board.possibleMoves=[]},t.prototype.onFreeMode=function(e){this.freeMode&&null!=e&&(this.board.currentWhitePlayer=e.color===h.WHITE)},t.prototype.isPieceDisabled=function(e){if(e&&e.point&&this.board.possibleCaptures.find((function(t){return t.col===e.point.col&&t.row===e.point.row})))return!1;return e&&(this.lightDisabled&&e.color===h.WHITE||this.darkDisabled&&e.color===h.BLACK)},t.prototype.addDrawPoint=function(e,t,o,i,r,n,s){var a=B.getDrawingPoint(this.heightAndWidth,this.colorStrategy,e,t,o,i,r,n,s);if(this.drawPoint.isEqual(a)){var c=new X;c.drawPoint=a,this.drawProvider.containsCircle(c)?this.drawProvider.reomveCircle(c):this.drawProvider.addCircle(c)}else{var d=new Q;d.start=this.drawPoint,d.end=a,this.drawProvider.containsArrow(d)?this.drawProvider.removeArrow(d):this.drawProvider.addArrow(d)}},t.prototype.increaseFullMoveCount=function(){this.board.currentWhitePlayer||++this.board.fullMoveCount},t.prototype.addPiece=function(e,t,o){if(this.freeMode&&o&&e>0&&t>0){var i=m.translateCoordsToIndex(o,this.board.reverted),r=this.board.getPieceByPoint(i.yAxis,i.xAxis);r&&(this.board.pieces=this.board.pieces.filter((function(e){return e!==r})));var n=V.create(i,e,t,this.board);this.saveClone(),this.board.pieces.push(n),this.afterMoveActions()}},t}(G),ee=function(){function e(){this.board=[],this.pieces=[],this.enPassantPoint=null,this.enPassantPiece=null,this.lastMoveSrc=null,this.lastMoveDest=null,this.possibleCaptures=[],this.possibleMoves=[],this.currentWhitePlayer=!0,this.reverted=!1,this.fullMoveCount=1;for(var e=0;e<8;++e){this.board[e]=[];for(var t=0;t<8;++t)this.board[e][t]=0}}return e.prototype.isXYInPossibleMoves=function(e,t){return this.possibleMoves.some((function(o){return o.row===e&&o.col===t}))},e.prototype.isXYInPossibleCaptures=function(e,t){return this.possibleCaptures.some((function(o){return o.row===e&&o.col===t}))},e.prototype.isXYInSourceMove=function(e,t){return this.lastMoveSrc&&this.lastMoveSrc.row===e&&this.lastMoveSrc.col===t},e.prototype.isXYInDestMove=function(e,t){return this.lastMoveDest&&this.lastMoveDest.row===e&&this.lastMoveDest.col===t},e.prototype.isXYInActiveMove=function(e,t){return this.activePiece&&this.activePiece.point.row===e&&this.activePiece.point.col===t},e.prototype.isPointInPossibleMoves=function(e){return this.possibleMoves.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.isPointInPossibleCaptures=function(e){return this.possibleCaptures.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.reset=function(){this.lastMoveDest=null,this.lastMoveSrc=null,this.whiteKingChecked=!1,this.blackKingChecked=!1,this.possibleCaptures=[],this.possibleMoves=[],this.activePiece=null,this.reverted=!1,this.currentWhitePlayer=!0,this.enPassantPoint=null,this.enPassantPiece=null,this.fullMoveCount=1,this.calculateFEN()},e.prototype.reverse=function(){var e=this;this.reverted=!this.reverted,this.activePiece=null,this.possibleMoves=[],this.possibleCaptures=[],this.pieces.forEach((function(t){return e.reversePoint(t.point)})),this.reversePoint(this.lastMoveSrc),this.reversePoint(this.lastMoveDest),this.enPassantPoint&&this.enPassantPiece&&this.reversePoint(this.enPassantPoint)},e.prototype.clone=function(){return n.cloneDeep(this)},e.prototype.isFieldTakenByEnemy=function(e,t,o){return!(e>7||e<0||t>7||t<0)&&this.pieces.some((function(i){return i.point.col===t&&i.point.row===e&&i.color===o}))},e.prototype.isFieldEmpty=function(e,t){return!(e>7||e<0||t>7||t<0)&&!this.pieces.some((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.isFieldUnderAttack=function(e,t,o){return this.pieces.filter((function(e){return e.color===o})).some((function(o){return o.getCoveredFields().some((function(o){return o.col===t&&o.row===e}))}))},e.prototype.getPieceByField=function(e,t){if(!this.isFieldEmpty(e,t))return this.pieces.find((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.isKingInCheck=function(e,t){var o=t.find((function(t){return t.color===e&&t instanceof y}));return!!o&&t.some((function(t){return t.getPossibleCaptures().some((function(e){return e.col===o.point.col&&e.row===o.point.row}))&&t.color!==e}))},e.prototype.getKingByColor=function(e){return this.pieces.find((function(t){return t instanceof y&&t.color===e}))},e.prototype.getCastleFENString=function(e){var t=this.getKingByColor(e);if(!t||t.isMovedAlready)return"";var o="",i=this.getPieceByField(t.point.row,0),r=this.getPieceByField(t.point.row,7);return r instanceof b&&r.color===e&&(r.isMovedAlready||(o+=this.reverted?"q":"k")),i instanceof b&&i.color===e&&(i.isMovedAlready||(o+=this.reverted?"k":"q")),o=o.split("").sort().join(""),e===h.BLACK?o:o.toUpperCase()},e.prototype.getEnPassantFENString=function(){return this.enPassantPoint?this.reverted?String.fromCharCode(104-this.enPassantPoint.col)+(this.enPassantPoint.row+1):String.fromCharCode(97+this.enPassantPoint.col)+(Math.abs(this.enPassantPoint.row-7)+1):"-"},e.prototype.calculateFEN=function(){for(var e="",t=function(t){for(var i=0,r=function(r){var n=o.pieces.find((function(e){return e.point.col===r&&e.point.row===t}));n?(i>0&&(e+=i,i=0),n instanceof b?e+=n.color===h.BLACK?"r":"R":n instanceof v?e+=n.color===h.BLACK?"n":"N":n instanceof g?e+=n.color===h.BLACK?"b":"B":n instanceof E?e+=n.color===h.BLACK?"q":"Q":n instanceof y?e+=n.color===h.BLACK?"k":"K":n instanceof w&&(e+=n.color===h.BLACK?"p":"P")):++i},n=0;n<8;++n)r(n);i>0&&(e+=i),e+="/"},o=this,i=0;i<8;++i)t(i);e=e.substr(0,e.length-1),this.reverted&&(e=e.split("").reverse().join("")),e+=" "+(this.currentWhitePlayer?"w":"b");var r=this.getCastleFENString(h.WHITE)+this.getCastleFENString(h.BLACK);r||(r="-"),e+=" "+r,e+=" "+this.getEnPassantFENString(),e+=" 0",e+=" "+this.fullMoveCount,this.fen=e},e.prototype.isXYInPointSelection=function(e,t){return!1},e.prototype.reversePoint=function(e){e&&(e.row=Math.abs(e.row-7),e.col=Math.abs(e.col-7))},e.prototype.getPieceByPoint=function(e,t){return e=Math.floor(e),t=Math.floor(t),this.pieces.find((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.checkIfPawnTakesEnPassant=function(e){var t=this;e.isEqual(this.enPassantPoint)&&(console.log("usuwam"),this.pieces=this.pieces.filter((function(e){return e!==t.enPassantPiece})),this.enPassantPoint=null,this.enPassantPiece=null)},e.prototype.checkIfPawnEnpassanted=function(e,t){Math.abs(e.point.row-t.row)>1?(this.enPassantPiece=e,this.enPassantPoint=new f((e.point.row+t.row)/2,e.point.col)):(this.enPassantPoint=null,this.enPassantPiece=null)},e.prototype.isKingChecked=function(e){if(e instanceof y)return e.color===h.WHITE?this.whiteKingChecked:this.blackKingChecked},e}(),te=function(){function e(){this.componentMethodCallSource=new r.Subject,this.componentMethodCalled$=this.componentMethodCallSource.asObservable()}return e.prototype.reset=function(){this.componentMethodCallSource.next()},e}();te.prov=i.defineInjectable({factory:function(){return new te},token:te,providedIn:"root"}),te.decorators=[{type:i.Injectable,args:[{providedIn:"root"}]}];var oe=function(){function e(e){this.ngxChessBoardService=e,this.darkTileColor=K.DEFAULT_DARK_TILE_COLOR,this.lightTileColor=K.DEFAULT_LIGHT_TILE_COLOR,this.showCoords=!0,this.moveChange=new i.EventEmitter,this.checkmate=new i.EventEmitter,this.stalemate=new i.EventEmitter,this.selected=!1,this.engineFacade=new J(new ee,this.moveChange)}return Object.defineProperty(e.prototype,"size",{set:function(e){e&&e>=K.MIN_BOARD_SIZE&&e<=K.MAX_BOARD_SIZE?this.engineFacade.heightAndWidth=e:this.engineFacade.heightAndWidth=K.DEFAULT_SIZE,this.engineFacade.drawProvider.clear(),this.calculatePieceSize()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"freeMode",{set:function(e){this.engineFacade.freeMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dragDisabled",{set:function(e){this.engineFacade.dragDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawDisabled",{set:function(e){this.engineFacade.drawDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pieceIcons",{set:function(e){this.pieceIconManager.pieceIconInput=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lightDisabled",{set:function(e){this.engineFacade.lightDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"darkDisabled",{set:function(e){this.engineFacade.darkDisabled=e},enumerable:!1,configurable:!0}),e.prototype.onRightClick=function(e){e.preventDefault()},e.prototype.ngOnChanges=function(e){(e.lightDisabled&&this.lightDisabled&&this.engineFacade.board.currentWhitePlayer||e.darkDisabled&&this.darkDisabled&&!this.engineFacade.board.currentWhitePlayer)&&(this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[])},e.prototype.ngOnInit=function(){var e=this;this.ngxChessBoardService.componentMethodCalled$.subscribe((function(){e.engineFacade.reset()}))},e.prototype.ngAfterViewInit=function(){this.engineFacade.modal=this.modal,this.calculatePieceSize()},e.prototype.onMouseUp=function(e){this.engineFacade.onMouseUp(e,this.getClickPoint(e),this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().top)},e.prototype.reverse=function(){this.selected=!1,this.engineFacade.board.reverse(),this.engineFacade.coords.reverse()},e.prototype.updateBoard=function(e){this.engineFacade.board=e,this.boardLoader.setEngineFacade(this.engineFacade),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[]},e.prototype.setFEN=function(e){try{this.engineFacade.boardLoader.setNotationProcessor(k.getProcessor(p.FEN)),this.engineFacade.boardLoader.loadFEN(e),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[],this.engineFacade.coords.reset()}catch(e){this.engineFacade.boardLoader.addPieces()}},e.prototype.setPGN=function(e){try{this.engineFacade.boardLoader.setNotationProcessor(k.getProcessor(p.PGN)),this.engineFacade.boardLoader.loadPGN(e),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[],this.engineFacade.coords.reset()}catch(e){console.log(e),this.engineFacade.boardLoader.addPieces()}},e.prototype.getFEN=function(){return this.engineFacade.board.fen},e.prototype.dragEnded=function(e){this.engineFacade.dragEndStrategy.process(e)},e.prototype.dragStart=function(e){this.engineFacade.dragStartStrategy.process(e)},e.prototype.onMouseDown=function(e){this.engineFacade.onMouseDown(e,this.getClickPoint(e),this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().top)},e.prototype.getClickPoint=function(e){return B.getClickPoint(e,this.boardRef.nativeElement.getBoundingClientRect().top,this.boardRef.nativeElement.getBoundingClientRect().height,this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().width)},e.prototype.calculatePieceSize=function(){this.pieceSize=this.engineFacade.heightAndWidth/10},e.prototype.getCustomPieceIcons=function(e){return JSON.parse('{ "background-image": "url(\''+this.engineFacade.pieceIconManager.getPieceIcon(e)+"')\"}")},e.prototype.move=function(e){this.engineFacade.move(e)},e.prototype.getMoveHistory=function(){return this.engineFacade.getMoveHistory()},e.prototype.reset=function(){this.engineFacade.reset()},e.prototype.undo=function(){this.engineFacade.undo()},e.prototype.addPiece=function(e,t,o){this.engineFacade.addPiece(e,t,o)},e}();oe.decorators=[{type:i.Component,args:[{selector:"ngx-chess-board",template:'<div\r\n    id="board"\r\n    [style.height.px]="engineFacade.heightAndWidth"\r\n    [style.width.px]="engineFacade.heightAndWidth"\r\n    (pointerdown)="!modal.opened && onMouseDown($event)"\r\n    (pointerup)="!modal.opened && onMouseUp($event)"\r\n    #boardRef\r\n>\r\n    <div id="drag">\r\n        <div\r\n            class="board-row"\r\n            *ngFor="let row of engineFacade.board.board; let i = index"\r\n        >\r\n            <div\r\n                class="board-col"\r\n                [class.current-selection]="engineFacade.board.isXYInActiveMove(i,j)"\r\n                [class.dest-move]="engineFacade.board.isXYInDestMove(i,j)"\r\n                [class.king-check]=" engineFacade.board.isKingChecked(engineFacade.board.getPieceByPoint(i,j))"\r\n                [class.point-circle]="engineFacade.board.isXYInPointSelection(i, j)"\r\n                [class.possible-capture]="engineFacade.board.isXYInPossibleCaptures(i, j)"\r\n                [class.possible-point]="engineFacade.board.isXYInPossibleMoves(i, j)"\r\n                [class.source-move]="engineFacade.board.isXYInSourceMove(i, j)"\r\n                [style.background-color]="((i + j) % 2 === 0 ) ? lightTileColor : darkTileColor"\r\n                *ngFor="let col of row; let j = index"\r\n            >\r\n                <span\r\n                    class="yCoord"\r\n                    [style.color]="(i % 2 === 0) ? lightTileColor : darkTileColor"\r\n                    [style.font-size.px]="pieceSize / 4"\r\n                    *ngIf="showCoords && j === 7"\r\n                >\r\n                    {{engineFacade.coords.yCoords[i]}}\r\n                </span>\r\n                <span\r\n                    class="xCoord"\r\n                    [style.color]="(j % 2 === 0) ? lightTileColor : darkTileColor"\r\n                    [style.font-size.px]="pieceSize / 4"\r\n                    *ngIf="showCoords && i === 7"\r\n                >\r\n                    {{engineFacade.coords.xCoords[j]}}\r\n                </span>\r\n                <div\r\n                    *ngIf="engineFacade.board.getPieceByPoint(i, j) as piece"\r\n                    style="height:100%; width:100%"\r\n                >\r\n                    <div\r\n                        [cdkDragDisabled]="engineFacade.dragDisabled"\r\n                        [innerHTML]="engineFacade.pieceIconManager.isDefaultIcons() ? engineFacade.board.getPieceByPoint(i,j).constant.icon : \'\'"\r\n                        [ngClass]="\'piece\'"\r\n                        [style.font-size]="pieceSize + \'px\'"\r\n                        [ngStyle]="engineFacade.pieceIconManager.isDefaultIcons() ? \'\' : getCustomPieceIcons(engineFacade.board.getPieceByPoint(i,j))"\r\n                        (cdkDragEnded)="dragEnded($event)"\r\n                        (cdkDragStarted)="dragStart($event)"\r\n                        cdkDrag\r\n                    >\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <svg\r\n        [attr.height]="engineFacade.heightAndWidth"\r\n        [attr.width]="engineFacade.heightAndWidth"\r\n        style="position:absolute; top:0; pointer-events: none"\r\n    >\r\n        <defs *ngFor="let color of [\'red\', \'green\', \'blue\', \'orange\']">\r\n            <marker\r\n                [id]="color + \'Arrow\'"\r\n                markerHeight="13"\r\n                markerWidth="13"\r\n                orient="auto"\r\n                refX="9"\r\n                refY="6"\r\n            >\r\n                <path\r\n                    [style.fill]="color"\r\n                    d="M2,2 L2,11 L10,6 L2,2"\r\n                ></path>\r\n            </marker>\r\n        </defs>\r\n        <line\r\n            class="arrow"\r\n            [attr.marker-end]="\'url(#\' + arrow.end.color + \'Arrow)\'"\r\n            [attr.stroke]="arrow.end.color"\r\n            [attr.x1]="arrow.start.x"\r\n            [attr.x2]="arrow.end.x"\r\n            [attr.y1]="arrow.start.y"\r\n            [attr.y2]="arrow.end.y"\r\n            *ngFor="let arrow of engineFacade.drawProvider.arrows$ | async"\r\n        ></line>\r\n        <circle\r\n            [attr.cx]="circle.drawPoint.x"\r\n            [attr.cy]="circle.drawPoint.y"\r\n            [attr.r]="engineFacade.heightAndWidth / 18"\r\n            [attr.stroke]="circle.drawPoint.color"\r\n            *ngFor="let circle of engineFacade.drawProvider.circles$ | async"\r\n            fill-opacity="0.0"\r\n            stroke-width="2"\r\n        ></circle>\r\n    </svg>\r\n    <app-piece-promotion-modal #modal></app-piece-promotion-modal>\r\n</div>\r\n',styles:['@charset "UTF-8";#board{font-family:Courier New,serif;position:relative}.board-row{display:block;height:12.5%;position:relative;width:100%}.board-col{cursor:default;display:inline-block;height:100%;position:relative;vertical-align:top;width:12.5%}.piece{-moz-user-select:none;-webkit-user-select:none;background-size:cover;color:#000!important;cursor:-webkit-grab;cursor:grab;height:100%;justify-content:center;text-align:center;user-select:none;width:100%}.piece,.piece:after{box-sizing:border-box}.piece:after{content:""}#drag{height:100%;width:100%}.possible-point{background:radial-gradient(#13262f 15%,transparent 20%)}.possible-capture:hover,.possible-point:hover{opacity:.4}.possible-capture{background:radial-gradient(transparent 0,transparent 80%,#13262f 0);box-sizing:border-box;margin:0;opacity:.5;padding:0}.king-check{background:radial-gradient(ellipse at center,red 0,#e70000 25%,rgba(169,0,0,0) 89%,rgba(158,0,0,0) 100%)}.source-move{background-color:rgba(146,111,26,.79)!important}.dest-move{background-color:#b28e1a!important}.current-selection{background-color:#72620b!important}.yCoord{right:.2em}.xCoord,.yCoord{-moz-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;font-family:Lucida Console,Courier,monospace;position:absolute;user-select:none}.xCoord{bottom:0;left:.2em}.hovering{background-color:red!important}.arrow{stroke-width:2}svg{filter:drop-shadow(1px 1px 0 #111) drop-shadow(-1px 1px 0 #111) drop-shadow(1px -1px 0 #111) drop-shadow(-1px -1px 0 #111)}:host{display:inline-block!important}']}]}],oe.ctorParameters=function(){return[{type:te}]},oe.propDecorators={darkTileColor:[{type:i.Input}],lightTileColor:[{type:i.Input}],showCoords:[{type:i.Input}],moveChange:[{type:i.Output}],checkmate:[{type:i.Output}],stalemate:[{type:i.Output}],boardRef:[{type:i.ViewChild,args:["boardRef"]}],modal:[{type:i.ViewChild,args:["modal"]}],size:[{type:i.Input,args:["size"]}],freeMode:[{type:i.Input,args:["freeMode"]}],dragDisabled:[{type:i.Input,args:["dragDisabled"]}],drawDisabled:[{type:i.Input,args:["drawDisabled"]}],pieceIcons:[{type:i.Input,args:["pieceIcons"]}],lightDisabled:[{type:i.Input,args:["lightDisabled"]}],darkDisabled:[{type:i.Input,args:["darkDisabled"]}],onRightClick:[{type:i.HostListener,args:["contextmenu",["$event"]]}]};var ie=function(){function e(){this.opened=!1}return e.prototype.open=function(e){this.opened=!0,this.onCloseCallback=e,this.modal.nativeElement.style.display="block"},e.prototype.changeSelection=function(e){this.modal.nativeElement.style.display="none",this.opened=!1,this.onCloseCallback(e)},e}();ie.decorators=[{type:i.Component,args:[{selector:"app-piece-promotion-modal",template:'<div #myModal class="container">\r\n    <div class="wrapper">\r\n        <div class="content">\r\n            <div class="piece-wrapper">\r\n                <div class="piece" (click)="changeSelection(1)">&#x265B;</div>\r\n                <div class="piece" (click)="changeSelection(2)">&#x265C;</div>\r\n                <div class="piece" (click)="changeSelection(3)">&#x265D;</div>\r\n                <div class="piece" (click)="changeSelection(4)">&#x265E;</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',styles:[".container{background-color:rgba(0,0,0,.4);color:#000;display:none;overflow:auto;position:absolute;top:0;z-index:1}.container,.wrapper{height:100%;width:100%}.content,.wrapper{position:relative}.content{background-color:#fefefe;border:1px solid #888;font-size:100%;height:40%;margin:auto;padding:10px;top:30%;width:90%}.piece{cursor:pointer;display:inline-block;font-size:5rem;height:100%;width:25%}.piece:hover{background-color:#ccc;border-radius:5px}.piece-wrapper{height:80%;width:100%}#close-button{background-color:#4caf50;border:none;border-radius:4px;color:#fff;display:inline-block;padding-left:5px;padding-right:5px;text-align:center;text-decoration:none}.selected{border:2px solid #00b919;border-radius:4px;box-sizing:border-box}"]}]}],ie.propDecorators={modal:[{type:i.ViewChild,args:["myModal",{static:!1}]}]};var re=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[te]}},e}();re.decorators=[{type:i.NgModule,args:[{declarations:[oe,ie],imports:[o.CommonModule,t.DragDropModule],exports:[oe]}]}],e.HistoryMove=H,e.NgxChessBoardComponent=oe,e.NgxChessBoardModule=re,e.NgxChessBoardService=te,e.PiecePromotionModalComponent=ie,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-chess-board.umd.min.js.map