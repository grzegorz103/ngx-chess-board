!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/cdk/drag-drop"),require("@angular/common"),require("@angular/core"),require("rxjs"),require("lodash")):"function"==typeof define&&define.amd?define("ngx-chess-board",["exports","@angular/cdk/drag-drop","@angular/common","@angular/core","rxjs","lodash"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-chess-board"]={},e.ng.cdk.dragDrop,e.ng.common,e.ng.core,e.rxjs,e.lodash)}(this,(function(e,t,o,i,n,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)};function a(e,t){function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}Object.create;function c(e){var t="function"==typeof Symbol&&Symbol.iterator,o=t&&e[t],i=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function d(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var i,n,r=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}return s}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}var h;Object.create;!function(e){e[e.WHITE=0]="WHITE",e[e.BLACK=1]="BLACK"}(h||(h={}));var p,u=function(e,t,o,i,n){this.checkPoints=[],this.color=t,this.constant=o,this.point=e,this.relValue=i,this.board=n},f=function(){function e(e,t){this.row=e,this.col=t}return e.prototype.isEqual=function(e){return e&&this.row===e.row&&this.col===e.col},e.prototype.hasCoordsEqual=function(e,t){return e&&t&&this.row===e&&this.col===t},e.prototype.clone=function(){return new e(this.row,this.col)},e}(),b=function(e){function t(t,o,i,n){var r=e.call(this,t,o,i,5,n)||this;return r.isMovedAlready=!1,r}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8&&this.board.isFieldEmpty(i,o);++i)e.push(new f(i,o));for(i=t-1;i>=0&&this.board.isFieldEmpty(i,o);--i)e.push(new f(i,o));for(var n=o-1;n>=0&&this.board.isFieldEmpty(t,n);--n)e.push(new f(t,n));for(n=o+1;n<8&&this.board.isFieldEmpty(t,n);++n)e.push(new f(t,n));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i){if(this.board.isFieldTakenByEnemy(i,o,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(i=t-1;i>=0;--i){if(this.board.isFieldTakenByEnemy(i,o,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(var n=o-1;n>=0;--n){if(this.board.isFieldTakenByEnemy(t,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(t,n));break}if(!this.board.isFieldEmpty(t,n))break}for(n=o+1;n<8;++n){if(this.board.isFieldTakenByEnemy(t,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(t,n));break}if(!this.board.isFieldEmpty(t,n))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i)if(this.board.isFieldEmpty(i,o))e.push(new f(i,o));else if(!(this.board.getPieceByField instanceof g)){e.push(new f(i,o));break}for(i=t-1;i>=0;--i)if(this.board.isFieldEmpty(i,o))e.push(new f(i,o));else if(!(this.board.getPieceByField instanceof g)){e.push(new f(i,o));break}for(var n=o-1;n>=0;--n)if(this.board.isFieldEmpty(t,n))e.push(new f(t,n));else if(!(this.board.getPieceByField instanceof g)){e.push(new f(t,n));break}for(n=o+1;n<8;++n)if(this.board.isFieldEmpty(t,n))e.push(new f(t,n));else if(!(this.board.getPieceByField instanceof g)){e.push(new f(t,n));break}return e},t}(u),g=function(e){function t(t,o,i,n){var r=e.call(this,t,o,i,0,n)||this;return r.castledAlready=!1,r.shortCastled=!1,r.longCastled=!1,r.isCastling=!1,r}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;if(this.board.isFieldEmpty(t,o-1)&&!this.board.isFieldUnderAttack(t,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t,o-1)),this.board.isFieldEmpty(t,o+1)&&!this.board.isFieldUnderAttack(t,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t,o+1)),this.board.isFieldEmpty(t+1,o)&&!this.board.isFieldUnderAttack(t+1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o)),this.board.isFieldEmpty(t-1,o)&&!this.board.isFieldUnderAttack(t-1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o)),this.board.isFieldEmpty(t-1,o-1)&&!this.board.isFieldUnderAttack(t-1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o-1)),this.board.isFieldEmpty(t-1,o+1)&&!this.board.isFieldUnderAttack(t-1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o+1)),this.board.isFieldEmpty(t+1,o-1)&&!this.board.isFieldUnderAttack(t+1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o-1)),this.board.isFieldEmpty(t+1,o+1)&&!this.board.isFieldUnderAttack(t+1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o+1)),!this.isMovedAlready){for(var i=!0,n=o-1;n>0;--n)if(!this.board.isFieldEmpty(t,n)||this.board.isFieldUnderAttack(t,n,this.color===h.WHITE?h.BLACK:h.WHITE)){i=!1;break}if(i&&!this.board.isKingInCheck(this.color,this.board.pieces)&&this.board.getPieceByField(t,0)){var r=this.board.getPieceByField(t,0);r instanceof b&&(r.isMovedAlready||e.push(new f(t,o-2)))}var s=!0;for(n=o+1;n<7;++n)if(!this.board.isFieldEmpty(t,n)||this.board.isFieldUnderAttack(t,n,this.color===h.WHITE?h.BLACK:h.WHITE)){s=!1;break}if(s&&!this.board.isKingInCheck(this.color,this.board.pieces)&&this.board.getPieceByField(t,7)){var a=this.board.getPieceByField(t,7);a instanceof b&&(a.isMovedAlready||e.push(new f(t,o+2)))}}return e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldTakenByEnemy(t,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t,o-1)),this.board.isFieldTakenByEnemy(t,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t,o+1)),this.board.isFieldTakenByEnemy(t+1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t+1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o)),this.board.isFieldTakenByEnemy(t-1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t-1,o,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o)),this.board.isFieldTakenByEnemy(t-1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t-1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o-1)),this.board.isFieldTakenByEnemy(t-1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t-1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o+1)),this.board.isFieldTakenByEnemy(t+1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t+1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o-1)),this.board.isFieldTakenByEnemy(t+1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&!this.board.isFieldUnderAttack(t+1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return e.push(new f(t,o-1)),e.push(new f(t,o+1)),e.push(new f(t+1,o)),e.push(new f(t-1,o)),e.push(new f(t-1,o-1)),e.push(new f(t-1,o+1)),e.push(new f(t+1,o-1)),e.push(new f(t+1,o+1)),e},t}(u),y=function(e){function t(t,o,i,n){return e.call(this,t,o,i,3,n)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,n=o-1;i>=0&&n>=0&&this.board.isFieldEmpty(i,n);--i,--n)e.push(new f(i,n));for(i=t-1,n=o+1;i>=0&&n<8&&this.board.isFieldEmpty(i,n);--i,++n)e.push(new f(i,n));for(i=t+1,n=o-1;i<8&&n>=0&&this.board.isFieldEmpty(i,n);++i,--n)e.push(new f(i,n));for(i=t+1,n=o+1;i<8&&n<8&&this.board.isFieldEmpty(i,n);++i,++n)e.push(new f(i,n));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,n=o-1;i>=0&&n>=0;--i,--n){if(this.board.isFieldTakenByEnemy(i,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,n));break}if(!this.board.isFieldEmpty(i,n))break}for(i=t-1,n=o+1;i>=0&&n<8;--i,++n){if(this.board.isFieldTakenByEnemy(i,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,n));break}if(!this.board.isFieldEmpty(i,n))break}for(i=t+1,n=o-1;i<8&&n>=0;++i,--n){if(this.board.isFieldTakenByEnemy(i,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,n));break}if(!this.board.isFieldEmpty(i,n))break}for(i=t+1,n=o+1;i<8&&n<8;++i,++n){if(this.board.isFieldTakenByEnemy(i,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,n));break}if(!this.board.isFieldEmpty(i,n))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,n=o-1;i>=0&&n>=0;--i,--n){if(!this.board.isFieldEmpty(i,n)){this.board.getPieceByField(i,n)instanceof g||e.push(new f(i,n));break}e.push(new f(i,n))}for(i=t-1,n=o+1;i>=0&&n<8;--i,++n){if(!this.board.isFieldEmpty(i,n)){this.board.getPieceByField(i,n)instanceof g||e.push(new f(i,n));break}e.push(new f(i,n))}for(i=t+1,n=o-1;i<8&&n>=0;++i,--n){if(!this.board.isFieldEmpty(i,n)){this.board.getPieceByField(i,n)instanceof g||e.push(new f(i,n));break}e.push(new f(i,n))}for(i=t+1,n=o+1;i<8&&n<8;++i,++n){if(!this.board.isFieldEmpty(i,n)){this.board.getPieceByField(i,n)instanceof g||e.push(new f(i,n));break}e.push(new f(i,n))}return e},t}(u),v=function(e){function t(t,o,i,n){var r=e.call(this,t,o,i,3,n)||this;return r.isMovedAlready=!1,r}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldEmpty(t-2,o-1)&&e.push(new f(t-2,o-1)),this.board.isFieldEmpty(t-2,o+1)&&e.push(new f(t-2,o+1)),this.board.isFieldEmpty(t-1,o-2)&&e.push(new f(t-1,o-2)),this.board.isFieldEmpty(t-1,o+2)&&e.push(new f(t-1,o+2)),this.board.isFieldEmpty(t+1,o-2)&&e.push(new f(t+1,o-2)),this.board.isFieldEmpty(t+1,o+2)&&e.push(new f(t+1,o+2)),this.board.isFieldEmpty(t+2,o-1)&&e.push(new f(t+2,o-1)),this.board.isFieldEmpty(t+2,o+1)&&e.push(new f(t+2,o+1)),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldTakenByEnemy(t-2,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-2,o-1)),this.board.isFieldTakenByEnemy(t-2,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-2,o+1)),this.board.isFieldTakenByEnemy(t-1,o-2,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o-2)),this.board.isFieldTakenByEnemy(t-1,o+2,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o+2)),this.board.isFieldTakenByEnemy(t+1,o-2,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o-2)),this.board.isFieldTakenByEnemy(t+1,o+2,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o+2)),this.board.isFieldTakenByEnemy(t+2,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+2,o-1)),this.board.isFieldTakenByEnemy(t+2,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+2,o+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return e.push(new f(t-2,o-1)),e.push(new f(t-2,o+1)),e.push(new f(t-1,o-2)),e.push(new f(t-1,o+2)),e.push(new f(t+1,o-2)),e.push(new f(t+1,o+2)),e.push(new f(t+2,o-1)),e.push(new f(t+2,o+1)),e},t}(u),w=function(e){function t(t,o,i,n){var r=e.call(this,t,o,i,1,n)||this;return r.isMovedAlready=!1,r}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===h.WHITE||this.board.reverted&&this.color===h.BLACK?this.board.isFieldEmpty(t-1,o)&&(e.push(new f(t-1,o)),!this.isMovedAlready&&this.board.isFieldEmpty(t-2,o)&&e.push(new f(t-2,o))):
/*!board.isFieldTakenByEnemy(row + 1, col, Color.WHITE) &&*/this.board.isFieldEmpty(t+1,o)&&(e.push(new f(t+1,o)),!this.isMovedAlready&&this.board.isFieldEmpty(t+2,o)&&e.push(new f(t+2,o))),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===h.WHITE||this.board.reverted&&this.color===h.BLACK?(this.board.isFieldTakenByEnemy(t-1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o-1)),this.board.isFieldTakenByEnemy(t-1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t-1,o+1))):(this.board.isFieldTakenByEnemy(t+1,o-1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o-1)),this.board.isFieldTakenByEnemy(t+1,o+1,this.color===h.WHITE?h.BLACK:h.WHITE)&&e.push(new f(t+1,o+1))),this.board.enPassantPoint&&this.board.enPassantPiece.color===(this.color===h.WHITE?h.BLACK:h.WHITE)&&t===this.board.enPassantPiece.point.row&&1===Math.abs(this.board.enPassantPiece.point.col-o)&&e.push(this.board.enPassantPoint),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===h.WHITE||this.board.reverted&&this.color===h.BLACK?(e.push(new f(t-1,o-1)),e.push(new f(t-1,o+1))):(e.push(new f(t+1,o-1)),e.push(new f(t+1,o+1))),e},t}(u),P=function(e){function t(t,o,i,n){return e.call(this,t,o,i,9,n)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,n=o-1;i>=0&&n>=0&&this.board.isFieldEmpty(i,n);--i,--n)e.push(new f(i,n));for(i=t-1,n=o+1;i>=0&&n<8&&this.board.isFieldEmpty(i,n);--i,++n)e.push(new f(i,n));for(i=t+1,n=o-1;i<8&&n>=0&&this.board.isFieldEmpty(i,n);++i,--n)e.push(new f(i,n));for(i=t+1,n=o+1;i<8&&n<8&&this.board.isFieldEmpty(i,n);++i,++n)e.push(new f(i,n));for(i=t+1;i<8&&this.board.isFieldEmpty(i,o);++i)e.push(new f(i,o));for(i=t-1;i>=0&&this.board.isFieldEmpty(i,o);--i)e.push(new f(i,o));for(n=o-1;n>=0&&this.board.isFieldEmpty(t,n);--n)e.push(new f(t,n));for(n=o+1;n<8&&this.board.isFieldEmpty(t,n);++n)e.push(new f(t,n));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,n=o-1;i>=0&&n>=0;--i,--n){if(this.board.isFieldTakenByEnemy(i,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,n));break}if(!this.board.isFieldEmpty(i,n))break}for(i=t-1,n=o+1;i>=0&&n<8;--i,++n){if(this.board.isFieldTakenByEnemy(i,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,n));break}if(!this.board.isFieldEmpty(i,n))break}for(i=t+1,n=o-1;i<8&&n>=0;++i,--n){if(this.board.isFieldTakenByEnemy(i,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,n));break}if(!this.board.isFieldEmpty(i,n))break}for(i=t+1,n=o+1;i<8&&n<8;++i,++n){if(this.board.isFieldTakenByEnemy(i,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,n));break}if(!this.board.isFieldEmpty(i,n))break}for(i=t+1;i<8;++i){if(this.board.isFieldTakenByEnemy(i,o,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(i=t-1;i>=0;--i){if(this.board.isFieldTakenByEnemy(i,o,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(n=o-1;n>=0;--n){if(this.board.isFieldTakenByEnemy(t,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(t,n));break}if(!this.board.isFieldEmpty(t,n))break}for(n=o+1;n<8;++n){if(this.board.isFieldTakenByEnemy(t,n,this.color===h.WHITE?h.BLACK:h.WHITE)){e.push(new f(t,n));break}if(!this.board.isFieldEmpty(t,n))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i){if(!this.board.isFieldEmpty(i,o)){this.board.getPieceByField(i,o)instanceof g||e.push(new f(i,o));break}e.push(new f(i,o))}for(i=t-1;i>=0;--i){if(!this.board.isFieldEmpty(i,o)){this.board.getPieceByField(i,o)instanceof g||e.push(new f(i,o));break}e.push(new f(i,o))}for(var n=o-1;n>=0;--n){if(!this.board.isFieldEmpty(t,n)){this.board.getPieceByField(t,n)instanceof g||e.push(new f(t,n));break}e.push(new f(t,n))}for(n=o+1;n<8;++n){if(!this.board.isFieldEmpty(t,n)){this.board.getPieceByField(t,n)instanceof g||e.push(new f(t,n));break}e.push(new f(t,n))}for(i=t-1,n=o-1;i>=0&&n>=0;--i,--n){if(!this.board.isFieldEmpty(i,n)){this.board.getPieceByField(i,n)instanceof g||e.push(new f(i,n));break}e.push(new f(i,n))}for(i=t-1,n=o+1;i>=0&&n<8;--i,++n){if(!this.board.isFieldEmpty(i,n)){this.board.getPieceByField(i,n)instanceof g||e.push(new f(i,n));break}e.push(new f(i,n))}for(i=t+1,n=o-1;i<8&&n>=0;++i,--n){if(!this.board.isFieldEmpty(i,n)){this.board.getPieceByField(i,n)instanceof g||e.push(new f(i,n));break}e.push(new f(i,n))}for(i=t+1,n=o+1;i<8&&n<8;++i,++n){if(!this.board.isFieldEmpty(i,n)){this.board.getPieceByField(i,n)instanceof g||e.push(new f(i,n));break}e.push(new f(i,n))}return e},t}(u),C={WHITE_KING:{name:"King",icon:"&#x2654;"},WHITE_QUEEN:{name:"Queen",icon:"&#x2655;"},WHITE_KNIGHT:{name:"Knight",icon:"&#x2658"},WHITE_ROOK:{name:"Rook",icon:"&#x2656"},WHITE_PAWN:{name:"Pawn",icon:"&#x2659"},WHITE_BISHOP:{name:"Bishop",icon:"&#x2657"},BLACK_KING:{name:"King",icon:"&#x265A"},BLACK_QUEEN:{name:"Queen",icon:"&#x265B"},BLACK_KNIGHT:{name:"Knight",icon:"&#x265E"},BLACK_ROOK:{name:"Rook",icon:"&#x265C"},BLACK_PAWN:{name:"Pawn",icon:"&#x265F"},BLACK_BISHOP:{name:"Bishop",icon:"&#x265D"}},E=function(){function e(){}return e.prototype.process=function(e,t){var o=e;if(!e)throw Error("Incorrect FEN provided");t.board.reverted=!1,t.board.pieces=[];for(var i=o.split("/"),n=0;n<8;++n)for(var r=0,s=0;s<8;++s){var a=i[n].charAt(s);if(a.match(/[0-9]/))r+=Number(a);else{switch(a){case"r":t.board.pieces.push(new b(new f(n,r),h.BLACK,C.BLACK_ROOK,t.board));break;case"n":t.board.pieces.push(new v(new f(n,r),h.BLACK,C.BLACK_KNIGHT,t.board));break;case"b":t.board.pieces.push(new y(new f(n,r),h.BLACK,C.BLACK_BISHOP,t.board));break;case"q":t.board.pieces.push(new P(new f(n,r),h.BLACK,C.BLACK_QUEEN,t.board));break;case"k":t.board.pieces.push(new g(new f(n,r),h.BLACK,C.BLACK_KING,t.board));break;case"p":((c=new w(new f(n,r),h.BLACK,C.BLACK_PAWN,t.board)).color===h.BLACK&&1!==c.point.row||c.color===h.WHITE&&6!==c.point.row)&&(c.isMovedAlready=!0),t.board.pieces.push(c);break;case"R":t.board.pieces.push(new b(new f(n,r),h.WHITE,C.WHITE_ROOK,t.board));break;case"N":t.board.pieces.push(new v(new f(n,r),h.WHITE,C.WHITE_KNIGHT,t.board));break;case"B":t.board.pieces.push(new y(new f(n,r),h.WHITE,C.WHITE_BISHOP,t.board));break;case"Q":t.board.pieces.push(new P(new f(n,r),h.WHITE,C.WHITE_QUEEN,t.board));break;case"K":t.board.pieces.push(new g(new f(n,r),h.WHITE,C.WHITE_KING,t.board));break;case"P":var c;((c=new w(new f(n,r),h.WHITE,C.WHITE_PAWN,t.board)).color===h.BLACK&&1!==c.point.row||c.color===h.WHITE&&6!==c.point.row)&&(c.isMovedAlready=!0),t.board.pieces.push(c)}++r}}this.setCurrentPlayer(t.board,o),this.setCastles(t.board,o),this.setEnPassant(o),this.setFullMoveCount(o),t.board.fen=o},e.prototype.setCurrentPlayer=function(e,t){if(t){var o=t.split(" ");e.currentWhitePlayer="w"===o[1]}},e.prototype.setCastles=function(e,t){if(t){var o=t.split(" ")[2];o.includes("K")||this.setRookAlreadyMoved(e,h.WHITE,7),o.includes("Q")||this.setRookAlreadyMoved(e,h.WHITE,0),o.includes("k")||this.setRookAlreadyMoved(e,h.BLACK,7),o.includes("q")||this.setRookAlreadyMoved(e,h.BLACK,0)}},e.prototype.setFullMoveCount=function(e){},e.prototype.setEnPassant=function(e){if(e&&"-"===e.split(" ")[3])return},e.prototype.setRookAlreadyMoved=function(e,t,o){var i=e.pieces.find((function(e){return e.color===t&&e instanceof b&&e.point.col===o}));i&&(i.isMovedAlready=!0)},e}(),m=function(){function e(e,t,o){this._xAxis=e,this._yAxis=t,this._reverted=o}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},set:function(e){this._xAxis=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},set:function(e){this._yAxis=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reverted",{get:function(){return this._reverted},set:function(e){this._reverted=e},enumerable:!1,configurable:!0}),e}(),I=function(){function e(){}return e.willMoveCauseCheck=function(e,t,o,i,n,r){var s=r.getPieceByField(t,o),a=r.getPieceByField(i,n);s&&(s.point.row=i,s.point.col=n),a&&(r.pieces=r.pieces.filter((function(e){return e!==a})));var c=r.isKingInCheck(e,r.pieces);return s&&(s.point.col=o,s.point.row=t),a&&r.pieces.push(a),c},e.format=function(e,t,o){if(o){var i=104-e.col,n=104-t.col;return String.fromCharCode(i)+(e.row+1)+String.fromCharCode(n)+(t.row+1)}return String.fromCharCode(e.col+97)+(Math.abs(e.row-7)+1)+String.fromCharCode(t.col+97)+(Math.abs(t.row-7)+1)},e.translateCoordsToIndex=function(e,t){var o,i;return t?(o=104-e.charCodeAt(0),i=+e.charAt(1)-1):(o=e.charCodeAt(0)-97,i=Math.abs(+e.charAt(1)-8)),new m(o,i,t)},e.findPieceByPossibleMovesContaining=function(t,o,i){var n,r,s,a,d=this.translateCoordsToIndex(t,o.reverted),l=new f(d.yAxis,d.xAxis),h=[];try{for(var p=c(o.pieces.filter((function(e){return e.color===i}))),u=p.next();!u.done;u=p.next()){var b=u.value;try{for(var g=(s=void 0,c(b.getPossibleMoves())),y=g.next();!y.done;y=g.next()){var v=y.value;!e.willMoveCauseCheck(b.color,b.point.row,b.point.col,d.yAxis,d.xAxis,o)&&v.isEqual(l)&&h.push(b)}}catch(e){s={error:e}}finally{try{y&&!y.done&&(a=g.return)&&a.call(g)}finally{if(s)throw s.error}}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}return 0===h.length&&console.log(t+" debug"),h},e.findPieceByPossibleCapturesContaining=function(t,o,i){var n,r,s,a,d=this.translateCoordsToIndex(t,o.reverted),l=new f(d.yAxis,d.xAxis),h=[];try{for(var p=c(o.pieces.filter((function(e){return e.color===i}))),u=p.next();!u.done;u=p.next()){var b=u.value;try{for(var g=(s=void 0,c(b.getPossibleCaptures())),y=g.next();!y.done;y=g.next()){var v=y.value;!e.willMoveCauseCheck(b.color,b.point.row,b.point.col,d.yAxis,d.xAxis,o)&&v.isEqual(l)&&h.push(b)}}catch(e){s={error:e}}finally{try{y&&!y.done&&(a=g.return)&&a.call(g)}finally{if(s)throw s.error}}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}return 0===h.length&&console.log(t+" debug"),h},e.formatSingle=function(e,t){if(t){var o=104-e.col;return String.fromCharCode(o)+(e.row+1)}return String.fromCharCode(e.col+97)+(Math.abs(e.row-7)+1)},e.getFirstLetterPiece=function(e){return e instanceof w?"P":e instanceof v?"N":e instanceof y?"B":e instanceof b?"R":e instanceof g?"K":e instanceof P?"Q":""},e}(),F=function(){function e(){}return e.loadDefaultPieces=function(e){e.pieces=[];for(var t=0;t<8;++t)e.pieces.push(new w(new f(1,t),h.BLACK,C.BLACK_PAWN,e));e.pieces.push(new b(new f(0,0),h.BLACK,C.BLACK_ROOK,e)),e.pieces.push(new v(new f(0,1),h.BLACK,C.BLACK_KNIGHT,e)),e.pieces.push(new y(new f(0,2),h.BLACK,C.BLACK_BISHOP,e)),e.pieces.push(new P(new f(0,3),h.BLACK,C.BLACK_QUEEN,e)),e.pieces.push(new g(new f(0,4),h.BLACK,C.BLACK_KING,e)),e.pieces.push(new y(new f(0,5),h.BLACK,C.BLACK_BISHOP,e)),e.pieces.push(new v(new f(0,6),h.BLACK,C.BLACK_KNIGHT,e)),e.pieces.push(new b(new f(0,7),h.BLACK,C.BLACK_ROOK,e));for(t=0;t<8;++t)e.pieces.push(new w(new f(6,t),h.WHITE,C.WHITE_PAWN,e));e.pieces.push(new b(new f(7,0),h.WHITE,C.WHITE_ROOK,e)),e.pieces.push(new v(new f(7,1),h.WHITE,C.WHITE_KNIGHT,e)),e.pieces.push(new y(new f(7,2),h.WHITE,C.WHITE_BISHOP,e)),e.pieces.push(new P(new f(7,3),h.WHITE,C.WHITE_QUEEN,e)),e.pieces.push(new g(new f(7,4),h.WHITE,C.WHITE_KING,e)),e.pieces.push(new y(new f(7,5),h.WHITE,C.WHITE_BISHOP,e)),e.pieces.push(new v(new f(7,6),h.WHITE,C.WHITE_KNIGHT,e)),e.pieces.push(new b(new f(7,7),h.WHITE,C.WHITE_ROOK,e)),e.calculateFEN()},e}(),k=function(){function e(){}return e.prototype.process=function(e,t){var o,i,n=this;if(e){t.board.reverted=!1,t.board.pieces=[],t.reset(),F.loadDefaultPieces(t.board);var r=this.extractMoves(e),s=-1,a=function(e){++s;var o="";(e=e.replace(/[+#]/g,"")).includes("=")&&(o=d.resolvePromotion(e.substring(e.length-1)),e=e.substring(0,e.length-2));var i=0===s||s%2==0?h.WHITE:h.BLACK;if(/^[a-z]\d$/g.test(e))(a=I.findPieceByPossibleMovesContaining(e,t.board,i).find((function(e){return e instanceof w})))&&t.move(I.formatSingle(a.point,!1)+e+o);else if(/^[A-Z][a-h]\d$/g.test(e))(a=(r=I.findPieceByPossibleMovesContaining(e.substring(1),t.board,i)).find((function(t){return n.resolvePieceByFirstChar(e.charAt(0),t)})))&&t.move(I.formatSingle(a.point,!1)+e.substring(1)+o);else if("O-O"===e)t.move(i===h.WHITE?"e1g1":"e8g8");else if(/^[a-z]x[a-z]\d$/g.test(e)){var r=I.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,i).filter((function(e){return e instanceof w})),a=void 0;(a=r.length>1?d.resolveByCol(r,e.substring(0,1)):r[0])&&t.move(I.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+o)}else{if(/^[A-Z]x[a-z]\d$/g.test(e))(a=I.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,i).find((function(t){return n.resolvePieceByFirstChar(e.substring(0,1),t)})))&&t.move(I.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+o);else if("O-O-O"===e)t.move(i===h.WHITE?"e1c1":"e8c8");else if(/^[A-Z]\dx[a-z]\d$/g.test(e)){r=I.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,i).filter((function(t){return n.resolvePieceByFirstChar(e.charAt(0),t)}));(a=d.resolveByRow(r,e.substring(1,2)))&&t.move(I.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+o)}else if(/^[A-Z][a-z][a-z]\d$/g.test(e)){r=I.findPieceByPossibleMovesContaining(e.substring(2,4),t.board,i).filter((function(t){return n.resolvePieceByFirstChar(e.charAt(0),t)}));(a=d.resolveByCol(r,e.substring(1,2)))&&t.move(I.formatSingle(a.point,!1)+e.substring(2,4)+o)}else if(/^[A-Z][a-z]x[a-z]\d$/g.test(e)){r=I.findPieceByPossibleCapturesContaining(e.substring(e.indexOf("x")+1),t.board,i).filter((function(t){return n.resolvePieceByFirstChar(e.charAt(0),t)}));(a=d.resolveByCol(r,e.substring(1,2)))&&t.move(I.formatSingle(a.point,!1)+e.substring(e.indexOf("x")+1)+o)}}},d=this;try{for(var l=c(r),p=l.next();!p.done;p=l.next()){a(p.value)}}catch(e){o={error:e}}finally{try{p&&!p.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}}},e.prototype.extractMoves=function(e){return e.substring(e.lastIndexOf("]")+1).replace(/[0-9]+\./g,"").replace(/\s+/g," ").replace(/{[^}]*}/g,"").trim().split(" ").filter((function(e){return e}))},e.prototype.movePiece=function(e,t,o){var i=I.translateCoordsToIndex(o,t.reverted);e.point.col=i.xAxis,e.point.row=i.yAxis},e.prototype.hasUpperCase=function(e){return/[A-Z]/.test(e)},e.prototype.resolvePieceByFirstChar=function(e,t){var o="";return t instanceof g?o="K":t instanceof P?o="Q":t instanceof b?o="R":t instanceof y?o="B":t instanceof v?o="N":t instanceof w&&(o="P"),e===o},e.prototype.isShortCastle=function(e){return"O-O"===e},e.prototype.removePiece=function(e,t){var o=I.translateCoordsToIndex(e,t.reverted);t.pieces=t.pieces.filter((function(e){return!e.point.isEqual(new f(o.yAxis,o.xAxis))}))},e.prototype.isLongCastle=function(e){return"O-O-O"===e},e.prototype.resolveByCol=function(e,t){var o=I.formatSingle(e[0].point,!1);I.formatSingle(e[1].point,!1);return o.substring(0,1)===t?e[0]:e[1]},e.prototype.resolveByRow=function(e,t){var o=I.formatSingle(e[0].point,!1);I.formatSingle(e[1].point,!1);return o.substring(1,2)===t?e[0]:e[1]},e.prototype.replacePromotion=function(e){return e.replace("=Q","1").replace("=R","2").replace("=B","3").replace("=K","4")},e.prototype.resolvePromotion=function(e){switch(e){case"Q":return"1";case"R":return"2";case"B":return"3";case"N":return"4"}return""},e}(),A=function(){function e(){}return e.getProcessor=function(e){switch(e){case p.FEN:return new E;case p.PGN:return new k}},e.getDefaultProcessor=function(){return new E},e}();!function(e){e[e.FEN=1]="FEN",e[e.PGN=2]="PGN"}(p||(p={}));var T=function(){function e(e,t,o){this.x=e+.5,this.y=t+.5,this.color=o}return e.prototype.isEqual=function(e){return e&&e.x===this.x&&this.y===e.y},e}(),B=function(){function e(){}return e.getClickPoint=function(e,t,o,i,n){return new f(Math.floor((e.y-t)/(o/8)),Math.floor((e.x-i)/(n/8)))},e.getDrawingPoint=function(e,t,o,i,n,r,s,a,c){var d=e/8,l=Math.floor((o-a)/d),h=Math.floor((i-c)/d),p=t.resolve(n,s,r);return new T(Math.floor(l*d+d/2),Math.floor(h*d+d/2),p)},e}(),x=function(e,t,o,i){this.move=e,this.piece=t,this.color=o,this.x=i},M=function(){function e(){this.historyMovesSubject$=new n.BehaviorSubject([])}return Object.defineProperty(e.prototype,"historyMoves",{get:function(){return this.historyMovesSubject$.value},set:function(e){this.historyMovesSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addMove=function(e){this.historyMoves=l(this.historyMoves,[e])},e.prototype.pop=function(){var e=this.getLastMove();return this.historyMoves=this.historyMoves.filter((function(t){return t!==e})),e},e.prototype.getAll=function(){return this.historyMoves},e.prototype.clear=function(){this.historyMoves=[]},e.prototype.getLastMove=function(){return this.historyMoves[this.getLastMoveIndex()]},e.prototype.getLastMoveIndex=function(){return this.historyMoves.length-1},e}(),H=function(){};H.DEFAULT_DARK_TILE_COLOR="rgb(97, 84, 61)",H.DEFAULT_LIGHT_TILE_COLOR="#BAA378",H.DEFAULT_SIZE=500,H.MIN_BOARD_SIZE=100,H.MAX_BOARD_SIZE=4e3;var W,K,L=function(){function e(){this._defaultIcons=!1}return Object.defineProperty(e.prototype,"pieceIconInput",{get:function(){return this._pieceIconInput},set:function(e){this._pieceIconInput=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultIcons",{get:function(){return this._defaultIcons},set:function(e){this._defaultIcons=e},enumerable:!1,configurable:!0}),e.prototype.isDefaultIcons=function(){return void 0===this.pieceIconInput||null===this.pieceIconInput},e.prototype.getPieceIcon=function(e){var t=e.color===h.WHITE;switch(e.constructor){case g:return t?this.pieceIconInput.whiteKingUrl:this.pieceIconInput.blackKingUrl;case P:return t?this.pieceIconInput.whiteQueenUrl:this.pieceIconInput.blackQueenUrl;case b:return t?this.pieceIconInput.whiteRookUrl:this.pieceIconInput.blackRookUrl;case y:return t?this.pieceIconInput.whiteBishopUrl:this.pieceIconInput.blackBishopUrl;case v:return t?this.pieceIconInput.whiteKnightUrl:this.pieceIconInput.blackKnightUrl;case w:return t?this.pieceIconInput.whitePawnUrl:this.pieceIconInput.blackPawnUrl}},e.prototype.loadDefaultData=function(){this.pieceIconInput={blackBishopUrl:"",blackKingUrl:"",blackKnightUrl:"",blackQueenUrl:"",blackRookUrl:"",whiteBishopUrl:"",whiteKingUrl:"",whiteKnightUrl:"",whitePawnUrl:"",whiteQueenUrl:"",whiteRookUrl:"",blackPawnUrl:"a"}},e}(),S=function(){function e(){this.defaultXCoords=["a","b","c","d","e","f","g","h"],this.defaultYCoords=[8,7,6,5,4,3,2,1],this.currentXCoords=l(this.defaultXCoords),this.currentYCoords=l(this.defaultYCoords)}return Object.defineProperty(e.prototype,"xCoords",{get:function(){return this.currentXCoords},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yCoords",{get:function(){return this.currentYCoords},enumerable:!1,configurable:!0}),e.prototype.reverse=function(){this.currentXCoords=this.currentXCoords.reverse(),this.currentYCoords=this.currentYCoords.reverse()},e.prototype.reset=function(){this.init()},e.prototype.init=function(){this.currentXCoords=l(this.defaultXCoords),this.currentYCoords=l(this.defaultYCoords)},e}(),O=function(){function e(){}return e.prototype.dragEnded=function(e){e.source.reset(),e.source.element.nativeElement.style.zIndex="0",e.source.element.nativeElement.style.pointerEvents="auto",e.source.element.nativeElement.style.touchAction="auto"},e}(),_=function(){function e(){this.dragEndProcessor=new O}return e.prototype.process=function(e){this.dragEndProcessor.dragEnded(e)},e.prototype.setDragEndProcessor=function(e){this.dragEndProcessor=e},e}(),N=function(){function e(){}return e.prototype.dragStarted=function(e){var t=e.source.element.nativeElement.style;t.position="relative",t.zIndex="1000",t.touchAction="none",t.pointerEvents="none"},e}(),D=function(){function e(){this.dragStartProcessor=new N}return e.prototype.process=function(e){this.dragStartProcessor.dragStarted(e)},e.prototype.setDragStartProcessor=function(e){this.dragStartProcessor=e},e}(),R=function(){function e(){}return e.prototype.resolve=function(e,t,o){var i="green";return(e||t)&&(i="red"),o&&(i="blue"),(t||e)&&o&&(i="orange"),i},e}(),U=function(){function e(){this.colorProcessor=new R}return e.prototype.resolve=function(e,t,o){return this.colorProcessor.resolve(e,t,o)},e.prototype.setColorProcessor=function(e){this.colorProcessor=e},e}(),j=function(){function e(){this.arrowsSubject$=new n.BehaviorSubject([]),this.circlesSubject$=new n.BehaviorSubject([]),this.arrows$=this.arrowsSubject$.asObservable(),this.circles$=this.circlesSubject$.asObservable()}return Object.defineProperty(e.prototype,"circles",{get:function(){return this.circlesSubject$.value},set:function(e){this.circlesSubject$.next(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"arrows",{get:function(){return this.arrowsSubject$.value},set:function(e){this.arrowsSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addCircle=function(e){this.circles=l(this.circles,[e])},e.prototype.reomveCircle=function(e){this.circles=this.circles.filter((function(t){return!t.isEqual(e)}))},e.prototype.addArrow=function(e){this.arrows=l(this.arrows,[e])},e.prototype.removeArrow=function(e){this.arrows=this.arrows.filter((function(t){return!t.isEqual(e)}))},e.prototype.containsCircle=function(e){return this.circles.some((function(t){return t.isEqual(e)}))},e.prototype.containsArrow=function(e){return this.arrows.some((function(t){return t.isEqual(e)}))},e.prototype.clear=function(){this.arrows=[],this.circles=[]},e}(),G=function(){function e(e){this.dragStartStrategy=new D,this.dragEndStrategy=new _,this.colorStrategy=new U,this.coords=new S,this.heightAndWidth=H.DEFAULT_SIZE,this.freeMode=!1,this.drawProvider=new j,this.pieceIconManager=new L,this.moveHistoryProvider=new M,this.board=e}return e.prototype.checkIfPawnFirstMove=function(e){e instanceof w&&(e.isMovedAlready=!0)},e.prototype.checkIfRookMoved=function(e){e instanceof b&&(e.isMovedAlready=!0)},e.prototype.checkIfKingMoved=function(e){e instanceof g&&(e.isMovedAlready=!0)},e.prototype.getMoveHistory=function(){return this.moveHistoryProvider.getAll()},e}(),z=function(){function e(e,t){this.engineFacade=e,this.notationProcessor=t||A.getDefaultProcessor()}return e.prototype.addPieces=function(){F.loadDefaultPieces(this.engineFacade.board)},e.prototype.loadFEN=function(e){this.notationProcessor.process(e,this.engineFacade)},e.prototype.loadPGN=function(e){this.notationProcessor.process(e,this.engineFacade)},e.prototype.setEngineFacade=function(e){this.engineFacade=e},e.prototype.setNotationProcessor=function(e){this.notationProcessor=e},e}(),q=function(e){this.board=e},Q=function(){function e(){this.statesSubject$=new n.BehaviorSubject([])}return Object.defineProperty(e.prototype,"states",{get:function(){return this.statesSubject$.value},set:function(e){this.statesSubject$.next(e)},enumerable:!1,configurable:!0}),e.prototype.addMove=function(e){this.states=l(this.states,[e])},e.prototype.getStates=function(){return this.states},e.prototype.pop=function(){var e=this.getLastState();return this.states=this.states.filter((function(t){return t!==e})),e},e.prototype.isEmpty=function(){return 0===this.states.length},e.prototype.clear=function(){this.states=[]},e.prototype.getLastState=function(){return this.states[this.getLastStateIndex()]},e.prototype.getLastStateIndex=function(){return this.states.length-1},e}(),$=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.start.isEqual(e.start)&&this.end.isEqual(e.end)},e}(),X=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.drawPoint.isEqual(e.drawPoint)},e}(),Y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.process=function(e,t,o,i){this.currentIndex+=.5,this.pgn+=this.currentIndex%Math.floor(this.currentIndex)==0?" "+this.currentIndex+". ":" ";var n,r=[];i&&(console.log("dest"),r=I.findPieceByPossibleCapturesContaining(I.formatSingle(o,e.reverted),e,t.color).filter((function(e){return e.constructor.name===t.constructor.name}))),n=I.findPieceByPossibleMovesContaining(I.formatSingle(o,e.reverted),e,t.color).filter((function(e){return e.constructor.name===t.constructor.name})),t instanceof w&&!i&&0===r.length?this.pgn+=I.formatSingle(o,e.reverted):t instanceof w&&i?this.pgn+=I.formatSingle(t.point,e.reverted).substring(0,1)+"x"+I.formatSingle(o,e.reverted):t instanceof g&&2===Math.abs(t.point.col-o.col)?e.reverted?this.pgn+=o.col<2?"O-O":"O-O-O":this.pgn+=o.col<3?"O-O-O":"O-O":!(t instanceof w)&&0===r.length&&n.length<2?this.pgn+=I.getFirstLetterPiece(t)+I.formatSingle(o,e.reverted):n&&2===n.length&&0===r.length?this.isEqualByCol(n[0],n[1])?this.pgn+=I.getFirstLetterPiece(t)+t.point.row+I.formatSingle(o,e.reverted):this.pgn+=I.getFirstLetterPiece(t)+t.point.col+I.formatSingle(o,e.reverted):r.length>1?this.isEqualByCol(r[0],r[1])?this.pgn+=I.getFirstLetterPiece(t)+t.point.row+"x"+I.formatSingle(o,e.reverted):this.pgn+=I.getFirstLetterPiece(t)+t.point.col+"x"+I.formatSingle(o,e.reverted):this.pgn+=I.getFirstLetterPiece(t)+"x"+I.formatSingle(o,e.reverted),this.pgn=this.pgn.trim(),console.log(this.pgn)},t.prototype.resolvePieceByFirstChar=function(e,t){return I.getFirstLetterPiece(t)===e},t.prototype.isEqualByCol=function(e,t){return e.point.col===t.point.col},t}(function(){function e(){this.pgn="",this.currentIndex=.5}return e.prototype.getPGN=function(){return this.pgn},e}()),Z=function(e){function t(t,o,i,n){var r=e.call(this,t)||this;return r.pointClicked=o,r.color=i,r.board=n,r}return a(t,e),t.prototype.getPossibleCaptures=function(){var e=this;return this.piece.getPossibleCaptures().filter((function(t){return!I.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t.prototype.getPossibleMoves=function(){var e=this;return this.piece.getPossibleMoves().filter((function(t){return!I.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t}((function(e){this.piece=e})),V=function(){function e(){}return e.resolvePromotionChoice=function(e,t,o){var i=t.color===h.WHITE;switch(o){case 1:e.pieces.push(new P(t.point,t.color,i?C.WHITE_QUEEN:C.BLACK_QUEEN,e));break;case 2:e.pieces.push(new b(t.point,t.color,i?C.WHITE_ROOK:C.BLACK_ROOK,e));break;case 3:e.pieces.push(new y(t.point,t.color,i?C.WHITE_BISHOP:C.BLACK_BISHOP,e));break;case 4:e.pieces.push(new v(t.point,t.color,i?C.WHITE_KNIGHT:C.BLACK_KNIGHT,e))}},e}();!function(e){e[e.KING=1]="KING",e[e.QUEEN=2]="QUEEN",e[e.BISHOP=3]="BISHOP",e[e.KNIGHT=4]="KNIGHT",e[e.ROOK=5]="ROOK",e[e.PAWN=6]="PAWN"}(W||(W={})),function(e){e[e.LIGHT=1]="LIGHT",e[e.DARK=2]="DARK"}(K||(K={}));var J=function(){function e(){}return e.create=function(e,t,o,i){var n,r=o===K.LIGHT?h.WHITE:h.BLACK;switch(t){case W.QUEEN:n=new P(new f(e.yAxis,e.xAxis),r,r===h.WHITE?C.WHITE_QUEEN:C.BLACK_QUEEN,i);break;case W.KING:n=new g(new f(e.yAxis,e.xAxis),r,r===h.WHITE?C.WHITE_KING:C.BLACK_KING,i);break;case W.KNIGHT:n=new v(new f(e.yAxis,e.xAxis),r,r===h.WHITE?C.WHITE_KNIGHT:C.BLACK_KNIGHT,i);break;case W.BISHOP:n=new y(new f(e.yAxis,e.xAxis),r,r===h.WHITE?C.WHITE_BISHOP:C.BLACK_BISHOP,i);break;case W.ROOK:n=new b(new f(e.yAxis,e.xAxis),r,r===h.WHITE?C.WHITE_ROOK:C.BLACK_ROOK,i);break;case W.PAWN:n=new w(new f(e.yAxis,e.xAxis),r,r===h.WHITE?C.WHITE_PAWN:C.BLACK_PAWN,i)}return n},e}(),ee=function(e){function t(t,o){var i=e.call(this,t)||this;return i._selected=!1,i.disabling=!1,i.pgnProcessor=new Y,i.moveChange=o,i.boardLoader=new z(i),i.boardLoader.addPieces(),i.boardStateProvider=new Q,i}return a(t,e),t.prototype.reset=function(){this.boardStateProvider.clear(),this.moveHistoryProvider.clear(),this.boardLoader.addPieces(),this.board.reset(),this.coords.reset(),this.drawProvider.clear(),this.freeMode=!1},t.prototype.undo=function(){if(!this.boardStateProvider.isEmpty()){var e=this.boardStateProvider.pop().board;this.board.reverted&&e.reverse(),this.board=e,this.board.possibleCaptures=[],this.board.possibleMoves=[],this.moveHistoryProvider.pop()}},t.prototype.saveMoveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.moveStateProvider.addMove(new q(e))},t.prototype.move=function(e){if(e){var t=I.translateCoordsToIndex(e.substring(0,2),this.board.reverted),o=I.translateCoordsToIndex(e.substring(2,4),this.board.reverted),i=this.board.getPieceByPoint(t.yAxis,t.xAxis);if(i){if(this.board.currentWhitePlayer&&i.color===h.BLACK||!this.board.currentWhitePlayer&&i.color===h.WHITE)return;this.prepareActivePiece(i,i.point),this.board.isPointInPossibleMoves(new f(o.yAxis,o.xAxis))||this.board.isPointInPossibleCaptures(new f(o.yAxis,o.xAxis))?(this.saveClone(),this.movePiece(i,new f(o.yAxis,o.xAxis),5===e.length?+e.substring(4,5):0),this.board.lastMoveSrc=new f(t.yAxis,t.xAxis),this.board.lastMoveDest=new f(o.yAxis,o.xAxis),this.disableSelection()):this.disableSelection()}}},t.prototype.prepareActivePiece=function(e,t){this.board.activePiece=e,this._selected=!0,this.board.possibleCaptures=new Z(e,t,this.board.currentWhitePlayer?h.WHITE:h.BLACK,this.board).getPossibleCaptures(),this.board.possibleMoves=new Z(e,t,this.board.currentWhitePlayer?h.WHITE:h.BLACK,this.board).getPossibleMoves()},t.prototype.onPieceClicked=function(e,t){this.board.currentWhitePlayer&&e.color===h.BLACK||!this.board.currentWhitePlayer&&e.color===h.WHITE||this.prepareActivePiece(e,t)},t.prototype.handleClickEvent=function(e,t){var o=!1;(this.board.isPointInPossibleMoves(e)||this.board.isPointInPossibleCaptures(e)||this.freeMode)&&(this.saveClone(),this.board.lastMoveSrc=new f(this.board.activePiece.point.row,this.board.activePiece.point.col),this.board.lastMoveDest=e.clone(),this.movePiece(this.board.activePiece,e),this.board.activePiece.point.isEqual(this.board.lastMoveSrc)||(o=!0)),(t||o)&&this.disableSelection(),this.disableSelection();var i=this.board.getPieceByPoint(e.row,e.col);i&&!o&&(this.onFreeMode(i),this.onPieceClicked(i,e))},t.prototype.onMouseDown=function(e,t,o,i){if(0===e.button)if(this.drawProvider.clear(),this.board.activePiece&&t.isEqual(this.board.activePiece.point))this.disabling=!0;else{var n=this.board.getPieceByPoint(t.row,t.col);if(this.freeMode&&n){if(e.ctrlKey)return void(this.board.pieces=this.board.pieces.filter((function(e){return e!==n})));this.board.currentWhitePlayer=n.color===h.WHITE}this.isPieceDisabled(n)||(this._selected?this.handleClickEvent(t,!0):n&&(this.onFreeMode(n),this.onPieceClicked(n,t)))}else this.drawPoint=B.getDrawingPoint(this.heightAndWidth,this.colorStrategy,e.x,e.y,e.ctrlKey,e.altKey,e.shiftKey,o,i)},t.prototype.onMouseUp=function(e,t,o,i){if(0===e.button||this.drawDisabled){if(this.drawProvider.clear(),!this.dragDisabled){if(this.board.activePiece&&t.isEqual(this.board.activePiece.point)&&this.disabling)return this.disableSelection(),void(this.disabling=!1);var n=this.board.getPieceByPoint(t.row,t.col);this.isPieceDisabled(n)||this._selected&&this.handleClickEvent(t,!1)}}else this.addDrawPoint(e.x,e.y,e.ctrlKey,e.altKey,e.shiftKey,o,i)},t.prototype.saveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.boardStateProvider.addMove(new q(e))},t.prototype.movePiece=function(e,t,o){var i=this.board.pieces.find((function(e){return e.point.col===t.col&&e.point.row===t.row}));if(this.pgnProcessor.process(this.board,e,t,i),i&&e.color!==i.color)this.board.pieces=this.board.pieces.filter((function(e){return e!==i}));else if(i&&e.color===i.color)return;var n=new x(I.format(e.point,t,this.board.reverted),e.constant.name,e.color===h.WHITE?"white":"black",!!i);if((this.moveHistoryProvider.addMove(n),e instanceof g)&&Math.abs(t.col-e.point.col)>1)if(t.col<3){var r=this.board.getPieceByField(e.point.row,0);this.freeMode||(r.point.col=this.board.reverted?2:3)}else{var s=this.board.getPieceByField(e.point.row,7);this.freeMode||(s.point.col=this.board.reverted?4:5)}e instanceof w?(this.board.checkIfPawnTakesEnPassant(t),this.board.checkIfPawnEnpassanted(e,t)):(this.board.enPassantPoint=null,this.board.enPassantPiece=null),e.point=t,this.increaseFullMoveCount(),this.board.currentWhitePlayer=!this.board.currentWhitePlayer,this.checkForPawnPromote(e,o)||this.afterMoveActions()},t.prototype.checkForPawnPromote=function(e,t){if(e instanceof w)return 0===e.point.row||7===e.point.row?(this.board.pieces=this.board.pieces.filter((function(t){return t!==e})),t?(V.resolvePromotionChoice(this.board,e,t),this.afterMoveActions(t)):this.openPromoteDialog(e),!0):void 0},t.prototype.afterMoveActions=function(e){this.checkIfPawnFirstMove(this.board.activePiece),this.checkIfRookMoved(this.board.activePiece),this.checkIfKingMoved(this.board.activePiece),this.board.blackKingChecked=this.board.isKingInCheck(h.BLACK,this.board.pieces),this.board.whiteKingChecked=this.board.isKingInCheck(h.WHITE,this.board.pieces);var t=this.board.blackKingChecked||this.board.whiteKingChecked,o=this.checkForPossibleMoves(h.BLACK)||this.checkForPossibleMoves(h.WHITE),i=this.checkForPat(h.BLACK)||this.checkForPat(h.WHITE);this.disabling=!1,this.board.calculateFEN();var n=this.moveHistoryProvider.getLastMove();n&&e&&(n.move+=e),this.moveChange.emit(Object.assign(Object.assign({},n),{check:t,checkmate:o,stalemate:i,fen:this.board.fen,freeMode:this.freeMode}))},t.prototype.checkForPat=function(e){return(e!==h.WHITE||this.board.whiteKingChecked)&&(e!==h.BLACK||this.board.blackKingChecked)?void 0:this.checkForPossibleMoves(e)},t.prototype.openPromoteDialog=function(e){var t=this;this.modal.open((function(o){V.resolvePromotionChoice(t.board,e,o),t.afterMoveActions(o)}))},t.prototype.checkForPossibleMoves=function(e){var t=this;return!this.board.pieces.filter((function(t){return t.color===e})).some((function(o){return o.getPossibleMoves().some((function(i){return!I.willMoveCauseCheck(e,o.point.row,o.point.col,i.row,i.col,t.board)}))||o.getPossibleCaptures().some((function(i){return!I.willMoveCauseCheck(e,o.point.row,o.point.col,i.row,i.col,t.board)}))}))},t.prototype.disableSelection=function(){this._selected=!1,this.board.possibleCaptures=[],this.board.activePiece=null,this.board.possibleMoves=[]},t.prototype.onFreeMode=function(e){this.freeMode&&null!=e&&(this.board.currentWhitePlayer=e.color===h.WHITE)},t.prototype.isPieceDisabled=function(e){if(e&&e.point&&this.board.possibleCaptures.find((function(t){return t.col===e.point.col&&t.row===e.point.row})))return!1;return e&&(this.lightDisabled&&e.color===h.WHITE||this.darkDisabled&&e.color===h.BLACK)},t.prototype.addDrawPoint=function(e,t,o,i,n,r,s){var a=B.getDrawingPoint(this.heightAndWidth,this.colorStrategy,e,t,o,i,n,r,s);if(this.drawPoint.isEqual(a)){var c=new X;c.drawPoint=a,this.drawProvider.containsCircle(c)?this.drawProvider.reomveCircle(c):this.drawProvider.addCircle(c)}else{var d=new $;d.start=this.drawPoint,d.end=a,this.drawProvider.containsArrow(d)?this.drawProvider.removeArrow(d):this.drawProvider.addArrow(d)}},t.prototype.increaseFullMoveCount=function(){this.board.currentWhitePlayer||++this.board.fullMoveCount},t.prototype.addPiece=function(e,t,o){if(this.freeMode&&o&&e>0&&t>0){var i=I.translateCoordsToIndex(o,this.board.reverted),n=this.board.getPieceByPoint(i.yAxis,i.xAxis);n&&(this.board.pieces=this.board.pieces.filter((function(e){return e!==n})));var r=J.create(i,e,t,this.board);this.saveClone(),this.board.pieces.push(r),this.afterMoveActions()}},t}(G),te=function(){function e(){this.board=[],this.pieces=[],this.enPassantPoint=null,this.enPassantPiece=null,this.lastMoveSrc=null,this.lastMoveDest=null,this.possibleCaptures=[],this.possibleMoves=[],this.currentWhitePlayer=!0,this.reverted=!1,this.fullMoveCount=1;for(var e=0;e<8;++e){this.board[e]=[];for(var t=0;t<8;++t)this.board[e][t]=0}}return e.prototype.isXYInPossibleMoves=function(e,t){return this.possibleMoves.some((function(o){return o.row===e&&o.col===t}))},e.prototype.isXYInPossibleCaptures=function(e,t){return this.possibleCaptures.some((function(o){return o.row===e&&o.col===t}))},e.prototype.isXYInSourceMove=function(e,t){return this.lastMoveSrc&&this.lastMoveSrc.row===e&&this.lastMoveSrc.col===t},e.prototype.isXYInDestMove=function(e,t){return this.lastMoveDest&&this.lastMoveDest.row===e&&this.lastMoveDest.col===t},e.prototype.isXYInActiveMove=function(e,t){return this.activePiece&&this.activePiece.point.row===e&&this.activePiece.point.col===t},e.prototype.isPointInPossibleMoves=function(e){return this.possibleMoves.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.isPointInPossibleCaptures=function(e){return this.possibleCaptures.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.reset=function(){this.lastMoveDest=null,this.lastMoveSrc=null,this.whiteKingChecked=!1,this.blackKingChecked=!1,this.possibleCaptures=[],this.possibleMoves=[],this.activePiece=null,this.reverted=!1,this.currentWhitePlayer=!0,this.enPassantPoint=null,this.enPassantPiece=null,this.fullMoveCount=1,this.calculateFEN()},e.prototype.reverse=function(){var e=this;this.reverted=!this.reverted,this.activePiece=null,this.possibleMoves=[],this.possibleCaptures=[],this.pieces.forEach((function(t){return e.reversePoint(t.point)})),this.reversePoint(this.lastMoveSrc),this.reversePoint(this.lastMoveDest),this.enPassantPoint&&this.enPassantPiece&&this.reversePoint(this.enPassantPoint)},e.prototype.clone=function(){return r.cloneDeep(this)},e.prototype.isFieldTakenByEnemy=function(e,t,o){return!(e>7||e<0||t>7||t<0)&&this.pieces.some((function(i){return i.point.col===t&&i.point.row===e&&i.color===o}))},e.prototype.isFieldEmpty=function(e,t){return!(e>7||e<0||t>7||t<0)&&!this.pieces.some((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.isFieldUnderAttack=function(e,t,o){return this.pieces.filter((function(e){return e.color===o})).some((function(o){return o.getCoveredFields().some((function(o){return o.col===t&&o.row===e}))}))},e.prototype.getPieceByField=function(e,t){if(!this.isFieldEmpty(e,t))return this.pieces.find((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.isKingInCheck=function(e,t){var o=t.find((function(t){return t.color===e&&t instanceof g}));return!!o&&t.some((function(t){return t.getPossibleCaptures().some((function(e){return e.col===o.point.col&&e.row===o.point.row}))&&t.color!==e}))},e.prototype.getKingByColor=function(e){return this.pieces.find((function(t){return t instanceof g&&t.color===e}))},e.prototype.getCastleFENString=function(e){var t=this.getKingByColor(e);if(!t||t.isMovedAlready)return"";var o="",i=this.getPieceByField(t.point.row,0),n=this.getPieceByField(t.point.row,7);return n instanceof b&&n.color===e&&(n.isMovedAlready||(o+=this.reverted?"q":"k")),i instanceof b&&i.color===e&&(i.isMovedAlready||(o+=this.reverted?"k":"q")),o=o.split("").sort().join(""),e===h.BLACK?o:o.toUpperCase()},e.prototype.getEnPassantFENString=function(){return this.enPassantPoint?this.reverted?String.fromCharCode(104-this.enPassantPoint.col)+(this.enPassantPoint.row+1):String.fromCharCode(97+this.enPassantPoint.col)+(Math.abs(this.enPassantPoint.row-7)+1):"-"},e.prototype.calculateFEN=function(){for(var e="",t=function(t){for(var i=0,n=function(n){var r=o.pieces.find((function(e){return e.point.col===n&&e.point.row===t}));r?(i>0&&(e+=i,i=0),r instanceof b?e+=r.color===h.BLACK?"r":"R":r instanceof v?e+=r.color===h.BLACK?"n":"N":r instanceof y?e+=r.color===h.BLACK?"b":"B":r instanceof P?e+=r.color===h.BLACK?"q":"Q":r instanceof g?e+=r.color===h.BLACK?"k":"K":r instanceof w&&(e+=r.color===h.BLACK?"p":"P")):++i},r=0;r<8;++r)n(r);i>0&&(e+=i),e+="/"},o=this,i=0;i<8;++i)t(i);e=e.substr(0,e.length-1),this.reverted&&(e=e.split("").reverse().join("")),e+=" "+(this.currentWhitePlayer?"w":"b");var n=this.getCastleFENString(h.WHITE)+this.getCastleFENString(h.BLACK);n||(n="-"),e+=" "+n,e+=" "+this.getEnPassantFENString(),e+=" 0",e+=" "+this.fullMoveCount,this.fen=e},e.prototype.isXYInPointSelection=function(e,t){return!1},e.prototype.reversePoint=function(e){e&&(e.row=Math.abs(e.row-7),e.col=Math.abs(e.col-7))},e.prototype.getPieceByPoint=function(e,t){return e=Math.floor(e),t=Math.floor(t),this.pieces.find((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.checkIfPawnTakesEnPassant=function(e){var t=this;e.isEqual(this.enPassantPoint)&&(console.log("usuwam"),this.pieces=this.pieces.filter((function(e){return e!==t.enPassantPiece})),this.enPassantPoint=null,this.enPassantPiece=null)},e.prototype.checkIfPawnEnpassanted=function(e,t){Math.abs(e.point.row-t.row)>1?(this.enPassantPiece=e,this.enPassantPoint=new f((e.point.row+t.row)/2,e.point.col)):(this.enPassantPoint=null,this.enPassantPiece=null)},e.prototype.isKingChecked=function(e){if(e instanceof g)return e.color===h.WHITE?this.whiteKingChecked:this.blackKingChecked},e}(),oe=function(){function e(){this.componentMethodCallSource=new n.Subject,this.componentMethodCalled$=this.componentMethodCallSource.asObservable()}return e.prototype.reset=function(){this.componentMethodCallSource.next()},e}();oe.fac=function(e){return new(e||oe)},oe.prov=i.defineInjectable({token:oe,factory:oe.fac,providedIn:"root"});var ie=["myModal"],ne=function(){function e(){this.opened=!1}return e.prototype.open=function(e){this.opened=!0,this.onCloseCallback=e,this.modal.nativeElement.style.display="block"},e.prototype.changeSelection=function(e){this.modal.nativeElement.style.display="none",this.opened=!1,this.onCloseCallback(e)},e}();ne.fac=function(e){return new(e||ne)},ne.cmp=i.defineComponent({type:ne,selectors:[["app-piece-promotion-modal"]],viewQuery:function(e,t){var o;(1&e&&i.viewQuery(ie,!0),2&e)&&(i.queryRefresh(o=i.loadQuery())&&(t.modal=o.first))},decls:13,vars:0,consts:[[1,"container"],["myModal",""],[1,"wrapper"],[1,"content"],[1,"piece-wrapper"],[1,"piece",3,"click"]],template:function(e,t){1&e&&(i.elementStart(0,"div",0,1),i.elementStart(2,"div",2),i.elementStart(3,"div",3),i.elementStart(4,"div",4),i.elementStart(5,"div",5),i.listener("click",(function(){return t.changeSelection(1)})),i.text(6,""),i.elementEnd(),i.elementStart(7,"div",5),i.listener("click",(function(){return t.changeSelection(2)})),i.text(8,""),i.elementEnd(),i.elementStart(9,"div",5),i.listener("click",(function(){return t.changeSelection(3)})),i.text(10,""),i.elementEnd(),i.elementStart(11,"div",5),i.listener("click",(function(){return t.changeSelection(4)})),i.text(12,""),i.elementEnd(),i.elementEnd(),i.elementEnd(),i.elementEnd(),i.elementEnd())},styles:[".container[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.4);color:#000;display:none;overflow:auto;position:absolute;top:0;z-index:1}.container[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%]{height:100%;width:100%}.content[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%]{position:relative}.content[_ngcontent-%COMP%]{background-color:#fefefe;border:1px solid #888;font-size:100%;height:40%;margin:auto;padding:10px;top:30%;width:90%}.piece[_ngcontent-%COMP%]{cursor:pointer;display:inline-block;font-size:5rem;height:100%;width:25%}.piece[_ngcontent-%COMP%]:hover{background-color:#ccc;border-radius:5px}.piece-wrapper[_ngcontent-%COMP%]{height:80%;width:100%}#close-button[_ngcontent-%COMP%]{background-color:#4caf50;border:none;border-radius:4px;color:#fff;display:inline-block;padding-left:5px;padding-right:5px;text-align:center;text-decoration:none}.selected[_ngcontent-%COMP%]{border:2px solid #00b919;border-radius:4px;box-sizing:border-box}"]});var re=["boardRef"],se=["modal"];function ae(e,t){if(1&e&&(i.elementStart(0,"span",15),i.text(1),i.elementEnd()),2&e){var o=i.nextContext(2).index,n=i.nextContext();i.styleProp("color",o%2==0?n.lightTileColor:n.darkTileColor)("font-size",n.pieceSize/4,"px"),i.advance(1),i.textInterpolate1(" ",n.engineFacade.coords.yCoords[o]," ")}}function ce(e,t){if(1&e&&(i.elementStart(0,"span",16),i.text(1),i.elementEnd()),2&e){var o=i.nextContext().index,n=i.nextContext(2);i.styleProp("color",o%2==0?n.lightTileColor:n.darkTileColor)("font-size",n.pieceSize/4,"px"),i.advance(1),i.textInterpolate1(" ",n.engineFacade.coords.xCoords[o]," ")}}function de(e,t){if(1&e){var o=i.getCurrentView();i.elementStart(0,"div",17),i.elementStart(1,"div",18),i.listener("cdkDragEnded",(function(e){return i.restoreView(o),i.nextContext(3).dragEnded(e)}))("cdkDragStarted",(function(e){return i.restoreView(o),i.nextContext(3).dragStart(e)})),i.elementEnd(),i.elementEnd()}if(2&e){var n=i.nextContext().index,r=i.nextContext().index,s=i.nextContext();i.advance(1),i.styleProp("font-size",s.pieceSize+"px"),i.property("cdkDragDisabled",s.engineFacade.dragDisabled)("innerHTML",s.engineFacade.pieceIconManager.isDefaultIcons()?s.engineFacade.board.getPieceByPoint(r,n).constant.icon:"",i.sanitizeHtml)("ngClass","piece")("ngStyle",s.engineFacade.pieceIconManager.isDefaultIcons()?"":s.getCustomPieceIcons(s.engineFacade.board.getPieceByPoint(r,n)))}}function le(e,t){if(1&e&&(i.elementStart(0,"div",11),i.template(1,ae,2,5,"span",12),i.template(2,ce,2,5,"span",13),i.template(3,de,2,6,"div",14),i.elementEnd()),2&e){var o=t.index,n=i.nextContext().index,r=i.nextContext();i.styleProp("background-color",(n+o)%2==0?r.lightTileColor:r.darkTileColor),i.classProp("current-selection",r.engineFacade.board.isXYInActiveMove(n,o))("dest-move",r.engineFacade.board.isXYInDestMove(n,o))("king-check",r.engineFacade.board.isKingChecked(r.engineFacade.board.getPieceByPoint(n,o)))("point-circle",r.engineFacade.board.isXYInPointSelection(n,o))("possible-capture",r.engineFacade.board.isXYInPossibleCaptures(n,o))("possible-point",r.engineFacade.board.isXYInPossibleMoves(n,o))("source-move",r.engineFacade.board.isXYInSourceMove(n,o)),i.advance(1),i.property("ngIf",r.showCoords&&7===o),i.advance(1),i.property("ngIf",r.showCoords&&7===n),i.advance(1),i.property("ngIf",r.engineFacade.board.getPieceByPoint(n,o))}}function he(e,t){if(1&e&&(i.elementStart(0,"div",9),i.template(1,le,4,19,"div",10),i.elementEnd()),2&e){var o=t.$implicit;i.advance(1),i.property("ngForOf",o)}}function pe(e,t){if(1&e&&(i.namespaceSVG(),i.elementStart(0,"defs"),i.elementStart(1,"marker",19),i.element(2,"path",20),i.elementEnd(),i.elementEnd()),2&e){var o=t.$implicit;i.advance(1),i.property("id",o+"Arrow"),i.advance(1),i.styleProp("fill",o)}}function ue(e,t){if(1&e&&(i.namespaceSVG(),i.element(0,"line",21)),2&e){var o=t.$implicit;i.attribute("marker-end","url(#"+o.end.color+"Arrow)")("stroke",o.end.color)("x1",o.start.x)("x2",o.end.x)("y1",o.start.y)("y2",o.end.y)}}function fe(e,t){if(1&e&&(i.namespaceSVG(),i.element(0,"circle",22)),2&e){var o=t.$implicit,n=i.nextContext();i.attribute("cx",o.drawPoint.x)("cy",o.drawPoint.y)("r",n.engineFacade.heightAndWidth/18)("stroke",o.drawPoint.color)}}var be=function(){return["red","green","blue","orange"]},ge=function(){function e(e){this.ngxChessBoardService=e,this.darkTileColor=H.DEFAULT_DARK_TILE_COLOR,this.lightTileColor=H.DEFAULT_LIGHT_TILE_COLOR,this.showCoords=!0,this.moveChange=new i.EventEmitter,this.checkmate=new i.EventEmitter,this.stalemate=new i.EventEmitter,this.selected=!1,this.engineFacade=new ee(new te,this.moveChange)}return Object.defineProperty(e.prototype,"size",{set:function(e){e&&e>=H.MIN_BOARD_SIZE&&e<=H.MAX_BOARD_SIZE?this.engineFacade.heightAndWidth=e:this.engineFacade.heightAndWidth=H.DEFAULT_SIZE,this.engineFacade.drawProvider.clear(),this.calculatePieceSize()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"freeMode",{set:function(e){this.engineFacade.freeMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dragDisabled",{set:function(e){this.engineFacade.dragDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawDisabled",{set:function(e){this.engineFacade.drawDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pieceIcons",{set:function(e){this.pieceIconManager.pieceIconInput=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lightDisabled",{set:function(e){this.engineFacade.lightDisabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"darkDisabled",{set:function(e){this.engineFacade.darkDisabled=e},enumerable:!1,configurable:!0}),e.prototype.onRightClick=function(e){e.preventDefault()},e.prototype.ngOnChanges=function(e){(e.lightDisabled&&this.lightDisabled&&this.engineFacade.board.currentWhitePlayer||e.darkDisabled&&this.darkDisabled&&!this.engineFacade.board.currentWhitePlayer)&&(this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[])},e.prototype.ngOnInit=function(){var e=this;this.ngxChessBoardService.componentMethodCalled$.subscribe((function(){e.engineFacade.reset()}))},e.prototype.ngAfterViewInit=function(){this.engineFacade.modal=this.modal,this.calculatePieceSize()},e.prototype.onMouseUp=function(e){this.engineFacade.onMouseUp(e,this.getClickPoint(e),this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().top)},e.prototype.reverse=function(){this.selected=!1,this.engineFacade.board.reverse(),this.engineFacade.coords.reverse()},e.prototype.updateBoard=function(e){this.engineFacade.board=e,this.boardLoader.setEngineFacade(this.engineFacade),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[]},e.prototype.setFEN=function(e){try{this.engineFacade.boardLoader.setNotationProcessor(A.getProcessor(p.FEN)),this.engineFacade.boardLoader.loadFEN(e),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[],this.engineFacade.coords.reset()}catch(e){this.engineFacade.boardLoader.addPieces()}},e.prototype.setPGN=function(e){try{this.engineFacade.boardLoader.setNotationProcessor(A.getProcessor(p.PGN)),this.engineFacade.boardLoader.loadPGN(e),this.engineFacade.board.possibleCaptures=[],this.engineFacade.board.possibleMoves=[],this.engineFacade.coords.reset()}catch(e){console.log(e),this.engineFacade.boardLoader.addPieces()}},e.prototype.getFEN=function(){return this.engineFacade.board.fen},e.prototype.dragEnded=function(e){this.engineFacade.dragEndStrategy.process(e)},e.prototype.dragStart=function(e){this.engineFacade.dragStartStrategy.process(e)},e.prototype.onMouseDown=function(e){this.engineFacade.onMouseDown(e,this.getClickPoint(e),this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().top)},e.prototype.getClickPoint=function(e){return B.getClickPoint(e,this.boardRef.nativeElement.getBoundingClientRect().top,this.boardRef.nativeElement.getBoundingClientRect().height,this.boardRef.nativeElement.getBoundingClientRect().left,this.boardRef.nativeElement.getBoundingClientRect().width)},e.prototype.calculatePieceSize=function(){this.pieceSize=this.engineFacade.heightAndWidth/10},e.prototype.getCustomPieceIcons=function(e){return JSON.parse('{ "background-image": "url(\''+this.engineFacade.pieceIconManager.getPieceIcon(e)+"')\"}")},e.prototype.move=function(e){this.engineFacade.move(e)},e.prototype.getMoveHistory=function(){return this.engineFacade.getMoveHistory()},e.prototype.reset=function(){this.engineFacade.reset()},e.prototype.undo=function(){this.engineFacade.undo()},e.prototype.addPiece=function(e,t,o){this.engineFacade.addPiece(e,t,o)},e}();ge.fac=function(e){return new(e||ge)(i.directiveInject(oe))},ge.cmp=i.defineComponent({type:ge,selectors:[["ngx-chess-board"]],viewQuery:function(e,t){var o;(1&e&&(i.viewQuery(re,!0),i.viewQuery(se,!0)),2&e)&&(i.queryRefresh(o=i.loadQuery())&&(t.boardRef=o.first),i.queryRefresh(o=i.loadQuery())&&(t.modal=o.first))},hostBindings:function(e,t){1&e&&i.listener("contextmenu",(function(e){return t.onRightClick(e)}))},inputs:{darkTileColor:"darkTileColor",lightTileColor:"lightTileColor",showCoords:"showCoords",size:"size",freeMode:"freeMode",dragDisabled:"dragDisabled",drawDisabled:"drawDisabled",pieceIcons:"pieceIcons",lightDisabled:"lightDisabled",darkDisabled:"darkDisabled"},outputs:{moveChange:"moveChange",checkmate:"checkmate",stalemate:"stalemate"},features:[i.NgOnChangesFeature],decls:12,vars:15,consts:[["id","board",3,"pointerdown","pointerup"],["boardRef",""],["id","drag"],["class","board-row",4,"ngFor","ngForOf"],[2,"position","absolute","top","0","pointer-events","none"],[4,"ngFor","ngForOf"],["class","arrow",4,"ngFor","ngForOf"],["fill-opacity","0.0","stroke-width","2",4,"ngFor","ngForOf"],["modal",""],[1,"board-row"],["class","board-col",3,"current-selection","dest-move","king-check","point-circle","possible-capture","possible-point","source-move","background-color",4,"ngFor","ngForOf"],[1,"board-col"],["class","yCoord",3,"color","font-size",4,"ngIf"],["class","xCoord",3,"color","font-size",4,"ngIf"],["style","height:100%; width:100%",4,"ngIf"],[1,"yCoord"],[1,"xCoord"],[2,"height","100%","width","100%"],["cdkDrag","",3,"cdkDragDisabled","innerHTML","ngClass","ngStyle","cdkDragEnded","cdkDragStarted"],["markerHeight","13","markerWidth","13","orient","auto","refX","9","refY","6",3,"id"],["d","M2,2 L2,11 L10,6 L2,2"],[1,"arrow"],["fill-opacity","0.0","stroke-width","2"]],template:function(e,t){if(1&e){var o=i.getCurrentView();i.elementStart(0,"div",0,1),i.listener("pointerdown",(function(e){return i.restoreView(o),!i.reference(11).opened&&t.onMouseDown(e)}))("pointerup",(function(e){return i.restoreView(o),!i.reference(11).opened&&t.onMouseUp(e)})),i.elementStart(2,"div",2),i.template(3,he,2,1,"div",3),i.elementEnd(),i.namespaceSVG(),i.elementStart(4,"svg",4),i.template(5,pe,3,3,"defs",5),i.template(6,ue,1,6,"line",6),i.pipe(7,"async"),i.template(8,fe,1,4,"circle",7),i.pipe(9,"async"),i.elementEnd(),i.namespaceHTML(),i.element(10,"app-piece-promotion-modal",null,8),i.elementEnd()}2&e&&(i.styleProp("height",t.engineFacade.heightAndWidth,"px")("width",t.engineFacade.heightAndWidth,"px"),i.advance(3),i.property("ngForOf",t.engineFacade.board.board),i.advance(1),i.attribute("height",t.engineFacade.heightAndWidth)("width",t.engineFacade.heightAndWidth),i.advance(1),i.property("ngForOf",i.pureFunction0(14,be)),i.advance(1),i.property("ngForOf",i.pipeBind1(7,10,t.engineFacade.drawProvider.arrows$)),i.advance(2),i.property("ngForOf",i.pipeBind1(9,12,t.engineFacade.drawProvider.circles$)))},directives:[o.NgForOf,ne,o.NgIf,t.CdkDrag,o.NgClass,o.NgStyle],pipes:[o.AsyncPipe],styles:['@charset "UTF-8";#board[_ngcontent-%COMP%]{font-family:Courier New,serif;position:relative}.board-row[_ngcontent-%COMP%]{display:block;height:12.5%;position:relative;width:100%}.board-col[_ngcontent-%COMP%]{cursor:default;display:inline-block;height:100%;position:relative;vertical-align:top;width:12.5%}.piece[_ngcontent-%COMP%]{-moz-user-select:none;-webkit-user-select:none;background-size:cover;color:#000!important;cursor:-webkit-grab;cursor:grab;height:100%;justify-content:center;text-align:center;user-select:none;width:100%}.piece[_ngcontent-%COMP%], .piece[_ngcontent-%COMP%]:after{box-sizing:border-box}.piece[_ngcontent-%COMP%]:after{content:""}#drag[_ngcontent-%COMP%]{height:100%;width:100%}.possible-point[_ngcontent-%COMP%]{background:radial-gradient(#13262f 15%,transparent 20%)}.possible-capture[_ngcontent-%COMP%]:hover, .possible-point[_ngcontent-%COMP%]:hover{opacity:.4}.possible-capture[_ngcontent-%COMP%]{background:radial-gradient(transparent 0,transparent 80%,#13262f 0);box-sizing:border-box;margin:0;opacity:.5;padding:0}.king-check[_ngcontent-%COMP%]{background:radial-gradient(ellipse at center,red 0,#e70000 25%,rgba(169,0,0,0) 89%,rgba(158,0,0,0) 100%)}.source-move[_ngcontent-%COMP%]{background-color:rgba(146,111,26,.79)!important}.dest-move[_ngcontent-%COMP%]{background-color:#b28e1a!important}.current-selection[_ngcontent-%COMP%]{background-color:#72620b!important}.yCoord[_ngcontent-%COMP%]{right:.2em}.xCoord[_ngcontent-%COMP%], .yCoord[_ngcontent-%COMP%]{-moz-user-select:none;-webkit-user-select:none;box-sizing:border-box;cursor:pointer;font-family:Lucida Console,Courier,monospace;position:absolute;user-select:none}.xCoord[_ngcontent-%COMP%]{bottom:0;left:.2em}.hovering[_ngcontent-%COMP%]{background-color:red!important}.arrow[_ngcontent-%COMP%]{stroke-width:2}svg[_ngcontent-%COMP%]{filter:drop-shadow(1px 1px 0 #111) drop-shadow(-1px 1px 0 #111) drop-shadow(1px -1px 0 #111) drop-shadow(-1px -1px 0 #111)}[_nghost-%COMP%]{display:inline-block!important}']});var ye=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[oe]}},e}();ye.mod=i.defineNgModule({type:ye}),ye.inj=i.defineInjector({factory:function(e){return new(e||ye)},imports:[[o.CommonModule,t.DragDropModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&i.setNgModuleScope(ye,{declarations:[ge,ne],imports:[o.CommonModule,t.DragDropModule],exports:[ge]}),e.HistoryMove=x,e.NgxChessBoardComponent=ge,e.NgxChessBoardModule=ye,e.NgxChessBoardService=oe,e.PiecePromotionModalComponent=ne,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-chess-board.umd.min.js.map