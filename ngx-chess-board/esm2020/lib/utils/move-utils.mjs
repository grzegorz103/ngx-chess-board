import { Bishop } from '../models/pieces/bishop';
import { King } from '../models/pieces/king';
import { Knight } from '../models/pieces/knight';
import { Pawn } from '../models/pieces/pawn';
import { Point } from '../models/pieces/point';
import { MoveTranslation } from '../models/move-translation';
import { Queen } from '../models/pieces/queen';
import { Rook } from '../models/pieces/rook';
export class MoveUtils {
    static willMoveCauseCheck(currentColor, row, col, destRow, destCol, board) {
        const srcPiece = board.getPieceByField(row, col);
        const destPiece = board.getPieceByField(destRow, destCol);
        if (srcPiece) {
            srcPiece.point.row = destRow;
            srcPiece.point.col = destCol;
        }
        if (destPiece) {
            board.pieces = board.pieces.filter((piece) => piece !== destPiece);
        }
        const isBound = board.isKingInCheck(currentColor, board.pieces);
        if (srcPiece) {
            srcPiece.point.col = col;
            srcPiece.point.row = row;
        }
        if (destPiece) {
            board.pieces.push(destPiece);
        }
        return isBound;
    }
    static format(sourcePoint, destPoint, reverted) {
        if (reverted) {
            const sourceX = 104 - sourcePoint.col;
            const destX = 104 - destPoint.col;
            return (String.fromCharCode(sourceX) +
                (sourcePoint.row + 1) +
                String.fromCharCode(destX) +
                (destPoint.row + 1));
        }
        else {
            const incrementX = 97;
            return (String.fromCharCode(sourcePoint.col + incrementX) +
                (Math.abs(sourcePoint.row - 7) + 1) +
                String.fromCharCode(destPoint.col + incrementX) +
                (Math.abs(destPoint.row - 7) + 1));
        }
    }
    static translateCoordsToIndex(coords, reverted) {
        let xAxis;
        let yAxis;
        if (reverted) {
            xAxis = 104 - coords.charCodeAt(0);
            yAxis = +coords.charAt(1) - 1;
        }
        else {
            xAxis = coords.charCodeAt(0) - 97;
            yAxis = Math.abs(+coords.charAt(1) - 8);
        }
        return new MoveTranslation(xAxis, yAxis, reverted);
    }
    static findPieceByPossibleMovesContaining(coords, board, color) {
        let indexes = this.translateCoordsToIndex(coords, board.reverted);
        let destPoint = new Point(indexes.yAxis, indexes.xAxis);
        let foundPieces = [];
        for (let piece of board.pieces.filter(piece => piece.color === color)) {
            for (let point of piece.getPossibleMoves()) {
                if (!MoveUtils.willMoveCauseCheck(piece.color, piece.point.row, piece.point.col, indexes.yAxis, indexes.xAxis, board) && point.isEqual(destPoint)) {
                    foundPieces.push(piece);
                }
            }
        }
        return foundPieces;
    }
    static findPieceByPossibleCapturesContaining(coords, board, color) {
        let indexes = this.translateCoordsToIndex(coords, board.reverted);
        let destPoint = new Point(indexes.yAxis, indexes.xAxis);
        let foundPieces = [];
        for (let piece of board.pieces.filter(piece => piece.color === color)) {
            for (let point of piece.getPossibleCaptures()) {
                if (!MoveUtils.willMoveCauseCheck(piece.color, piece.point.row, piece.point.col, indexes.yAxis, indexes.xAxis, board) && point.isEqual(destPoint)) {
                    foundPieces.push(piece);
                }
            }
        }
        return foundPieces;
    }
    static formatSingle(point, reverted) {
        if (reverted) {
            const sourceX = 104 - point.col;
            return (String.fromCharCode(sourceX) +
                (point.row + 1));
        }
        else {
            const incrementX = 97;
            return (String.fromCharCode(point.col + incrementX) +
                (Math.abs(point.row - 7) + 1));
        }
    }
    static getFirstLetterPiece(piece) {
        if (piece instanceof Pawn) {
            return 'P';
        }
        else {
            if (piece instanceof Knight) {
                return 'N';
            }
            else {
                if (piece instanceof Bishop) {
                    return 'B';
                }
                else {
                    if (piece instanceof Rook) {
                        return 'R';
                    }
                    else {
                        if (piece instanceof King) {
                            return 'K';
                        }
                        else {
                            if (piece instanceof Queen) {
                                return 'Q';
                            }
                        }
                    }
                }
            }
        }
        return '';
    }
    static reverse(board, row) {
        return board.reverted
            ? row + 1
            : Math.abs(row - 7) + 1;
    }
    static formatCol(board, col) {
        return board.reverted
            ? String.fromCharCode(104 - col)
            : String.fromCharCode(97 + col);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW92ZS11dGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1jaGVzcy1ib2FyZC9zcmMvbGliL3V0aWxzL21vdmUtdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRWpELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM3QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDakQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTdDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUMvQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDN0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9DLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUU3QyxNQUFNLE9BQU8sU0FBUztJQUNYLE1BQU0sQ0FBQyxrQkFBa0IsQ0FDNUIsWUFBbUIsRUFDbkIsR0FBVyxFQUNYLEdBQVcsRUFDWCxPQUFlLEVBQ2YsT0FBZSxFQUNmLEtBQVk7UUFFWixNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNqRCxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUUxRCxJQUFJLFFBQVEsRUFBRTtZQUNWLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLE9BQU8sQ0FBQztZQUM3QixRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUM7U0FDaEM7UUFFRCxJQUFJLFNBQVMsRUFBRTtZQUNYLEtBQUssQ0FBQyxNQUFNLEdBQUcs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QUNkO3FCQUFNO29CQUNILElBQUksS0FBSyxZQUFZLElBQUksRUFBRTt3QkFDdkIsT0FBTyxHQUFHLENBQUM7cUJBQ2Q7eUJBQU07d0JBQ0gsSUFBSSxLQUFLLFlBQVksSUFBSSxFQUFFOzRCQUN2QixPQUFPLEdBQUcsQ0FBQzt5QkFDZDs2QkFBTTs0QkFDSCxJQUFJLEtBQUssWUFBWSxLQUFLLEVBQUU7Z0NBQ3hCLE9BQU8sR0FBRyxDQUFDOzZCQUNkO3lCQUNKO3FCQUNKO2lCQUNKO2FBQ0o7U0FDSjtRQUVELE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBWSxFQUFFLEdBQVc7UUFDcEMsT0FBTyxLQUFLLENBQUMsUUFBUTtZQUNqQixDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDVCxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQVksRUFBRSxHQUFXO1FBQ3RDLE9BQU8sS0FBSyxDQUFDLFFBQVE7WUFDakIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztZQUNoQyxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDeEMsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQm9hcmQgfSBmcm9tICcuLi9tb2RlbHMvYm9hcmQnO1xyXG5pbXBvcnQgeyBCaXNob3AgfSBmcm9tICcuLi9tb2RlbHMvcGllY2VzL2Jpc2hvcCc7XHJcbmltcG9ydCB7IENvbG9yIH0gZnJvbSAnLi4vbW9kZWxzL3BpZWNlcy9jb2xvcic7XHJcbmltcG9ydCB7IEtpbmcgfSBmcm9tICcuLi9tb2RlbHMvcGllY2VzL2tpbmcnO1xyXG5pbXBvcnQgeyBLbmlnaHQgfSBmcm9tICcuLi9tb2RlbHMvcGllY2VzL2tuaWdodCc7XHJcbmltcG9ydCB7IFBhd24gfSBmcm9tICcuLi9tb2RlbHMvcGllY2VzL3Bhd24nO1xyXG5pbXBvcnQgeyBQaWVjZSB9IGZyb20gJy4uL21vZGVscy9waWVjZXMvcGllY2UnO1xyXG5pbXBvcnQgeyBQb2ludCB9IGZyb20gJy4uL21vZGVscy9waWVjZXMvcG9pbnQnO1xyXG5pbXBvcnQgeyBNb3ZlVHJhbnNsYXRpb24gfSBmcm9tICcuLi9tb2RlbHMvbW92ZS10cmFuc2xhdGlvbic7XHJcbmltcG9ydCB7IFF1ZWVuIH0gZnJvbSAnLi4vbW9kZWxzL3BpZWNlcy9xdWVlbic7XHJcbmltcG9ydCB7IFJvb2sgfSBmcm9tICcuLi9tb2RlbHMvcGllY2VzL3Jvb2snO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1vdmVVdGlscyB7XHJcbiAgICBwdWJsaWMgc3RhdGljIHdpbGxNb3ZlQ2F1c2VDaGVjayhcclxuICAgICAgICBjdXJyZW50Q29sb3I6IENvbG9yLFxyXG4gICAgICAgIHJvdzogbnVtYmVyLFxyXG4gICAgICAgIGNvbDogbnVtYmVyLFxyXG4gICAgICAgIGRlc3RSb3c6IG51bWJlcixcclxuICAgICAgICBkZXN0Q29sOiBudW1iZXIsXHJcbiAgICAgICAgYm9hcmQ6IEJvYXJkXHJcbiAgICApIHtcclxuICAgICAgICBjb25zdCBzcmNQaWVjZSA9IGJvYXJkLmdldFBpZWNlQnlGaWVsZChyb3csIGNvbCk7XHJcbiAgICAgICAgY29uc3QgZGVzdFBpZWNlID0gYm9hcmQuZ2V0UGllY2VCeUZpZWxkKGRlc3RSb3csIGRlc3RDb2wpO1xyXG5cclxuICAgICAgICBpZiAoc3JjUGllY2UpIHtcclxuICAgICAgICAgICAgc3JjUGllY2UucG9pbnQucm93ID0gZGVzdFJvdztcclxuICAgICAgICAgICAgc3JjUGllY2UucG9pbnQuY29sID0gZGVzdENvbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkZXN0UGllY2UpIHtcclxuICAgICAgICAgICAgYm9hcmQucGllY2VzID0gYm9hcmQucGllY2VzLmZpbHRlcigocGllY2UpID0+IHBpZWNlICE9PSBkZXN0UGllY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpc0JvdW5kID0gYm9hcmQuaXNLaW5nSW5DaGVjayhjdXJyZW50Q29sb3IsIGJvYXJkLnBpZWNlcyk7XHJcblxyXG4gICAgICAgIGlmIChzcmNQaWVjZSkge1xyXG4gICAgICAgICAgICBzcmNQaWVjZS5wb2ludC5jb2wgPSBjb2w7XHJcbiAgICAgICAgICAgIHNyY1BpZWNlLnBvaW50LnJvdyA9IHJvdztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkZXN0UGllY2UpIHtcclxuICAgICAgICAgICAgYm9hcmQucGllY2VzLnB1c2goZGVzdFBpZWNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBpc0JvdW5kO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZm9ybWF0KFxyXG4gICAgICAgIHNvdXJjZVBvaW50OiBQb2ludCxcclxuICAgICAgICBkZXN0UG9pbnQ6IFBvaW50LFxyXG4gICAgICAgIHJldmVydGVkOiBib29sZWFuXHJcbiAgICApIHtcclxuICAgICAgICBpZiAocmV2ZXJ0ZWQpIHtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlWCA9IDEwNCAtIHNvdXJjZVBvaW50LmNvbDtcclxuICAgICAgICAgICAgY29uc3QgZGVzdFggPSAxMDQgLSBkZXN0UG9pbnQuY29sO1xyXG4gICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZShzb3VyY2VYKSArXHJcbiAgICAgICAgICAgICAgICAoc291cmNlUG9pbnQucm93ICsgMSkgK1xyXG4gICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZShkZXN0WCkgK1xyXG4gICAgICAgICAgICAgICAgKGRlc3RQb2ludC5yb3cgKyAxKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluY3JlbWVudFggPSA5NztcclxuICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUoc291cmNlUG9pbnQuY29sICsgaW5jcmVtZW50WCkgK1xyXG4gICAgICAgICAgICAgICAgKE1hdGguYWJzKHNvdXJjZVBvaW50LnJvdyAtIDcpICsgMSkgK1xyXG4gICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZShkZXN0UG9pbnQuY29sICsgaW5jcmVtZW50WCkgK1xyXG4gICAgICAgICAgICAgICAgKE1hdGguYWJzKGRlc3RQb2ludC5yb3cgLSA3KSArIDEpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgdHJhbnNsYXRlQ29vcmRzVG9JbmRleChjb29yZHM6IHN0cmluZywgcmV2ZXJ0ZWQ6IGJvb2xlYW4pIHtcclxuICAgICAgICBsZXQgeEF4aXM6IG51bWJlcjtcclxuICAgICAgICBsZXQgeUF4aXM6IG51bWJlcjtcclxuICAgICAgICBpZiAocmV2ZXJ0ZWQpIHtcclxuICAgICAgICAgICAgeEF4aXMgPSAxMDQgLSBjb29yZHMuY2hhckNvZGVBdCgwKTtcclxuICAgICAgICAgICAgeUF4aXMgPSArY29vcmRzLmNoYXJBdCgxKSAtIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgeEF4aXMgPSBjb29yZHMuY2hhckNvZGVBdCgwKSAtIDk3O1xyXG4gICAgICAgICAgICB5QXhpcyA9IE1hdGguYWJzKCtjb29yZHMuY2hhckF0KDEpIC0gOCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbmV3IE1vdmVUcmFuc2xhdGlvbih4QXhpcywgeUF4aXMsIHJldmVydGVkKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGZpbmRQaWVjZUJ5UG9zc2libGVNb3Zlc0NvbnRhaW5pbmcoXHJcbiAgICAgICAgY29vcmRzOiBzdHJpbmcsXHJcbiAgICAgICAgYm9hcmQ6IEJvYXJkLFxyXG4gICAgICAgIGNvbG9yOiBDb2xvclxyXG4gICAgKTogUGllY2VbXSB7XHJcbiAgICAgICAgbGV0IGluZGV4ZXMgPSB0aGlzLnRyYW5zbGF0ZUNvb3Jkc1RvSW5kZXgoY29vcmRzLCBib2FyZC5yZXZlcnRlZCk7XHJcbiAgICAgICAgbGV0IGRlc3RQb2ludCA9IG5ldyBQb2ludChpbmRleGVzLnlBeGlzLCBpbmRleGVzLnhBeGlzKTtcclxuICAgICAgICBsZXQgZm91bmRQaWVjZXMgPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgcGllY2Ugb2YgYm9hcmQucGllY2VzLmZpbHRlcihwaWVjZSA9PiBwaWVjZS5jb2xvciA9PT0gY29sb3IpKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHBvaW50IG9mIHBpZWNlLmdldFBvc3NpYmxlTW92ZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFNb3ZlVXRpbHMud2lsbE1vdmVDYXVzZUNoZWNrKFxyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlLmNvbG9yLFxyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlLnBvaW50LnJvdyxcclxuICAgICAgICAgICAgICAgICAgICBwaWVjZS5wb2ludC5jb2wsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXhlcy55QXhpcyxcclxuICAgICAgICAgICAgICAgICAgICBpbmRleGVzLnhBeGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvYXJkXHJcbiAgICAgICAgICAgICAgICApICYmIHBvaW50LmlzRXF1YWwoZGVzdFBvaW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kUGllY2VzLnB1c2gocGllY2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmb3VuZFBpZWNlcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGZpbmRQaWVjZUJ5UG9zc2libGVDYXB0dXJlc0NvbnRhaW5pbmcoXHJcbiAgICAgICAgY29vcmRzOiBzdHJpbmcsXHJcbiAgICAgICAgYm9hcmQ6IEJvYXJkLFxyXG4gICAgICAgIGNvbG9yOiBDb2xvclxyXG4gICAgKTogUGllY2VbXSB7XHJcbiAgICAgICAgbGV0IGluZGV4ZXMgPSB0aGlzLnRyYW5zbGF0ZUNvb3Jkc1RvSW5kZXgoY29vcmRzLCBib2FyZC5yZXZlcnRlZCk7XHJcbiAgICAgICAgbGV0IGRlc3RQb2ludCA9IG5ldyBQb2ludChpbmRleGVzLnlBeGlzLCBpbmRleGVzLnhBeGlzKTtcclxuICAgICAgICBsZXQgZm91bmRQaWVjZXMgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBwaWVjZSBvZiBib2FyZC5waWVjZXMuZmlsdGVyKHBpZWNlID0+IHBpZWNlLmNvbG9yID09PSBjb2xvcikpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgcG9pbnQgb2YgcGllY2UuZ2V0UG9zc2libGVDYXB0dXJlcygpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIU1vdmVVdGlscy53aWxsTW92ZUNhdXNlQ2hlY2soXHJcbiAgICAgICAgICAgICAgICAgICAgcGllY2UuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgcGllY2UucG9pbnQucm93LFxyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlLnBvaW50LmNvbCxcclxuICAgICAgICAgICAgICAgICAgICBpbmRleGVzLnlBeGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ZXMueEF4aXMsXHJcbiAgICAgICAgICAgICAgICAgICAgYm9hcmRcclxuICAgICAgICAgICAgICAgICkgJiYgcG9pbnQuaXNFcXVhbChkZXN0UG9pbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm91bmRQaWVjZXMucHVzaChwaWVjZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmb3VuZFBpZWNlcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGZvcm1hdFNpbmdsZShwb2ludDogUG9pbnQsIHJldmVydGVkOiBib29sZWFuKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAocmV2ZXJ0ZWQpIHtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlWCA9IDEwNCAtIHBvaW50LmNvbDtcclxuICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUoc291cmNlWCkgK1xyXG4gICAgICAgICAgICAgICAgKHBvaW50LnJvdyArIDEpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgaW5jcmVtZW50WCA9IDk3O1xyXG4gICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZShwb2ludC5jb2wgKyBpbmNyZW1lbnRYKSArXHJcbiAgICAgICAgICAgICAgICAoTWF0aC5hYnMocG9pbnQucm93IC0gNykgKyAxKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldEZpcnN0TGV0dGVyUGllY2UocGllY2U6IFBpZWNlKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAocGllY2UgaW5zdGFuY2VvZiBQYXduKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnUCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHBpZWNlIGluc3RhbmNlb2YgS25pZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJ04nO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBpZWNlIGluc3RhbmNlb2YgQmlzaG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdCJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBpZWNlIGluc3RhbmNlb2YgUm9vaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ1InO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaWVjZSBpbnN0YW5jZW9mIEtpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnSyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGllY2UgaW5zdGFuY2VvZiBRdWVlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcmV2ZXJzZShib2FyZDogQm9hcmQsIHJvdzogbnVtYmVyKSB7XHJcbiAgICAgICAgcmV0dXJuIGJvYXJkLnJldmVydGVkXHJcbiAgICAgICAgICAgID8gcm93ICsgMVxyXG4gICAgICAgICAgICA6IE1hdGguYWJzKHJvdyAtIDcpICsgMTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZm9ybWF0Q29sKGJvYXJkOiBCb2FyZCwgY29sOiBudW1iZXIpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBib2FyZC5yZXZlcnRlZFxyXG4gICAgICAgICAgICA/IFN0cmluZy5mcm9tQ2hhckNvZGUoMTA0IC0gY29sKVxyXG4gICAgICAgICAgICA6IFN0cmluZy5mcm9tQ2hhckNvZGUoOTcgKyBjb2wpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==